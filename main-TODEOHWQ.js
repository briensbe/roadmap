import{$ as Qi,$a as ao,$b as zr,A as Gi,Aa as oo,Ab as fn,Ac as K,B as Dt,Ba as L,Bb as Or,Bc as ii,C as Wn,Ca as _r,Cb as _t,Cc as ee,D as ft,Da as Cr,Db as kr,Dc as te,E as Ji,Ea as ro,Eb as Er,Ec as ve,F as tr,Fa as B,Fb as Jn,Fc as xe,G as nr,Ga as Be,Gb as Tr,Gc as ne,H as ir,Ha as gn,Hb as Yn,Hc as we,I as Ne,Ia as b,Ib as hn,Ic as Qe,J as Yi,Ja as vr,Jb as Ir,Jc as je,K as he,Ka as xr,Kb as jr,Kc as Re,L as ae,La as wr,Lb as Rr,Lc as Ve,M as or,Ma as br,Mb as Qn,Mc as Zr,N as D,Na as Me,Nb as Kn,Nc as Bt,O as Ue,Oa as q,Ob as Ce,Oc as be,P as rr,Pa as W,Pb as X,Pc as oi,Q as _e,Qa as Nt,Qb as Vr,Qc as Z,R,Ra as Pe,Rb as Dr,Rc as Xr,S as I,Sa as Se,Sb as Zn,Sc as H,T as ar,Ta as g,Tb as G,Tc as ea,U as sr,Ua as s,Ub as Ar,V as At,Va as l,Vb as Nr,W as $e,Wa as M,Wb as Lr,X as f,Xa as at,Xb as Xn,Y as h,Ya as st,Yb as Ft,Z as ht,Za as Oe,Zb as ei,_ as Ot,_a as ke,_b as Fr,a as T,aa as qe,ab as E,ac as Ct,b as me,ba as lr,bb as yr,bc as qr,c as Jo,ca as Ki,cb as _,cc as vt,d as C,da as Un,db as Hn,dc as Wr,e as Yo,ea as ie,eb as u,ec as Ur,f as Qo,fa as cr,fb as Mr,fc as zt,g as Ko,ga as rt,gb as kt,gc as $r,h as Ui,ha as Zi,hb as lt,hc as qt,i as $i,ia as dr,ib as ct,ic as Wt,j as it,ja as Xi,jb as Lt,jc as Br,k as Te,ka as pr,kb as oe,kc as Hr,l as ot,la as eo,lb as U,lc as Gr,m as De,ma as ur,mb as p,n as N,na as $n,nb as j,nc as Ut,o as pn,oa as to,ob as y,oc as Jr,p as Zo,pa as no,pb as Ie,q as Xo,qa as io,qb as Gn,qc as He,r as Q,ra as mr,rb as P,s as Bi,sa as Bn,sb as S,sc as Yr,t as Ae,ta as c,tb as O,tc as Qr,u as Hi,ua as un,ub as Pr,uc as ti,v as er,va as gr,vb as Sr,vc as ni,w as qn,wa as fr,wb as so,wc as $t,x as gt,xa as ye,xb as lo,xc as xt,y as St,ya as mn,yb as se,yc as Kr,z as Vt,za as hr,zb as le,zc as de}from"./chunk-UTCRNKYW.js";var _n=class{_doc;constructor(r){this._doc=r}manager},ri=(()=>{class i extends _n{constructor(n){super(n)}supports(n){return!0}addEventListener(n,e,t,o){return n.addEventListener(e,t,o),()=>this.removeEventListener(n,e,t,o)}removeEventListener(n,e,t,o){return n.removeEventListener(e,t,o)}static \u0275fac=function(e){return new(e||i)(R(qe))};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})(),si=new _e(""),go=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(n,e){this._zone=e,n.forEach(a=>{a.manager=this});let t=n.filter(a=>!(a instanceof ri));this._plugins=t.slice().reverse();let o=n.find(a=>a instanceof ri);o&&this._plugins.push(o)}addEventListener(n,e,t,o){return this._findPluginFor(e).addEventListener(n,e,t,o)}getZone(){return this._zone}_findPluginFor(n){let e=this._eventNameToPlugin.get(n);if(e)return e;if(e=this._plugins.find(o=>o.supports(n)),!e)throw new ae(5101,!1);return this._eventNameToPlugin.set(n,e),e}static \u0275fac=function(e){return new(e||i)(R(si),R(mn))};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})(),co="ng-app-id";function ta(i){for(let r of i)r.remove()}function na(i,r){let n=r.createElement("style");return n.textContent=i,n}function ys(i,r,n,e){let t=i.head?.querySelectorAll(`style[${co}="${r}"],link[${co}="${r}"]`);if(t)for(let o of t)o.removeAttribute(co),o instanceof HTMLLinkElement?e.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&n.set(o.textContent,{usage:0,elements:[o]})}function uo(i,r){let n=r.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",i),n}var fo=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(n,e,t,o={}){this.doc=n,this.appId=e,this.nonce=t,ys(n,e,this.inline,this.external),this.hosts.add(n.head)}addStyles(n,e){for(let t of n)this.addUsage(t,this.inline,na);e?.forEach(t=>this.addUsage(t,this.external,uo))}removeStyles(n,e){for(let t of n)this.removeUsage(t,this.inline);e?.forEach(t=>this.removeUsage(t,this.external))}addUsage(n,e,t){let o=e.get(n);o?o.usage++:e.set(n,{usage:1,elements:[...this.hosts].map(a=>this.addElement(a,t(n,this.doc)))})}removeUsage(n,e){let t=e.get(n);t&&(t.usage--,t.usage<=0&&(ta(t.elements),e.delete(n)))}ngOnDestroy(){for(let[,{elements:n}]of[...this.inline,...this.external])ta(n);this.hosts.clear()}addHost(n){this.hosts.add(n);for(let[e,{elements:t}]of this.inline)t.push(this.addElement(n,na(e,this.doc)));for(let[e,{elements:t}]of this.external)t.push(this.addElement(n,uo(e,this.doc)))}removeHost(n){this.hosts.delete(n)}addElement(n,e){return this.nonce&&e.setAttribute("nonce",this.nonce),n.appendChild(e)}static \u0275fac=function(e){return new(e||i)(R(qe),R(eo),R(to,8),R($n))};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})(),po={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},ho=/%COMP%/g;var oa="%COMP%",Ms=`_nghost-${oa}`,Ps=`_ngcontent-${oa}`,Ss=!0,Os=new _e("",{providedIn:"root",factory:()=>Ss});function ks(i){return Ps.replace(ho,i)}function Es(i){return Ms.replace(ho,i)}function ra(i,r){return r.map(n=>n.replace(ho,i))}var _o=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(n,e,t,o,a,d,m=null,v=null){this.eventManager=n,this.sharedStylesHost=e,this.appId=t,this.removeStylesOnCompDestroy=o,this.doc=a,this.ngZone=d,this.nonce=m,this.tracingService=v,this.platformIsServer=!1,this.defaultRenderer=new Cn(n,a,d,this.platformIsServer,this.tracingService)}createRenderer(n,e){if(!n||!e)return this.defaultRenderer;let t=this.getOrCreateRenderer(n,e);return t instanceof ai?t.applyToHost(n):t instanceof vn&&t.applyStyles(),t}getOrCreateRenderer(n,e){let t=this.rendererByCompId,o=t.get(e.id);if(!o){let a=this.doc,d=this.ngZone,m=this.eventManager,v=this.sharedStylesHost,x=this.removeStylesOnCompDestroy,w=this.platformIsServer,k=this.tracingService;switch(e.encapsulation){case no.Emulated:o=new ai(m,v,e,this.appId,x,a,d,w,k);break;case no.ShadowDom:return new mo(m,v,n,e,a,d,this.nonce,w,k);default:o=new vn(m,v,e,x,a,d,w,k);break}t.set(e.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(n){this.rendererByCompId.delete(n)}static \u0275fac=function(e){return new(e||i)(R(go),R(fo),R(eo),R(Os),R(qe),R(mn),R(to),R(fr,8))};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})(),Cn=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(r,n,e,t,o){this.eventManager=r,this.doc=n,this.ngZone=e,this.platformIsServer=t,this.tracingService=o}destroy(){}destroyNode=null;createElement(r,n){return n?this.doc.createElementNS(po[n]||n,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,n){(ia(r)?r.content:r).appendChild(n)}insertBefore(r,n,e){r&&(ia(r)?r.content:r).insertBefore(n,e)}removeChild(r,n){n.remove()}selectRootElement(r,n){let e=typeof r=="string"?this.doc.querySelector(r):r;if(!e)throw new ae(-5104,!1);return n||(e.textContent=""),e}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,n,e,t){if(t){n=t+":"+n;let o=po[t];o?r.setAttributeNS(o,n,e):r.setAttribute(n,e)}else r.setAttribute(n,e)}removeAttribute(r,n,e){if(e){let t=po[e];t?r.removeAttributeNS(t,n):r.removeAttribute(`${e}:${n}`)}else r.removeAttribute(n)}addClass(r,n){r.classList.add(n)}removeClass(r,n){r.classList.remove(n)}setStyle(r,n,e,t){t&(un.DashCase|un.Important)?r.style.setProperty(n,e,t&un.Important?"important":""):r.style[n]=e}removeStyle(r,n,e){e&un.DashCase?r.style.removeProperty(n):r.style[n]=""}setProperty(r,n,e){r!=null&&(r[n]=e)}setValue(r,n){r.nodeValue=n}listen(r,n,e,t){if(typeof r=="string"&&(r=hn().getGlobalEventTarget(this.doc,r),!r))throw new ae(5102,!1);let o=this.decoratePreventDefault(e);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(r,n,o)),this.eventManager.addEventListener(r,n,o,t)}decoratePreventDefault(r){return n=>{if(n==="__ngUnwrap__")return r;r(n)===!1&&n.preventDefault()}}};function ia(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var mo=class extends Cn{sharedStylesHost;hostEl;shadowRoot;constructor(r,n,e,t,o,a,d,m,v){super(r,o,a,m,v),this.sharedStylesHost=n,this.hostEl=e,this.shadowRoot=e.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let x=t.styles;x=ra(t.id,x);for(let k of x){let V=document.createElement("style");d&&V.setAttribute("nonce",d),V.textContent=k,this.shadowRoot.appendChild(V)}let w=t.getExternalStyles?.();if(w)for(let k of w){let V=uo(k,o);d&&V.setAttribute("nonce",d),this.shadowRoot.appendChild(V)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,n){return super.appendChild(this.nodeOrShadowRoot(r),n)}insertBefore(r,n,e){return super.insertBefore(this.nodeOrShadowRoot(r),n,e)}removeChild(r,n){return super.removeChild(null,n)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},vn=class extends Cn{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(r,n,e,t,o,a,d,m,v){super(r,o,a,d,m),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=t;let x=e.styles;this.styles=v?ra(v,x):x,this.styleUrls=e.getExternalStyles?.(v)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&gr.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},ai=class extends vn{contentAttr;hostAttr;constructor(r,n,e,t,o,a,d,m,v){let x=t+"-"+e.id;super(r,n,e,o,a,d,m,v,x),this.contentAttr=ks(x),this.hostAttr=Es(x)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,n){let e=super.createElement(r,n);return super.setAttribute(e,this.contentAttr,""),e}};var li=class i extends jr{supportsDOMEvents=!0;static makeCurrent(){Ir(new i)}onAndCancel(r,n,e,t){return r.addEventListener(n,e,t),()=>{r.removeEventListener(n,e,t)}}dispatchEvent(r,n){r.dispatchEvent(n)}remove(r){r.remove()}createElement(r,n){return n=n||this.getDefaultDocument(),n.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,n){return n==="window"?window:n==="document"?r:n==="body"?r.body:null}getBaseHref(r){let n=Ts();return n==null?null:Is(n)}resetBaseElement(){xn=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return Ar(document.cookie,r)}},xn=null;function Ts(){return xn=xn||document.head.querySelector("base"),xn?xn.getAttribute("href"):null}function Is(i){return new URL(i,document.baseURI).pathname}var js=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})(),aa=["alt","control","meta","shift"],Rs={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Vs={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},sa=(()=>{class i extends _n{constructor(n){super(n)}supports(n){return i.parseEventName(n)!=null}addEventListener(n,e,t,o){let a=i.parseEventName(e),d=i.eventCallback(a.fullKey,t,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>hn().onAndCancel(n,a.domEventName,d,o))}static parseEventName(n){let e=n.toLowerCase().split("."),t=e.shift();if(e.length===0||!(t==="keydown"||t==="keyup"))return null;let o=i._normalizeKey(e.pop()),a="",d=e.indexOf("code");if(d>-1&&(e.splice(d,1),a="code."),aa.forEach(v=>{let x=e.indexOf(v);x>-1&&(e.splice(x,1),a+=v+".")}),a+=o,e.length!=0||o.length===0)return null;let m={};return m.domEventName=t,m.fullKey=a,m}static matchEventFullKeyCode(n,e){let t=Rs[n.key]||n.key,o="";return e.indexOf("code.")>-1&&(t=n.code,o="code."),t==null||!t?!1:(t=t.toLowerCase(),t===" "?t="space":t==="."&&(t="dot"),aa.forEach(a=>{if(a!==t){let d=Vs[a];d(n)&&(o+=a+".")}}),o+=t,o===e)}static eventCallback(n,e,t){return o=>{i.matchEventFullKeyCode(o,n)&&t.runGuarded(()=>e(o))}}static _normalizeKey(n){return n==="esc"?"escape":n}static \u0275fac=function(e){return new(e||i)(R(qe))};static \u0275prov=D({token:i,factory:i.\u0275fac})}return i})();function Co(i,r,n){let e=T({rootComponent:i,platformRef:n?.platformRef},Ds(r));return Tr(e)}function Ds(i){return{appProviders:[...zs,...i?.providers??[]],platformProviders:Fs}}function As(){li.makeCurrent()}function Ns(){return new Ki}function Ls(){return pr(document),document}var Fs=[{provide:$n,useValue:Lr},{provide:ur,useValue:As,multi:!0},{provide:qe,useFactory:Ls}];var zs=[{provide:sr,useValue:"root"},{provide:Ki,useFactory:Ns},{provide:si,useClass:ri,multi:!0,deps:[qe]},{provide:si,useClass:sa,multi:!0,deps:[qe]},_o,fo,go,{provide:hr,useExisting:_o},{provide:Nr,useClass:js},[]];var la=(()=>{class i{_doc;constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static \u0275fac=function(e){return new(e||i)(R(qe))};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var F="primary",Dn=Symbol("RouteTitle"),yo=class{params;constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let n=this.params[r];return Array.isArray(n)?n[0]:n}return null}getAll(r){if(this.has(r)){let n=this.params[r];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}};function It(i){return new yo(i)}function ha(i,r,n){let e=n.path.split("/");if(e.length>i.length||n.pathMatch==="full"&&(r.hasChildren()||e.length<i.length))return null;let t={};for(let o=0;o<e.length;o++){let a=e[o],d=i[o];if(a[0]===":")t[a.substring(1)]=d;else if(a!==d.path)return null}return{consumed:i.slice(0,e.length),posParams:t}}function Ws(i,r){if(i.length!==r.length)return!1;for(let n=0;n<i.length;++n)if(!Ke(i[n],r[n]))return!1;return!0}function Ke(i,r){let n=i?Mo(i):void 0,e=r?Mo(r):void 0;if(!n||!e||n.length!=e.length)return!1;let t;for(let o=0;o<n.length;o++)if(t=n[o],!_a(i[t],r[t]))return!1;return!0}function Mo(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function _a(i,r){if(Array.isArray(i)&&Array.isArray(r)){if(i.length!==r.length)return!1;let n=[...i].sort(),e=[...r].sort();return n.every((t,o)=>e[o]===t)}else return i===r}function Ca(i){return i.length>0?i[i.length-1]:null}function ut(i){return Zo(i)?i:xr(i)?De(Promise.resolve(i)):N(i)}var Us={exact:xa,subset:wa},va={exact:$s,subset:Bs,ignored:()=>!0};function ca(i,r,n){return Us[n.paths](i.root,r.root,n.matrixParams)&&va[n.queryParams](i.queryParams,r.queryParams)&&!(n.fragment==="exact"&&i.fragment!==r.fragment)}function $s(i,r){return Ke(i,r)}function xa(i,r,n){if(!Et(i.segments,r.segments)||!pi(i.segments,r.segments,n)||i.numberOfChildren!==r.numberOfChildren)return!1;for(let e in r.children)if(!i.children[e]||!xa(i.children[e],r.children[e],n))return!1;return!0}function Bs(i,r){return Object.keys(r).length<=Object.keys(i).length&&Object.keys(r).every(n=>_a(i[n],r[n]))}function wa(i,r,n){return ba(i,r,r.segments,n)}function ba(i,r,n,e){if(i.segments.length>n.length){let t=i.segments.slice(0,n.length);return!(!Et(t,n)||r.hasChildren()||!pi(t,n,e))}else if(i.segments.length===n.length){if(!Et(i.segments,n)||!pi(i.segments,n,e))return!1;for(let t in r.children)if(!i.children[t]||!wa(i.children[t],r.children[t],e))return!1;return!0}else{let t=n.slice(0,i.segments.length),o=n.slice(i.segments.length);return!Et(i.segments,t)||!pi(i.segments,t,e)||!i.children[F]?!1:ba(i.children[F],r,o,e)}}function pi(i,r,n){return r.every((e,t)=>va[n](i[t].parameters,e.parameters))}var Xe=class{root;queryParams;fragment;_queryParamMap;constructor(r=new Y([],{}),n={},e=null){this.root=r,this.queryParams=n,this.fragment=e}get queryParamMap(){return this._queryParamMap??=It(this.queryParams),this._queryParamMap}toString(){return Js.serialize(this)}},Y=class{segments;children;parent=null;constructor(r,n){this.segments=r,this.children=n,Object.values(n).forEach(e=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ui(this)}},wt=class{path;parameters;_parameterMap;constructor(r,n){this.path=r,this.parameters=n}get parameterMap(){return this._parameterMap??=It(this.parameters),this._parameterMap}toString(){return Ma(this)}};function Hs(i,r){return Et(i,r)&&i.every((n,e)=>Ke(n.parameters,r[e].parameters))}function Et(i,r){return i.length!==r.length?!1:i.every((n,e)=>n.path===r[e].path)}function Gs(i,r){let n=[];return Object.entries(i.children).forEach(([e,t])=>{e===F&&(n=n.concat(r(t,e)))}),Object.entries(i.children).forEach(([e,t])=>{e!==F&&(n=n.concat(r(t,e)))}),n}var An=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:()=>new jt,providedIn:"root"})}return i})(),jt=class{parse(r){let n=new So(r);return new Xe(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(r){let n=`/${wn(r.root,!0)}`,e=Ks(r.queryParams),t=typeof r.fragment=="string"?`#${Ys(r.fragment)}`:"";return`${n}${e}${t}`}},Js=new jt;function ui(i){return i.segments.map(r=>Ma(r)).join("/")}function wn(i,r){if(!i.hasChildren())return ui(i);if(r){let n=i.children[F]?wn(i.children[F],!1):"",e=[];return Object.entries(i.children).forEach(([t,o])=>{t!==F&&e.push(`${t}:${wn(o,!1)}`)}),e.length>0?`${n}(${e.join("//")})`:n}else{let n=Gs(i,(e,t)=>t===F?[wn(i.children[F],!1)]:[`${t}:${wn(e,!1)}`]);return Object.keys(i.children).length===1&&i.children[F]!=null?`${ui(i)}/${n[0]}`:`${ui(i)}/(${n.join("//")})`}}function ya(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ci(i){return ya(i).replace(/%3B/gi,";")}function Ys(i){return encodeURI(i)}function Po(i){return ya(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function mi(i){return decodeURIComponent(i)}function da(i){return mi(i.replace(/\+/g,"%20"))}function Ma(i){return`${Po(i.path)}${Qs(i.parameters)}`}function Qs(i){return Object.entries(i).map(([r,n])=>`;${Po(r)}=${Po(n)}`).join("")}function Ks(i){let r=Object.entries(i).map(([n,e])=>Array.isArray(e)?e.map(t=>`${ci(n)}=${ci(t)}`).join("&"):`${ci(n)}=${ci(e)}`).filter(n=>n);return r.length?`?${r.join("&")}`:""}var Zs=/^[^\/()?;#]+/;function vo(i){let r=i.match(Zs);return r?r[0]:""}var Xs=/^[^\/()?;=#]+/;function el(i){let r=i.match(Xs);return r?r[0]:""}var tl=/^[^=?&#]+/;function nl(i){let r=i.match(tl);return r?r[0]:""}var il=/^[^&#]+/;function ol(i){let r=i.match(il);return r?r[0]:""}var So=class{url;remaining;constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Y([],{}):new Y([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let e={};return this.peekStartsWith("(")&&(e=this.parseParens(!1)),(r.length>0||Object.keys(n).length>0)&&(e[F]=new Y(r,n)),e}parseSegment(){let r=vo(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new ae(4009,!1);return this.capture(r),new wt(mi(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let n=el(this.remaining);if(!n)return;this.capture(n);let e="";if(this.consumeOptional("=")){let t=vo(this.remaining);t&&(e=t,this.capture(e))}r[mi(n)]=mi(e)}parseQueryParam(r){let n=nl(this.remaining);if(!n)return;this.capture(n);let e="";if(this.consumeOptional("=")){let a=ol(this.remaining);a&&(e=a,this.capture(e))}let t=da(n),o=da(e);if(r.hasOwnProperty(t)){let a=r[t];Array.isArray(a)||(a=[a],r[t]=a),a.push(o)}else r[t]=o}parseParens(r){let n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let e=vo(this.remaining),t=this.remaining[e.length];if(t!=="/"&&t!==")"&&t!==";")throw new ae(4010,!1);let o;e.indexOf(":")>-1?(o=e.slice(0,e.indexOf(":")),this.capture(o),this.capture(":")):r&&(o=F);let a=this.parseChildren();n[o??F]=Object.keys(a).length===1&&a[F]?a[F]:new Y([],a),this.consumeOptional("//")}return n}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new ae(4011,!1)}};function Pa(i){return i.segments.length>0?new Y([],{[F]:i}):i}function Sa(i){let r={};for(let[e,t]of Object.entries(i.children)){let o=Sa(t);if(e===F&&o.segments.length===0&&o.hasChildren())for(let[a,d]of Object.entries(o.children))r[a]=d;else(o.segments.length>0||o.hasChildren())&&(r[e]=o)}let n=new Y(i.segments,r);return rl(n)}function rl(i){if(i.numberOfChildren===1&&i.children[F]){let r=i.children[F];return new Y(i.segments.concat(r.segments),r.children)}return i}function bt(i){return i instanceof Xe}function Oa(i,r,n=null,e=null){let t=ka(i);return Ea(t,r,n,e)}function ka(i){let r;function n(o){let a={};for(let m of o.children){let v=n(m);a[m.outlet]=v}let d=new Y(o.url,a);return o===i&&(r=d),d}let e=n(i.root),t=Pa(e);return r??t}function Ea(i,r,n,e){let t=i;for(;t.parent;)t=t.parent;if(r.length===0)return xo(t,t,t,n,e);let o=al(r);if(o.toRoot())return xo(t,t,new Y([],{}),n,e);let a=sl(o,t,i),d=a.processChildren?yn(a.segmentGroup,a.index,o.commands):Ia(a.segmentGroup,a.index,o.commands);return xo(t,a.segmentGroup,d,n,e)}function gi(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function Sn(i){return typeof i=="object"&&i!=null&&i.outlets}function xo(i,r,n,e,t){let o={};e&&Object.entries(e).forEach(([m,v])=>{o[m]=Array.isArray(v)?v.map(x=>`${x}`):`${v}`});let a;i===r?a=n:a=Ta(i,r,n);let d=Pa(Sa(a));return new Xe(d,o,t)}function Ta(i,r,n){let e={};return Object.entries(i.children).forEach(([t,o])=>{o===r?e[t]=n:e[t]=Ta(o,r,n)}),new Y(i.segments,e)}var fi=class{isAbsolute;numberOfDoubleDots;commands;constructor(r,n,e){if(this.isAbsolute=r,this.numberOfDoubleDots=n,this.commands=e,r&&e.length>0&&gi(e[0]))throw new ae(4003,!1);let t=e.find(Sn);if(t&&t!==Ca(e))throw new ae(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function al(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new fi(!0,0,i);let r=0,n=!1,e=i.reduce((t,o,a)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let d={};return Object.entries(o.outlets).forEach(([m,v])=>{d[m]=typeof v=="string"?v.split("/"):v}),[...t,{outlets:d}]}if(o.segmentPath)return[...t,o.segmentPath]}return typeof o!="string"?[...t,o]:a===0?(o.split("/").forEach((d,m)=>{m==0&&d==="."||(m==0&&d===""?n=!0:d===".."?r++:d!=""&&t.push(d))}),t):[...t,o]},[]);return new fi(n,r,e)}var Jt=class{segmentGroup;processChildren;index;constructor(r,n,e){this.segmentGroup=r,this.processChildren=n,this.index=e}};function sl(i,r,n){if(i.isAbsolute)return new Jt(r,!0,0);if(!n)return new Jt(r,!1,NaN);if(n.parent===null)return new Jt(n,!0,0);let e=gi(i.commands[0])?0:1,t=n.segments.length-1+e;return ll(n,t,i.numberOfDoubleDots)}function ll(i,r,n){let e=i,t=r,o=n;for(;o>t;){if(o-=t,e=e.parent,!e)throw new ae(4005,!1);t=e.segments.length}return new Jt(e,!1,t-o)}function cl(i){return Sn(i[0])?i[0].outlets:{[F]:i}}function Ia(i,r,n){if(i??=new Y([],{}),i.segments.length===0&&i.hasChildren())return yn(i,r,n);let e=dl(i,r,n),t=n.slice(e.commandIndex);if(e.match&&e.pathIndex<i.segments.length){let o=new Y(i.segments.slice(0,e.pathIndex),{});return o.children[F]=new Y(i.segments.slice(e.pathIndex),i.children),yn(o,0,t)}else return e.match&&t.length===0?new Y(i.segments,{}):e.match&&!i.hasChildren()?Oo(i,r,n):e.match?yn(i,0,t):Oo(i,r,n)}function yn(i,r,n){if(n.length===0)return new Y(i.segments,{});{let e=cl(n),t={};if(Object.keys(e).some(o=>o!==F)&&i.children[F]&&i.numberOfChildren===1&&i.children[F].segments.length===0){let o=yn(i.children[F],r,n);return new Y(i.segments,o.children)}return Object.entries(e).forEach(([o,a])=>{typeof a=="string"&&(a=[a]),a!==null&&(t[o]=Ia(i.children[o],r,a))}),Object.entries(i.children).forEach(([o,a])=>{e[o]===void 0&&(t[o]=a)}),new Y(i.segments,t)}}function dl(i,r,n){let e=0,t=r,o={match:!1,pathIndex:0,commandIndex:0};for(;t<i.segments.length;){if(e>=n.length)return o;let a=i.segments[t],d=n[e];if(Sn(d))break;let m=`${d}`,v=e<n.length-1?n[e+1]:null;if(t>0&&m===void 0)break;if(m&&v&&typeof v=="object"&&v.outlets===void 0){if(!ua(m,v,a))return o;e+=2}else{if(!ua(m,{},a))return o;e++}t++}return{match:!0,pathIndex:t,commandIndex:e}}function Oo(i,r,n){let e=i.segments.slice(0,r),t=0;for(;t<n.length;){let o=n[t];if(Sn(o)){let m=pl(o.outlets);return new Y(e,m)}if(t===0&&gi(n[0])){let m=i.segments[r];e.push(new wt(m.path,pa(n[0]))),t++;continue}let a=Sn(o)?o.outlets[F]:`${o}`,d=t<n.length-1?n[t+1]:null;a&&d&&gi(d)?(e.push(new wt(a,pa(d))),t+=2):(e.push(new wt(a,{})),t++)}return new Y(e,{})}function pl(i){let r={};return Object.entries(i).forEach(([n,e])=>{typeof e=="string"&&(e=[e]),e!==null&&(r[n]=Oo(new Y([],{}),0,e))}),r}function pa(i){let r={};return Object.entries(i).forEach(([n,e])=>r[n]=`${e}`),r}function ua(i,r,n){return i==n.path&&Ke(r,n.parameters)}var Mn="imperative",ge=(function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i})(ge||{}),Fe=class{id;url;constructor(r,n){this.id=r,this.url=n}},Rt=class extends Fe{type=ge.NavigationStart;navigationTrigger;restoredState;constructor(r,n,e="imperative",t=null){super(r,n),this.navigationTrigger=e,this.restoredState=t}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Je=class extends Fe{urlAfterRedirects;type=ge.NavigationEnd;constructor(r,n,e){super(r,n),this.urlAfterRedirects=e}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ee=(function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i[i.Aborted=4]="Aborted",i})(Ee||{}),On=(function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i})(On||{}),Ze=class extends Fe{reason;code;type=ge.NavigationCancel;constructor(r,n,e,t){super(r,n),this.reason=e,this.code=t}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},dt=class extends Fe{reason;code;type=ge.NavigationSkipped;constructor(r,n,e,t){super(r,n),this.reason=e,this.code=t}},Qt=class extends Fe{error;target;type=ge.NavigationError;constructor(r,n,e,t){super(r,n),this.error=e,this.target=t}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},kn=class extends Fe{urlAfterRedirects;state;type=ge.RoutesRecognized;constructor(r,n,e,t){super(r,n),this.urlAfterRedirects=e,this.state=t}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},hi=class extends Fe{urlAfterRedirects;state;type=ge.GuardsCheckStart;constructor(r,n,e,t){super(r,n),this.urlAfterRedirects=e,this.state=t}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},_i=class extends Fe{urlAfterRedirects;state;shouldActivate;type=ge.GuardsCheckEnd;constructor(r,n,e,t,o){super(r,n),this.urlAfterRedirects=e,this.state=t,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Ci=class extends Fe{urlAfterRedirects;state;type=ge.ResolveStart;constructor(r,n,e,t){super(r,n),this.urlAfterRedirects=e,this.state=t}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},vi=class extends Fe{urlAfterRedirects;state;type=ge.ResolveEnd;constructor(r,n,e,t){super(r,n),this.urlAfterRedirects=e,this.state=t}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},xi=class{route;type=ge.RouteConfigLoadStart;constructor(r){this.route=r}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},wi=class{route;type=ge.RouteConfigLoadEnd;constructor(r){this.route=r}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},bi=class{snapshot;type=ge.ChildActivationStart;constructor(r){this.snapshot=r}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},yi=class{snapshot;type=ge.ChildActivationEnd;constructor(r){this.snapshot=r}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Mi=class{snapshot;type=ge.ActivationStart;constructor(r){this.snapshot=r}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Pi=class{snapshot;type=ge.ActivationEnd;constructor(r){this.snapshot=r}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var En=class{},Kt=class{url;navigationBehaviorOptions;constructor(r,n){this.url=r,this.navigationBehaviorOptions=n}};function ul(i){return!(i instanceof En)&&!(i instanceof Kt)}function ml(i,r){return i.providers&&!i._injector&&(i._injector=ro(i.providers,r,`Route: ${i.path}`)),i._injector??r}function Ge(i){return i.outlet||F}function gl(i,r){let n=i.filter(e=>Ge(e)===r);return n.push(...i.filter(e=>Ge(e)!==r)),n}function en(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let r=i.parent;r;r=r.parent){let n=r.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}var Si=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return en(this.route?.snapshot)??this.rootInjector}constructor(r){this.rootInjector=r,this.children=new tn(this.rootInjector)}},tn=(()=>{class i{rootInjector;contexts=new Map;constructor(n){this.rootInjector=n}onChildOutletCreated(n,e){let t=this.getOrCreateContext(n);t.outlet=e,this.contexts.set(n,t)}onChildOutletDestroyed(n){let e=this.getContext(n);e&&(e.outlet=null,e.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let e=this.getContext(n);return e||(e=new Si(this.rootInjector),this.contexts.set(n,e)),e}getContext(n){return this.contexts.get(n)||null}static \u0275fac=function(e){return new(e||i)(R(At))};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Oi=class{_root;constructor(r){this._root=r}get root(){return this._root.value}parent(r){let n=this.pathFromRoot(r);return n.length>1?n[n.length-2]:null}children(r){let n=ko(r,this._root);return n?n.children.map(e=>e.value):[]}firstChild(r){let n=ko(r,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(r){let n=Eo(r,this._root);return n.length<2?[]:n[n.length-2].children.map(t=>t.value).filter(t=>t!==r)}pathFromRoot(r){return Eo(r,this._root).map(n=>n.value)}};function ko(i,r){if(i===r.value)return r;for(let n of r.children){let e=ko(i,n);if(e)return e}return null}function Eo(i,r){if(i===r.value)return[r];for(let n of r.children){let e=Eo(i,n);if(e.length)return e.unshift(r),e}return[]}var Le=class{value;children;constructor(r,n){this.value=r,this.children=n}toString(){return`TreeNode(${this.value})`}};function Gt(i){let r={};return i&&i.children.forEach(n=>r[n.value.outlet]=n),r}var Tn=class extends Oi{snapshot;constructor(r,n){super(r),this.snapshot=n,No(this,r)}toString(){return this.snapshot.toString()}};function ja(i){let r=fl(i),n=new Te([new wt("",{})]),e=new Te({}),t=new Te({}),o=new Te({}),a=new Te(""),d=new pt(n,e,o,a,t,F,i,r.root);return d.snapshot=r.root,new Tn(new Le(d,[]),r)}function fl(i){let r={},n={},e={},o=new Tt([],r,e,"",n,F,i,null,{});return new In("",new Le(o,[]))}var pt=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(r,n,e,t,o,a,d,m){this.urlSubject=r,this.paramsSubject=n,this.queryParamsSubject=e,this.fragmentSubject=t,this.dataSubject=o,this.outlet=a,this.component=d,this._futureSnapshot=m,this.title=this.dataSubject?.pipe(Q(v=>v[Dn]))??N(void 0),this.url=r,this.params=n,this.queryParams=e,this.fragment=t,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Q(r=>It(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Q(r=>It(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ki(i,r,n="emptyOnly"){let e,{routeConfig:t}=i;return r!==null&&(n==="always"||t?.path===""||!r.component&&!r.routeConfig?.loadComponent)?e={params:T(T({},r.params),i.params),data:T(T({},r.data),i.data),resolve:T(T(T(T({},i.data),r.data),t?.data),i._resolvedData)}:e={params:T({},i.params),data:T({},i.data),resolve:T(T({},i.data),i._resolvedData??{})},t&&Va(t)&&(e.resolve[Dn]=t.title),e}var Tt=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Dn]}constructor(r,n,e,t,o,a,d,m,v){this.url=r,this.params=n,this.queryParams=e,this.fragment=t,this.data=o,this.outlet=a,this.component=d,this.routeConfig=m,this._resolve=v}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=It(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=It(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(e=>e.toString()).join("/"),n=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${n}')`}},In=class extends Oi{url;constructor(r,n){super(n),this.url=r,No(this,n)}toString(){return Ra(this._root)}};function No(i,r){r.value._routerState=i,r.children.forEach(n=>No(i,n))}function Ra(i){let r=i.children.length>0?` { ${i.children.map(Ra).join(", ")} } `:"";return`${i.value}${r}`}function wo(i){if(i.snapshot){let r=i.snapshot,n=i._futureSnapshot;i.snapshot=n,Ke(r.queryParams,n.queryParams)||i.queryParamsSubject.next(n.queryParams),r.fragment!==n.fragment&&i.fragmentSubject.next(n.fragment),Ke(r.params,n.params)||i.paramsSubject.next(n.params),Ws(r.url,n.url)||i.urlSubject.next(n.url),Ke(r.data,n.data)||i.dataSubject.next(n.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function To(i,r){let n=Ke(i.params,r.params)&&Hs(i.url,r.url),e=!i.parent!=!r.parent;return n&&!e&&(!i.parent||To(i.parent,r.parent))}function Va(i){return typeof i.title=="string"||i.title===null}var Da=new _e(""),Nn=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=F;activateEvents=new ye;deactivateEvents=new ye;attachEvents=new ye;detachEvents=new ye;routerOutletData=Er();parentContexts=I(tn);location=I(_r);changeDetector=I(Jn);inputBinder=I(ji,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(n){if(n.name){let{firstChange:e,previousValue:t}=n.name;if(e)return;this.isTrackedInParentContexts(t)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(t)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ae(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ae(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ae(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,e){this.activated=n,this._activatedRoute=e,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,e){if(this.isActivated)throw new ae(4013,!1);this._activatedRoute=n;let t=this.location,a=n.snapshot.component,d=this.parentContexts.getOrCreateContext(this.name).children,m=new Io(n,d,t.injector,this.routerOutletData);this.activated=t.createComponent(a,{index:t.length,injector:m,environmentInjector:e}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(e){return new(e||i)};static \u0275dir=gn({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[rt]})}return i})(),Io=class{route;childContexts;parent;outletData;constructor(r,n,e,t){this.route=r,this.childContexts=n,this.parent=e,this.outletData=t}get(r,n){return r===pt?this.route:r===tn?this.childContexts:r===Da?this.outletData:this.parent.get(r,n)}},ji=new _e("");var Lo=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275cmp=B({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(e,t){e&1&&M(0,"router-outlet")},dependencies:[Nn],encapsulation:2})}return i})();function Fo(i){let r=i.children&&i.children.map(Fo),n=r?me(T({},i),{children:r}):T({},i);return!n.component&&!n.loadComponent&&(r||n.loadChildren)&&n.outlet&&n.outlet!==F&&(n.component=Lo),n}function hl(i,r,n){let e=jn(i,r._root,n?n._root:void 0);return new Tn(e,r)}function jn(i,r,n){if(n&&i.shouldReuseRoute(r.value,n.value.snapshot)){let e=n.value;e._futureSnapshot=r.value;let t=_l(i,r,n);return new Le(e,t)}else{if(i.shouldAttach(r.value)){let o=i.retrieve(r.value);if(o!==null){let a=o.route;return a.value._futureSnapshot=r.value,a.children=r.children.map(d=>jn(i,d)),a}}let e=Cl(r.value),t=r.children.map(o=>jn(i,o));return new Le(e,t)}}function _l(i,r,n){return r.children.map(e=>{for(let t of n.children)if(i.shouldReuseRoute(e.value,t.value.snapshot))return jn(i,e,t);return jn(i,e)})}function Cl(i){return new pt(new Te(i.url),new Te(i.params),new Te(i.queryParams),new Te(i.fragment),new Te(i.data),i.outlet,i.component,i)}var Zt=class{redirectTo;navigationBehaviorOptions;constructor(r,n){this.redirectTo=r,this.navigationBehaviorOptions=n}},Aa="ngNavigationCancelingError";function Ei(i,r){let{redirectTo:n,navigationBehaviorOptions:e}=bt(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,t=Na(!1,Ee.Redirect);return t.url=n,t.navigationBehaviorOptions=e,t}function Na(i,r){let n=new Error(`NavigationCancelingError: ${i||""}`);return n[Aa]=!0,n.cancellationCode=r,n}function vl(i){return La(i)&&bt(i.url)}function La(i){return!!i&&i[Aa]}var xl=(i,r,n,e)=>Q(t=>(new jo(r,t.targetRouterState,t.currentRouterState,n,e).activate(i),t)),jo=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(r,n,e,t,o){this.routeReuseStrategy=r,this.futureState=n,this.currState=e,this.forwardEvent=t,this.inputBindingEnabled=o}activate(r){let n=this.futureState._root,e=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,e,r),wo(this.futureState.root),this.activateChildRoutes(n,e,r)}deactivateChildRoutes(r,n,e){let t=Gt(n);r.children.forEach(o=>{let a=o.value.outlet;this.deactivateRoutes(o,t[a],e),delete t[a]}),Object.values(t).forEach(o=>{this.deactivateRouteAndItsChildren(o,e)})}deactivateRoutes(r,n,e){let t=r.value,o=n?n.value:null;if(t===o)if(t.component){let a=e.getContext(t.outlet);a&&this.deactivateChildRoutes(r,n,a.children)}else this.deactivateChildRoutes(r,n,e);else o&&this.deactivateRouteAndItsChildren(n,e)}deactivateRouteAndItsChildren(r,n){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,n):this.deactivateRouteAndOutlet(r,n)}detachAndStoreRouteSubtree(r,n){let e=n.getContext(r.value.outlet),t=e&&r.value.component?e.children:n,o=Gt(r);for(let a of Object.values(o))this.deactivateRouteAndItsChildren(a,t);if(e&&e.outlet){let a=e.outlet.detach(),d=e.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:a,route:r,contexts:d})}}deactivateRouteAndOutlet(r,n){let e=n.getContext(r.value.outlet),t=e&&r.value.component?e.children:n,o=Gt(r);for(let a of Object.values(o))this.deactivateRouteAndItsChildren(a,t);e&&(e.outlet&&(e.outlet.deactivate(),e.children.onOutletDeactivated()),e.attachRef=null,e.route=null)}activateChildRoutes(r,n,e){let t=Gt(n);r.children.forEach(o=>{this.activateRoutes(o,t[o.value.outlet],e),this.forwardEvent(new Pi(o.value.snapshot))}),r.children.length&&this.forwardEvent(new yi(r.value.snapshot))}activateRoutes(r,n,e){let t=r.value,o=n?n.value:null;if(wo(t),t===o)if(t.component){let a=e.getOrCreateContext(t.outlet);this.activateChildRoutes(r,n,a.children)}else this.activateChildRoutes(r,n,e);else if(t.component){let a=e.getOrCreateContext(t.outlet);if(this.routeReuseStrategy.shouldAttach(t.snapshot)){let d=this.routeReuseStrategy.retrieve(t.snapshot);this.routeReuseStrategy.store(t.snapshot,null),a.children.onOutletReAttached(d.contexts),a.attachRef=d.componentRef,a.route=d.route.value,a.outlet&&a.outlet.attach(d.componentRef,d.route.value),wo(d.route.value),this.activateChildRoutes(r,null,a.children)}else a.attachRef=null,a.route=t,a.outlet&&a.outlet.activateWith(t,a.injector),this.activateChildRoutes(r,null,a.children)}else this.activateChildRoutes(r,null,e)}},Ti=class{path;route;constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},Yt=class{component;route;constructor(r,n){this.component=r,this.route=n}};function wl(i,r,n){let e=i._root,t=r?r._root:null;return bn(e,t,n,[e.value])}function bl(i){let r=i.routeConfig?i.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:i,guards:r}}function nn(i,r){let n=Symbol(),e=r.get(i,n);return e===n?typeof i=="function"&&!rr(i)?i:r.get(i):e}function bn(i,r,n,e,t={canDeactivateChecks:[],canActivateChecks:[]}){let o=Gt(r);return i.children.forEach(a=>{yl(a,o[a.value.outlet],n,e.concat([a.value]),t),delete o[a.value.outlet]}),Object.entries(o).forEach(([a,d])=>Pn(d,n.getContext(a),t)),t}function yl(i,r,n,e,t={canDeactivateChecks:[],canActivateChecks:[]}){let o=i.value,a=r?r.value:null,d=n?n.getContext(i.value.outlet):null;if(a&&o.routeConfig===a.routeConfig){let m=Ml(a,o,o.routeConfig.runGuardsAndResolvers);m?t.canActivateChecks.push(new Ti(e)):(o.data=a.data,o._resolvedData=a._resolvedData),o.component?bn(i,r,d?d.children:null,e,t):bn(i,r,n,e,t),m&&d&&d.outlet&&d.outlet.isActivated&&t.canDeactivateChecks.push(new Yt(d.outlet.component,a))}else a&&Pn(r,d,t),t.canActivateChecks.push(new Ti(e)),o.component?bn(i,null,d?d.children:null,e,t):bn(i,null,n,e,t);return t}function Ml(i,r,n){if(typeof n=="function")return n(i,r);switch(n){case"pathParamsChange":return!Et(i.url,r.url);case"pathParamsOrQueryParamsChange":return!Et(i.url,r.url)||!Ke(i.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!To(i,r)||!Ke(i.queryParams,r.queryParams);case"paramsChange":default:return!To(i,r)}}function Pn(i,r,n){let e=Gt(i),t=i.value;Object.entries(e).forEach(([o,a])=>{t.component?r?Pn(a,r.children.getContext(o),n):Pn(a,null,n):Pn(a,r,n)}),t.component?r&&r.outlet&&r.outlet.isActivated?n.canDeactivateChecks.push(new Yt(r.outlet.component,t)):n.canDeactivateChecks.push(new Yt(null,t)):n.canDeactivateChecks.push(new Yt(null,t))}function Ln(i){return typeof i=="function"}function Pl(i){return typeof i=="boolean"}function Sl(i){return i&&Ln(i.canLoad)}function Ol(i){return i&&Ln(i.canActivate)}function kl(i){return i&&Ln(i.canActivateChild)}function El(i){return i&&Ln(i.canDeactivate)}function Tl(i){return i&&Ln(i.canMatch)}function Fa(i){return i instanceof Xo||i?.name==="EmptyError"}var di=Symbol("INITIAL_VALUE");function Xt(){return Ne(i=>Bi(i.map(r=>r.pipe(Dt(1),ir(di)))).pipe(Q(r=>{for(let n of r)if(n!==!0){if(n===di)return di;if(n===!1||Il(n))return n}return!0}),gt(r=>r!==di),Dt(1)))}function Il(i){return bt(i)||i instanceof Zt}function jl(i,r){return Ae(n=>{let{targetSnapshot:e,currentSnapshot:t,guards:{canActivateChecks:o,canDeactivateChecks:a}}=n;return a.length===0&&o.length===0?N(me(T({},n),{guardsResult:!0})):Rl(a,e,t,i).pipe(Ae(d=>d&&Pl(d)?Vl(e,o,i,r):N(d)),Q(d=>me(T({},n),{guardsResult:d})))})}function Rl(i,r,n,e){return De(i).pipe(Ae(t=>Fl(t.component,t.route,n,r,e)),ft(t=>t!==!0,!0))}function Vl(i,r,n,e){return De(r).pipe(Vt(t=>er(Al(t.route.parent,e),Dl(t.route,e),Ll(i,t.path,n),Nl(i,t.route,n))),ft(t=>t!==!0,!0))}function Dl(i,r){return i!==null&&r&&r(new Mi(i)),N(!0)}function Al(i,r){return i!==null&&r&&r(new bi(i)),N(!0)}function Nl(i,r,n){let e=r.routeConfig?r.routeConfig.canActivate:null;if(!e||e.length===0)return N(!0);let t=e.map(o=>qn(()=>{let a=en(r)??n,d=nn(o,a),m=Ol(d)?d.canActivate(r,i):$e(a,()=>d(r,i));return ut(m).pipe(ft())}));return N(t).pipe(Xt())}function Ll(i,r,n){let e=r[r.length-1],o=r.slice(0,r.length-1).reverse().map(a=>bl(a)).filter(a=>a!==null).map(a=>qn(()=>{let d=a.guards.map(m=>{let v=en(a.node)??n,x=nn(m,v),w=kl(x)?x.canActivateChild(e,i):$e(v,()=>x(e,i));return ut(w).pipe(ft())});return N(d).pipe(Xt())}));return N(o).pipe(Xt())}function Fl(i,r,n,e,t){let o=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!o||o.length===0)return N(!0);let a=o.map(d=>{let m=en(r)??t,v=nn(d,m),x=El(v)?v.canDeactivate(i,r,n,e):$e(m,()=>v(i,r,n,e));return ut(x).pipe(ft())});return N(a).pipe(Xt())}function zl(i,r,n,e){let t=r.canLoad;if(t===void 0||t.length===0)return N(!0);let o=t.map(a=>{let d=nn(a,i),m=Sl(d)?d.canLoad(r,n):$e(i,()=>d(r,n));return ut(m)});return N(o).pipe(Xt(),za(e))}function za(i){return Qo(he(r=>{if(typeof r!="boolean")throw Ei(i,r)}),Q(r=>r===!0))}function ql(i,r,n,e){let t=r.canMatch;if(!t||t.length===0)return N(!0);let o=t.map(a=>{let d=nn(a,i),m=Tl(d)?d.canMatch(r,n):$e(i,()=>d(r,n));return ut(m)});return N(o).pipe(Xt(),za(e))}var Rn=class{segmentGroup;constructor(r){this.segmentGroup=r||null}},Vn=class extends Error{urlTree;constructor(r){super(),this.urlTree=r}};function Ht(i){return pn(new Rn(i))}function Wl(i){return pn(new ae(4e3,!1))}function Ul(i){return pn(Na(!1,Ee.GuardRejected))}var Ro=class{urlSerializer;urlTree;constructor(r,n){this.urlSerializer=r,this.urlTree=n}lineralizeSegments(r,n){let e=[],t=n.root;for(;;){if(e=e.concat(t.segments),t.numberOfChildren===0)return N(e);if(t.numberOfChildren>1||!t.children[F])return Wl(`${r.redirectTo}`);t=t.children[F]}}applyRedirectCommands(r,n,e,t,o){return $l(n,t,o).pipe(Q(a=>{if(a instanceof Xe)throw new Vn(a);let d=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),r,e);if(a[0]==="/")throw new Vn(d);return d}))}applyRedirectCreateUrlTree(r,n,e,t){let o=this.createSegmentGroup(r,n.root,e,t);return new Xe(o,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(r,n){let e={};return Object.entries(r).forEach(([t,o])=>{if(typeof o=="string"&&o[0]===":"){let d=o.substring(1);e[t]=n[d]}else e[t]=o}),e}createSegmentGroup(r,n,e,t){let o=this.createSegments(r,n.segments,e,t),a={};return Object.entries(n.children).forEach(([d,m])=>{a[d]=this.createSegmentGroup(r,m,e,t)}),new Y(o,a)}createSegments(r,n,e,t){return n.map(o=>o.path[0]===":"?this.findPosParam(r,o,t):this.findOrReturn(o,e))}findPosParam(r,n,e){let t=e[n.path.substring(1)];if(!t)throw new ae(4001,!1);return t}findOrReturn(r,n){let e=0;for(let t of n){if(t.path===r.path)return n.splice(e),t;e++}return r}};function $l(i,r,n){if(typeof i=="string")return N(i);let e=i,{queryParams:t,fragment:o,routeConfig:a,url:d,outlet:m,params:v,data:x,title:w}=r;return ut($e(n,()=>e({params:v,data:x,queryParams:t,fragment:o,routeConfig:a,url:d,outlet:m,title:w})))}var Vo={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Bl(i,r,n,e,t){let o=qa(i,r,n);return o.matched?(e=ml(r,e),ql(e,r,n,t).pipe(Q(a=>a===!0?o:T({},Vo)))):N(o)}function qa(i,r,n){if(r.path==="**")return Hl(n);if(r.path==="")return r.pathMatch==="full"&&(i.hasChildren()||n.length>0)?T({},Vo):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};let t=(r.matcher||ha)(n,i,r);if(!t)return T({},Vo);let o={};Object.entries(t.posParams??{}).forEach(([d,m])=>{o[d]=m.path});let a=t.consumed.length>0?T(T({},o),t.consumed[t.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:t.consumed,remainingSegments:n.slice(t.consumed.length),parameters:a,positionalParamSegments:t.posParams??{}}}function Hl(i){return{matched:!0,parameters:i.length>0?Ca(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function ma(i,r,n,e){return n.length>0&&Yl(i,n,e)?{segmentGroup:new Y(r,Jl(e,new Y(n,i.children))),slicedSegments:[]}:n.length===0&&Ql(i,n,e)?{segmentGroup:new Y(i.segments,Gl(i,n,e,i.children)),slicedSegments:n}:{segmentGroup:new Y(i.segments,i.children),slicedSegments:n}}function Gl(i,r,n,e){let t={};for(let o of n)if(Ri(i,r,o)&&!e[Ge(o)]){let a=new Y([],{});t[Ge(o)]=a}return T(T({},e),t)}function Jl(i,r){let n={};n[F]=r;for(let e of i)if(e.path===""&&Ge(e)!==F){let t=new Y([],{});n[Ge(e)]=t}return n}function Yl(i,r,n){return n.some(e=>Ri(i,r,e)&&Ge(e)!==F)}function Ql(i,r,n){return n.some(e=>Ri(i,r,e))}function Ri(i,r,n){return(i.hasChildren()||r.length>0)&&n.pathMatch==="full"?!1:n.path===""}function Kl(i,r,n){return r.length===0&&!i.children[n]}var Do=class{};function Zl(i,r,n,e,t,o,a="emptyOnly"){return new Ao(i,r,n,e,t,a,o).recognize()}var Xl=31,Ao=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(r,n,e,t,o,a,d){this.injector=r,this.configLoader=n,this.rootComponentType=e,this.config=t,this.urlTree=o,this.paramsInheritanceStrategy=a,this.urlSerializer=d,this.applyRedirects=new Ro(this.urlSerializer,this.urlTree)}noMatchError(r){return new ae(4002,`'${r.segmentGroup}'`)}recognize(){let r=ma(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(Q(({children:n,rootSnapshot:e})=>{let t=new Le(e,n),o=new In("",t),a=Oa(e,[],this.urlTree.queryParams,this.urlTree.fragment);return a.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(a),{state:o,tree:a}}))}match(r){let n=new Tt([],Object.freeze({}),Object.freeze(T({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),F,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,r,F,n).pipe(Q(e=>({children:e,rootSnapshot:n})),St(e=>{if(e instanceof Vn)return this.urlTree=e.urlTree,this.match(e.urlTree.root);throw e instanceof Rn?this.noMatchError(e):e}))}processSegmentGroup(r,n,e,t,o){return e.segments.length===0&&e.hasChildren()?this.processChildren(r,n,e,o):this.processSegment(r,n,e,e.segments,t,!0,o).pipe(Q(a=>a instanceof Le?[a]:[]))}processChildren(r,n,e,t){let o=[];for(let a of Object.keys(e.children))a==="primary"?o.unshift(a):o.push(a);return De(o).pipe(Vt(a=>{let d=e.children[a],m=gl(n,a);return this.processSegmentGroup(r,m,d,a,t)}),nr((a,d)=>(a.push(...d),a)),Gi(null),tr(),Ae(a=>{if(a===null)return Ht(e);let d=Wa(a);return ec(d),N(d)}))}processSegment(r,n,e,t,o,a,d){return De(n).pipe(Vt(m=>this.processSegmentAgainstRoute(m._injector??r,n,m,e,t,o,a,d).pipe(St(v=>{if(v instanceof Rn)return N(null);throw v}))),ft(m=>!!m),St(m=>{if(Fa(m))return Kl(e,t,o)?N(new Do):Ht(e);throw m}))}processSegmentAgainstRoute(r,n,e,t,o,a,d,m){return Ge(e)!==a&&(a===F||!Ri(t,o,e))?Ht(t):e.redirectTo===void 0?this.matchSegmentAgainstRoute(r,t,e,o,a,m):this.allowRedirects&&d?this.expandSegmentAgainstRouteUsingRedirect(r,t,n,e,o,a,m):Ht(t)}expandSegmentAgainstRouteUsingRedirect(r,n,e,t,o,a,d){let{matched:m,parameters:v,consumedSegments:x,positionalParamSegments:w,remainingSegments:k}=qa(n,t,o);if(!m)return Ht(n);typeof t.redirectTo=="string"&&t.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Xl&&(this.allowRedirects=!1));let V=new Tt(o,v,Object.freeze(T({},this.urlTree.queryParams)),this.urlTree.fragment,ga(t),Ge(t),t.component??t._loadedComponent??null,t,fa(t)),$=ki(V,d,this.paramsInheritanceStrategy);return V.params=Object.freeze($.params),V.data=Object.freeze($.data),this.applyRedirects.applyRedirectCommands(x,t.redirectTo,w,V,r).pipe(Ne(pe=>this.applyRedirects.lineralizeSegments(t,pe)),Ae(pe=>this.processSegment(r,e,n,pe.concat(k),a,!1,d)))}matchSegmentAgainstRoute(r,n,e,t,o,a){let d=Bl(n,e,t,r,this.urlSerializer);return e.path==="**"&&(n.children={}),d.pipe(Ne(m=>m.matched?(r=e._injector??r,this.getChildConfig(r,e,t).pipe(Ne(({routes:v})=>{let x=e._loadedInjector??r,{parameters:w,consumedSegments:k,remainingSegments:V}=m,$=new Tt(k,w,Object.freeze(T({},this.urlTree.queryParams)),this.urlTree.fragment,ga(e),Ge(e),e.component??e._loadedComponent??null,e,fa(e)),re=ki($,a,this.paramsInheritanceStrategy);$.params=Object.freeze(re.params),$.data=Object.freeze(re.data);let{segmentGroup:pe,slicedSegments:ce}=ma(n,k,V,v);if(ce.length===0&&pe.hasChildren())return this.processChildren(x,v,pe,$).pipe(Q(ue=>new Le($,ue)));if(v.length===0&&ce.length===0)return N(new Le($,[]));let A=Ge(e)===o;return this.processSegment(x,v,pe,ce,A?F:o,!0,$).pipe(Q(ue=>new Le($,ue instanceof Le?[ue]:[])))}))):Ht(n)))}getChildConfig(r,n,e){return n.children?N({routes:n.children,injector:r}):n.loadChildren?n._loadedRoutes!==void 0?N({routes:n._loadedRoutes,injector:n._loadedInjector}):zl(r,n,e,this.urlSerializer).pipe(Ae(t=>t?this.configLoader.loadChildren(r,n).pipe(he(o=>{n._loadedRoutes=o.routes,n._loadedInjector=o.injector})):Ul(n))):N({routes:[],injector:r})}};function ec(i){i.sort((r,n)=>r.value.outlet===F?-1:n.value.outlet===F?1:r.value.outlet.localeCompare(n.value.outlet))}function tc(i){let r=i.value.routeConfig;return r&&r.path===""}function Wa(i){let r=[],n=new Set;for(let e of i){if(!tc(e)){r.push(e);continue}let t=r.find(o=>e.value.routeConfig===o.value.routeConfig);t!==void 0?(t.children.push(...e.children),n.add(t)):r.push(e)}for(let e of n){let t=Wa(e.children);r.push(new Le(e.value,t))}return r.filter(e=>!n.has(e))}function ga(i){return i.data||{}}function fa(i){return i.resolve||{}}function nc(i,r,n,e,t,o){return Ae(a=>Zl(i,r,n,e,a.extractedUrl,t,o).pipe(Q(({state:d,tree:m})=>me(T({},a),{targetSnapshot:d,urlAfterRedirects:m}))))}function ic(i,r){return Ae(n=>{let{targetSnapshot:e,guards:{canActivateChecks:t}}=n;if(!t.length)return N(n);let o=new Set(t.map(m=>m.route)),a=new Set;for(let m of o)if(!a.has(m))for(let v of Ua(m))a.add(v);let d=0;return De(a).pipe(Vt(m=>o.has(m)?oc(m,e,i,r):(m.data=ki(m,m.parent,i).resolve,N(void 0))),he(()=>d++),Ji(1),Ae(m=>d===a.size?N(n):ot))})}function Ua(i){let r=i.children.map(n=>Ua(n)).flat();return[i,...r]}function oc(i,r,n,e){let t=i.routeConfig,o=i._resolve;return t?.title!==void 0&&!Va(t)&&(o[Dn]=t.title),qn(()=>(i.data=ki(i,i.parent,n).resolve,rc(o,i,r,e).pipe(Q(a=>(i._resolvedData=a,i.data=T(T({},i.data),a),null)))))}function rc(i,r,n,e){let t=Mo(i);if(t.length===0)return N({});let o={};return De(t).pipe(Ae(a=>ac(i[a],r,n,e).pipe(ft(),he(d=>{if(d instanceof Zt)throw Ei(new jt,d);o[a]=d}))),Ji(1),Q(()=>o),St(a=>Fa(a)?ot:pn(a)))}function ac(i,r,n,e){let t=en(r)??e,o=nn(i,t),a=o.resolve?o.resolve(r,n):$e(t,()=>o(r,n));return ut(a)}function bo(i){return Ne(r=>{let n=i(r);return n?De(n).pipe(Q(()=>r)):N(r)})}var zo=(()=>{class i{buildTitle(n){let e,t=n.root;for(;t!==void 0;)e=this.getResolvedTitleForRoute(t)??e,t=t.children.find(o=>o.outlet===F);return e}getResolvedTitleForRoute(n){return n.data[Dn]}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:()=>I($a),providedIn:"root"})}return i})(),$a=(()=>{class i extends zo{title;constructor(n){super(),this.title=n}updateTitle(n){let e=this.buildTitle(n);e!==void 0&&this.title.setTitle(e)}static \u0275fac=function(e){return new(e||i)(R(la))};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),on=new _e("",{providedIn:"root",factory:()=>({})}),Fn=new _e(""),Ba=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=I(Or);loadComponent(n,e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return N(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let t=ut($e(n,()=>e.loadComponent())).pipe(Q(Ga),Ne(Ja),he(a=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=a}),Wn(()=>{this.componentLoaders.delete(e)})),o=new $i(t,()=>new it).pipe(Ui());return this.componentLoaders.set(e,o),o}loadChildren(n,e){if(this.childrenLoaders.get(e))return this.childrenLoaders.get(e);if(e._loadedRoutes)return N({routes:e._loadedRoutes,injector:e._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(e);let o=Ha(e,this.compiler,n,this.onLoadEndListener).pipe(Wn(()=>{this.childrenLoaders.delete(e)})),a=new $i(o,()=>new it).pipe(Ui());return this.childrenLoaders.set(e,a),a}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Ha(i,r,n,e){return ut($e(n,()=>i.loadChildren())).pipe(Q(Ga),Ne(Ja),Ae(t=>t instanceof Cr||Array.isArray(t)?N(t):De(r.compileModuleAsync(t))),Q(t=>{e&&e(i);let o,a,d=!1;return Array.isArray(t)?(a=t,d=!0):(o=t.create(n).injector,a=o.get(Fn,[],{optional:!0,self:!0}).flat()),{routes:a.map(Fo),injector:o}}))}function sc(i){return i&&typeof i=="object"&&"default"in i}function Ga(i){return sc(i)?i.default:i}function Ja(i){return N(i)}var Vi=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:()=>I(lc),providedIn:"root"})}return i})(),lc=(()=>{class i{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,e){return n}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Ya=new _e("");var Qa=new _e(""),Ka=(()=>{class i{currentNavigation=ie(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new it;transitionAbortWithErrorSubject=new it;configLoader=I(Ba);environmentInjector=I(At);destroyRef=I(lr);urlSerializer=I(An);rootContexts=I(tn);location=I(Qn);inputBindingEnabled=I(ji,{optional:!0})!==null;titleStrategy=I(zo);options=I(on,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=I(Vi);createViewTransition=I(Ya,{optional:!0});navigationErrorHandler=I(Qa,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>N(void 0);rootComponentType=null;destroyed=!1;constructor(){let n=t=>this.events.next(new xi(t)),e=t=>this.events.next(new wi(t));this.configLoader.onLoadEndListener=e,this.configLoader.onLoadStartListener=n,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(n){let e=++this.navigationId;_t(()=>{this.transitions?.next(me(T({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:e}))})}setupNavigations(n){return this.transitions=new Te(null),this.transitions.pipe(gt(e=>e!==null),Ne(e=>{let t=!1;return N(e).pipe(Ne(o=>{if(this.navigationId>e.id)return this.cancelNavigationTransition(e,"",Ee.SupersededByNewNavigation),ot;this.currentTransition=e,this.currentNavigation.set({id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,targetBrowserUrl:typeof o.extras.browserUrl=="string"?this.urlSerializer.parse(o.extras.browserUrl):o.extras.browserUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?me(T({},this.lastSuccessfulNavigation),{previousNavigation:null}):null,abort:()=>o.abortController.abort()});let a=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),d=o.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!a&&d!=="reload")return this.events.next(new dt(o.id,this.urlSerializer.serialize(o.rawUrl),"",On.IgnoredSameUrlNavigation)),o.resolve(!1),ot;if(this.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return N(o).pipe(Ne(m=>(this.events.next(new Rt(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),m.id!==this.navigationId?ot:Promise.resolve(m))),nc(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),he(m=>{e.targetSnapshot=m.targetSnapshot,e.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation.update(x=>(x.finalUrl=m.urlAfterRedirects,x));let v=new kn(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(v)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(o.currentRawUrl)){let{id:m,extractedUrl:v,source:x,restoredState:w,extras:k}=o,V=new Rt(m,this.urlSerializer.serialize(v),x,w);this.events.next(V);let $=ja(this.rootComponentType).snapshot;return this.currentTransition=e=me(T({},o),{targetSnapshot:$,urlAfterRedirects:v,extras:me(T({},k),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(re=>(re.finalUrl=v,re)),N(e)}else return this.events.next(new dt(o.id,this.urlSerializer.serialize(o.extractedUrl),"",On.IgnoredByUrlHandlingStrategy)),o.resolve(!1),ot}),he(o=>{let a=new hi(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),Q(o=>(this.currentTransition=e=me(T({},o),{guards:wl(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),e)),jl(this.environmentInjector,o=>this.events.next(o)),he(o=>{if(e.guardsResult=o.guardsResult,o.guardsResult&&typeof o.guardsResult!="boolean")throw Ei(this.urlSerializer,o.guardsResult);let a=new _i(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),gt(o=>o.guardsResult?!0:(this.cancelNavigationTransition(o,"",Ee.GuardRejected),!1)),bo(o=>{if(o.guards.canActivateChecks.length!==0)return N(o).pipe(he(a=>{let d=new Ci(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(d)}),Ne(a=>{let d=!1;return N(a).pipe(ic(this.paramsInheritanceStrategy,this.environmentInjector),he({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(a,"",Ee.NoDataFromResolver)}}))}),he(a=>{let d=new vi(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(d)}))}),bo(o=>{let a=d=>{let m=[];if(d.routeConfig?.loadComponent){let v=en(d)??this.environmentInjector;m.push(this.configLoader.loadComponent(v,d.routeConfig).pipe(he(x=>{d.component=x}),Q(()=>{})))}for(let v of d.children)m.push(...a(v));return m};return Bi(a(o.targetSnapshot.root)).pipe(Gi(null),Dt(1))}),bo(()=>this.afterPreactivation()),Ne(()=>{let{currentSnapshot:o,targetSnapshot:a}=e,d=this.createViewTransition?.(this.environmentInjector,o.root,a.root);return d?De(d).pipe(Q(()=>e)):N(e)}),Q(o=>{let a=hl(n.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return this.currentTransition=e=me(T({},o),{targetRouterState:a}),this.currentNavigation.update(d=>(d.targetRouterState=a,d)),e}),he(()=>{this.events.next(new En)}),xl(this.rootContexts,n.routeReuseStrategy,o=>this.events.next(o),this.inputBindingEnabled),Dt(1),Yi(new Ko(o=>{let a=e.abortController.signal,d=()=>o.next();return a.addEventListener("abort",d),()=>a.removeEventListener("abort",d)}).pipe(gt(()=>!t&&!e.targetRouterState),he(()=>{this.cancelNavigationTransition(e,e.abortController.signal.reason+"",Ee.Aborted)}))),he({next:o=>{t=!0,this.lastSuccessfulNavigation=_t(this.currentNavigation),this.events.next(new Je(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects))),this.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{t=!0}}),Yi(this.transitionAbortWithErrorSubject.pipe(he(o=>{throw o}))),Wn(()=>{t||this.cancelNavigationTransition(e,"",Ee.SupersededByNewNavigation),this.currentTransition?.id===e.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),St(o=>{if(this.destroyed)return e.resolve(!1),ot;if(t=!0,La(o))this.events.next(new Ze(e.id,this.urlSerializer.serialize(e.extractedUrl),o.message,o.cancellationCode)),vl(o)?this.events.next(new Kt(o.url,o.navigationBehaviorOptions)):e.resolve(!1);else{let a=new Qt(e.id,this.urlSerializer.serialize(e.extractedUrl),o,e.targetSnapshot??void 0);try{let d=$e(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(d instanceof Zt){let{message:m,cancellationCode:v}=Ei(this.urlSerializer,d);this.events.next(new Ze(e.id,this.urlSerializer.serialize(e.extractedUrl),m,v)),this.events.next(new Kt(d.redirectTo,d.navigationBehaviorOptions))}else throw this.events.next(a),o}catch(d){this.options.resolveNavigationPromiseOnError?e.resolve(!1):e.reject(d)}}return ot}))}))}cancelNavigationTransition(n,e,t){let o=new Ze(n.id,this.urlSerializer.serialize(n.extractedUrl),e,t);this.events.next(o),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),e=_t(this.currentNavigation),t=e?.targetBrowserUrl??e?.extractedUrl;return n.toString()!==t?.toString()&&!e?.extras.skipLocationChange}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function cc(i){return i!==Mn}var Za=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:()=>I(dc),providedIn:"root"})}return i})(),Ii=class{shouldDetach(r){return!1}store(r,n){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,n){return r.routeConfig===n.routeConfig}},dc=(()=>{class i extends Ii{static \u0275fac=(()=>{let n;return function(t){return(n||(n=Zi(i)))(t||i)}})();static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Xa=(()=>{class i{urlSerializer=I(An);options=I(on,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=I(Qn);urlHandlingStrategy=I(Vi);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Xe;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:n,initialUrl:e,targetBrowserUrl:t}){let o=n!==void 0?this.urlHandlingStrategy.merge(n,e):e,a=t??o;return a instanceof Xe?this.urlSerializer.serialize(a):a}commitTransition({targetRouterState:n,finalUrl:e,initialUrl:t}){e&&n?(this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(e,t),this.routerState=n):this.rawUrlTree=t}routerState=ja(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:n}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n??this.rawUrlTree)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:()=>I(pc),providedIn:"root"})}return i})(),pc=(()=>{class i extends Xa{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(e=>{e.type==="popstate"&&setTimeout(()=>{n(e.url,e.state,"popstate")})})}handleRouterEvent(n,e){n instanceof Rt?this.updateStateMemento():n instanceof dt?this.commitTransition(e):n instanceof kn?this.urlUpdateStrategy==="eager"&&(e.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(e),e)):n instanceof En?(this.commitTransition(e),this.urlUpdateStrategy==="deferred"&&!e.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(e),e)):n instanceof Ze&&n.code!==Ee.SupersededByNewNavigation&&n.code!==Ee.Redirect?this.restoreHistory(e):n instanceof Qt?this.restoreHistory(e,!0):n instanceof Je&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,{extras:e,id:t}){let{replaceUrl:o,state:a}=e;if(this.location.isCurrentPathEqualTo(n)||o){let d=this.browserPageId,m=T(T({},a),this.generateNgRouterState(t,d));this.location.replaceState(n,"",m)}else{let d=T(T({},a),this.generateNgRouterState(t,this.browserPageId+1));this.location.go(n,"",d)}}restoreHistory(n,e=!1){if(this.canceledNavigationResolution==="computed"){let t=this.browserPageId,o=this.currentPageId-t;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===n.finalUrl&&o===0&&(this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(e&&this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,e){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:e}:{navigationId:n}}static \u0275fac=(()=>{let n;return function(t){return(n||(n=Zi(i)))(t||i)}})();static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function qo(i,r){i.events.pipe(gt(n=>n instanceof Je||n instanceof Ze||n instanceof Qt||n instanceof dt),Q(n=>n instanceof Je||n instanceof dt?0:(n instanceof Ze?n.code===Ee.Redirect||n.code===Ee.SupersededByNewNavigation:!1)?2:1),gt(n=>n!==2),Dt(1)).subscribe(()=>{r()})}var uc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},mc={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},fe=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=I(vr);stateManager=I(Xa);options=I(on,{optional:!0})||{};pendingTasks=I(cr);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=I(Ka);urlSerializer=I(An);location=I(Qn);urlHandlingStrategy=I(Vi);injector=I(At);_events=new it;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=I(Za);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=I(Fn,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!I(ji,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Yo;subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(e=>{try{let t=this.navigationTransitions.currentTransition,o=_t(this.navigationTransitions.currentNavigation);if(t!==null&&o!==null){if(this.stateManager.handleRouterEvent(e,o),e instanceof Ze&&e.code!==Ee.Redirect&&e.code!==Ee.SupersededByNewNavigation)this.navigated=!0;else if(e instanceof Je)this.navigated=!0;else if(e instanceof Kt){let a=e.navigationBehaviorOptions,d=this.urlHandlingStrategy.merge(e.url,t.currentRawUrl),m=T({browserUrl:t.extras.browserUrl,info:t.extras.info,skipLocationChange:t.extras.skipLocationChange,replaceUrl:t.extras.replaceUrl||this.urlUpdateStrategy==="eager"||cc(t.source)},a);this.scheduleNavigation(d,Mn,null,m,{resolve:t.resolve,reject:t.reject,promise:t.promise})}}ul(e)&&this._events.next(e)}catch(t){this.navigationTransitions.transitionAbortWithErrorSubject.next(t)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Mn,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,e,t)=>{this.navigateToSyncWithBrowser(n,t,e)})}navigateToSyncWithBrowser(n,e,t){let o={replaceUrl:!0},a=t?.navigationId?t:null;if(t){let m=T({},t);delete m.navigationId,delete m.\u0275routerPageId,Object.keys(m).length!==0&&(o.state=m)}let d=this.parseUrl(n);this.scheduleNavigation(d,e,a,o).catch(m=>{this.disposed||this.injector.get(Un)(m)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return _t(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(Fo),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,e={}){let{relativeTo:t,queryParams:o,fragment:a,queryParamsHandling:d,preserveFragment:m}=e,v=m?this.currentUrlTree.fragment:a,x=null;switch(d??this.options.defaultQueryParamsHandling){case"merge":x=T(T({},this.currentUrlTree.queryParams),o);break;case"preserve":x=this.currentUrlTree.queryParams;break;default:x=o||null}x!==null&&(x=this.removeEmptyProps(x));let w;try{let k=t?t.snapshot:this.routerState.snapshot.root;w=ka(k)}catch{(typeof n[0]!="string"||n[0][0]!=="/")&&(n=[]),w=this.currentUrlTree.root}return Ea(w,n,x,v??null)}navigateByUrl(n,e={skipLocationChange:!1}){let t=bt(n)?n:this.parseUrl(n),o=this.urlHandlingStrategy.merge(t,this.rawUrlTree);return this.scheduleNavigation(o,Mn,null,e)}navigate(n,e={skipLocationChange:!1}){return gc(n),this.navigateByUrl(this.createUrlTree(n,e),e)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.console.warn(or(4018,!1)),this.urlSerializer.parse("/")}}isActive(n,e){let t;if(e===!0?t=T({},uc):e===!1?t=T({},mc):t=e,bt(n))return ca(this.currentUrlTree,n,t);let o=this.parseUrl(n);return ca(this.currentUrlTree,o,t)}removeEmptyProps(n){return Object.entries(n).reduce((e,[t,o])=>(o!=null&&(e[t]=o),e),{})}scheduleNavigation(n,e,t,o,a){if(this.disposed)return Promise.resolve(!1);let d,m,v;a?(d=a.resolve,m=a.reject,v=a.promise):v=new Promise((w,k)=>{d=w,m=k});let x=this.pendingTasks.add();return qo(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(x))}),this.navigationTransitions.handleNavigationRequest({source:e,restoredState:t,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:o,resolve:d,reject:m,promise:v,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),v.catch(w=>Promise.reject(w))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function gc(i){for(let r=0;r<i.length;r++)if(i[r]==null)throw new ae(4008,!1)}var rn=(()=>{class i{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=ie(null);get href(){return _t(this.reactiveHref)}set href(n){this.reactiveHref.set(n)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new it;applicationErrorHandler=I(Un);options=I(on,{optional:!0});constructor(n,e,t,o,a,d){this.router=n,this.route=e,this.tabIndexAttribute=t,this.renderer=o,this.el=a,this.locationStrategy=d,this.reactiveHref.set(I(new kr("href"),{optional:!0}));let m=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=m==="a"||m==="area"||!!(typeof customElements=="object"&&customElements.get(m)?.observedAttributes?.includes?.("href")),this.isAnchorElement?this.setTabIndexIfNotOnNativeEl("0"):this.subscribeToNavigationEventsIfNecessary()}subscribeToNavigationEventsIfNecessary(){if(this.subscription!==void 0||!this.isAnchorElement)return;let n=this.preserveFragment,e=t=>t==="merge"||t==="preserve";n||=e(this.queryParamsHandling),n||=!this.queryParamsHandling&&!e(this.options?.defaultQueryParamsHandling),n&&(this.subscription=this.router.events.subscribe(t=>{t instanceof Je&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(n){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&(this.updateHref(),this.subscribeToNavigationEventsIfNecessary()),this.onChanges.next(this)}routerLinkInput=null;set routerLink(n){n==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(bt(n)?this.routerLinkInput=n:this.routerLinkInput=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0"))}onClick(n,e,t,o,a){let d=this.urlTree;if(d===null||this.isAnchorElement&&(n!==0||e||t||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let m={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(d,m)?.catch(v=>{this.applicationErrorHandler(v)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let n=this.urlTree;this.reactiveHref.set(n!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n))??"":null)}applyAttributeValue(n,e){let t=this.renderer,o=this.el.nativeElement;e!==null?t.setAttribute(o,n,e):t.removeAttribute(o,n)}get urlTree(){return this.routerLinkInput===null?null:bt(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(e){return new(e||i)(L(fe),L(pt),dr("tabindex"),L(oo),L(Xi),L(Rr))};static \u0275dir=gn({type:i,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(e,t){e&1&&_("click",function(a){return t.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),e&2&&Me("href",t.reactiveHref(),mr)("target",t.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Yn],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Yn],replaceUrl:[2,"replaceUrl","replaceUrl",Yn],routerLink:"routerLink"},features:[rt]})}return i})(),Wo=(()=>{class i{router;element;renderer;cdr;link;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new ye;constructor(n,e,t,o,a){this.router=n,this.element=e,this.renderer=t,this.cdr=o,this.link=a,this.routerEventsSubscription=n.events.subscribe(d=>{d instanceof Je&&this.update()})}ngAfterContentInit(){N(this.links.changes,N(null)).pipe(Hi()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let n=[...this.links.toArray(),this.link].filter(e=>!!e).map(e=>e.onChanges);this.linkInputChangesSubscription=De(n).pipe(Hi()).subscribe(e=>{this._isActive!==this.isLinkActive(this.router)(e)&&this.update()})}set routerLinkActive(n){let e=Array.isArray(n)?n:n.split(" ");this.classes=e.filter(t=>!!t)}ngOnChanges(n){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let n=this.hasActiveLinks();this.classes.forEach(e=>{n?this.renderer.addClass(this.element.nativeElement,e):this.renderer.removeClass(this.element.nativeElement,e)}),n&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==n&&(this._isActive=n,this.cdr.markForCheck(),this.isActiveChange.emit(n))})}isLinkActive(n){let e=hc(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return t=>{let o=t.urlTree;return o?n.isActive(o,e):!1}}hasActiveLinks(){let n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.links.some(n)}static \u0275fac=function(e){return new(e||i)(L(fe),L(Xi),L(oo),L(Jn),L(rn,8))};static \u0275dir=gn({type:i,selectors:[["","routerLinkActive",""]],contentQueries:function(e,t,o){if(e&1&&Mr(o,rn,5),e&2){let a;lt(a=ct())&&(t.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[rt]})}return i})();function hc(i){return!!i.paths}var _c=new _e("");function Uo(i,...r){return ar([{provide:Fn,multi:!0,useValue:i},[],{provide:pt,useFactory:Cc,deps:[fe]},{provide:wr,multi:!0,useFactory:vc},r.map(n=>n.\u0275providers)])}function Cc(i){return i.routerState.root}function vc(){let i=I(Qi);return r=>{let n=i.get(br);if(r!==n.components[0])return;let e=i.get(fe),t=i.get(xc);i.get(wc)===1&&e.initialNavigation(),i.get(bc,null,{optional:!0})?.setUpPreloading(),i.get(_c,null,{optional:!0})?.init(),e.resetRootComponentType(n.componentTypes[0]),t.closed||(t.next(),t.complete(),t.unsubscribe())}}var xc=new _e("",{factory:()=>new it}),wc=new _e("",{providedIn:"root",factory:()=>1});var bc=new _e("");var Di=(()=>{let r=class r{constructor(){this.collapsedSubject=new Te(!1),this.collapsed$=this.collapsedSubject.asObservable()}toggle(){this.collapsedSubject.next(!this.collapsedSubject.value)}setCollapsed(e){this.collapsedSubject.next(e)}isCollapsed(){return this.collapsedSubject.value}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var yc=()=>({exact:!1});function Mc(i,r){if(i&1&&(s(0,"div",9),M(1,"lucide-icon",6),l()),i&2){let n=u();c(),g("img",n.Building2)("size",24)}}function Pc(i,r){i&1&&(s(0,"span",10),p(1,"ResourceFlow"),l())}function Sc(i,r){if(i&1&&(s(0,"span",14),p(1),l()),i&2){let n=u().$implicit;c(),j(n.label)}}function Oc(i,r){if(i&1&&(s(0,"a",11)(1,"div",12),M(2,"lucide-icon",6),l(),b(3,Sc,2,1,"span",13),l()),i&2){let n=r.$implicit,e=u();g("routerLink",n.route)("routerLinkActiveOptions",Sr(6,yc))("title",e.isCollapsed?n.label:""),c(2),g("img",n.icon)("size",20),c(),g("ngIf",!e.isCollapsed)}}var ts=(()=>{let r=class r{constructor(e){this.sidebarService=e,this.isCollapsed=!1,this.LayoutDashboard=Jr,this.Calendar=Fr,this.FolderKanban=Hr,this.Users=xt,this.Building2=Ft,this.Settings=Qr,this.ChevronLeft=qr,this.ChevronRight=vt,this.Gauge=Gr,this.Layers=Ut,this.Flag=Br,this.User=$t,this.navigationItems=[{label:"Tableau de bord",icon:this.LayoutDashboard},{label:"Capacit\xE9",icon:this.Gauge,route:"/capacite"},{label:"Plan Global",icon:this.Calendar,route:"/plan-globale"},{label:"Projets",icon:this.FolderKanban,route:"/projets"},{label:"Jalons",icon:this.Flag,route:"/jalons"},{label:"Ressources",icon:this.Users,route:"/ressources"},{label:"Organisation",icon:this.Building2,route:"/organisation"},{label:"Param\xE8tres",icon:this.Settings,route:"/settings"},{label:"Profil",icon:this.User,route:"/profile"}]}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.sidebarService.setCollapsed(this.isCollapsed)}};r.\u0275fac=function(t){return new(t||r)(L(Di))},r.\u0275cmp=B({type:r,selectors:[["app-sidebar-navigation"]],decls:9,vars:8,consts:[[1,"sidebar"],[1,"sidebar-header"],[1,"logo-container"],["class","logo-icon",4,"ngIf"],["class","logo-text",4,"ngIf"],[1,"toggle-btn",3,"click","title"],[3,"img","size"],[1,"nav-items"],["class","nav-item","routerLinkActive","active",3,"routerLink","routerLinkActiveOptions","title",4,"ngFor","ngForOf"],[1,"logo-icon"],[1,"logo-text"],["routerLinkActive","active",1,"nav-item",3,"routerLink","routerLinkActiveOptions","title"],[1,"nav-item-icon"],["class","nav-item-label",4,"ngIf"],[1,"nav-item-label"]],template:function(t,o){t&1&&(s(0,"nav",0)(1,"div",1)(2,"div",2),b(3,Mc,2,2,"div",3)(4,Pc,2,0,"span",4),l(),s(5,"button",5),_("click",function(){return o.toggleSidebar()}),M(6,"lucide-icon",6),l()(),s(7,"div",7),b(8,Oc,4,7,"a",8),l()()),t&2&&(U("collapsed",o.isCollapsed),c(3),g("ngIf",!o.isCollapsed),c(),g("ngIf",!o.isCollapsed),c(),g("title",o.isCollapsed?"Expand sidebar":"Collapse sidebar"),c(),g("img",o.isCollapsed?o.ChevronRight:o.ChevronLeft)("size",20),c(2),g("ngForOf",o.navigationItems))},dependencies:[G,Ce,X,K,de,rn,Wo],styles:[".sidebar[_ngcontent-%COMP%]{position:fixed;left:0;top:0;height:100vh;background:#fff;border-right:1px solid #e5e7eb;transition:width .3s cubic-bezier(.4,0,.2,1);width:256px;display:flex;flex-direction:column;z-index:1000}.sidebar.collapsed[_ngcontent-%COMP%]{width:80px}.sidebar-header[_ngcontent-%COMP%]{padding:20px 16px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between;min-height:72px}.logo-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex:1;min-width:0}.logo-icon[_ngcontent-%COMP%]{width:40px;height:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;flex-shrink:0}.logo-text[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#111827;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.toggle-btn[_ngcontent-%COMP%]{width:28px;height:28px;border:none;background:#f3f4f6;border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease;flex-shrink:0;color:#6b7280}.toggle-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb;color:#374151}.sidebar.collapsed[_ngcontent-%COMP%]   .toggle-btn[_ngcontent-%COMP%]{margin-left:auto}.nav-items[_ngcontent-%COMP%]{padding:16px 12px;flex:1;overflow-y:auto}.nav-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;margin-bottom:4px;border-radius:8px;cursor:pointer;transition:all .2s ease;text-decoration:none;color:#4b5563;position:relative}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]{justify-content:center;padding:12px}.nav-item[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#111827}.nav-item.active[_ngcontent-%COMP%]{background:#4f46e5;color:#fff}.nav-item.active[_ngcontent-%COMP%]:hover{background:#4338ca}.nav-item-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-shrink:0}.nav-item-label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.sidebar.collapsed[_ngcontent-%COMP%]   .nav-item-label[_ngcontent-%COMP%]{display:none}.nav-items[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.nav-items[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.nav-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:3px}.nav-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}"]});let i=r;return i})();var yt=(()=>{let r=class r{constructor(e){this.supabase=e,this._societesCache=null,this._departementsCache=null,this._servicesCache=null,this._equipesCache=null,this._rolesCache=null,this._personnesCache=null}clearCache(){this._societesCache=null,this._departementsCache=null,this._servicesCache=null,this._equipesCache=null,this._rolesCache=null,this._personnesCache=null}getAllSocietes(){return C(this,null,function*(){if(this._societesCache)return this._societesCache;let{data:e,error:t}=yield this.supabase.client.from("societes").select("*").order("nom");if(t)throw t;return this._societesCache=e||[],this._societesCache})}createSociete(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("societes").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}getAllDepartements(){return C(this,null,function*(){if(this._departementsCache)return this._departementsCache;let{data:e,error:t}=yield this.supabase.client.from("departements").select("*").order("nom");if(t)throw t;return this._departementsCache=e||[],this._departementsCache})}createDepartement(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("departements").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}getAllServices(){return C(this,null,function*(){if(this._servicesCache)return this._servicesCache;let{data:e,error:t}=yield this.supabase.client.from("services").select("*").order("nom");if(t)throw t;return this._servicesCache=e||[],this._servicesCache})}createService(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("services").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}getAllEquipes(){return C(this,null,function*(){if(this._equipesCache)return this._equipesCache;let{data:e,error:t}=yield this.supabase.client.from("equipes").select("*").order("nom");if(t)throw t;return this._equipesCache=e||[],this._equipesCache})}createEquipe(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("equipes").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}getAllRoles(){return C(this,null,function*(){if(this._rolesCache)return this._rolesCache;let{data:e,error:t}=yield this.supabase.client.from("roles").select("*").order("nom");if(t)throw t;return this._rolesCache=e||[],this._rolesCache})}createRole(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("roles").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updateRole(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("roles").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteRole(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("roles").delete().eq("id",e);if(t)throw t;this.clearCache()})}getAllPersonnes(){return C(this,null,function*(){if(this._personnesCache)return this._personnesCache;let{data:e,error:t}=yield this.supabase.client.from("personnes").select("*").order("nom");if(t)throw t;return this._personnesCache=e||[],this._personnesCache})}createPersonne(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("personnes").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}deletePersonne(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("personnes").delete().eq("id",e);if(t)throw t;this.clearCache()})}updatePersonne(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("personnes").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}addRoleToPersonne(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("personne_roles").insert([{personne_id:e,role_id:t}]);if(o)throw o;this.clearCache()})}updateSociete(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("societes").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteSociete(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("societes").delete().eq("id",e);if(t)throw t;this.clearCache()})}updateDepartement(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("departements").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteDepartement(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("departements").delete().eq("id",e);if(t)throw t;this.clearCache()})}updateService(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("services").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteService(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("services").delete().eq("id",e);if(t)throw t;this.clearCache()})}updateEquipe(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("equipes").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteEquipe(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("equipes").delete().eq("id",e);if(t)throw t;this.clearCache()})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var Ni=(()=>{let r=class r{constructor(e){this.supabase=e,this._rolesCache=null,this._attachmentsCache=null}clearCache(){this._rolesCache=null,this._attachmentsCache=null}getAllRoles(){return C(this,null,function*(){if(this._rolesCache)return this._rolesCache;let{data:e,error:t}=yield this.supabase.client.from("roles").select("*").order("nom",{ascending:!0});if(t)throw t;return this._rolesCache=e||[],this._rolesCache})}getAllRoleAttachments(){return C(this,null,function*(){if(this._attachmentsCache)return this._attachmentsCache;let{data:e,error:t}=yield this.supabase.client.from("role_attachments").select("*");if(t)throw t;return this._attachmentsCache=e||[],this._attachmentsCache})}getRole(e){return C(this,null,function*(){return(yield this.getAllRoles()).find(o=>o.id===e)||null})}getIdServiceListFromRoleId(e){return C(this,null,function*(){return(yield this.getAllRoleAttachments()).filter(o=>o.role_id===e&&o.id_service!==void 0&&o.id_service!==null).map(o=>o.id_service)})}getServiceIdUUIDListFromRoleId(e){return C(this,null,function*(){return(yield this.getAllRoleAttachments()).filter(o=>o.role_id===e&&o.service_id!==void 0&&o.service_id!==null).map(o=>o.service_id)})}getAttachmentsByRoleId(e){return C(this,null,function*(){return(yield this.getAllRoleAttachments()).filter(o=>o.role_id===e)})}createRole(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("roles").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updateRole(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("roles").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteRole(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("roles").delete().eq("id",e);if(t)throw t;this.clearCache()})}createRoleAttachment(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("role_attachments").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}deleteRoleAttachment(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("role_attachments").delete().eq("id",e);if(t)throw t;this.clearCache()})}updateRoleAttachment(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("role_attachments").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var $o=(i,r)=>r.id;function kc(i,r){if(i&1&&(s(0,"span"),p(1),l(),p(2," \u2022 ")),i&2){let n=u().$implicit;c(),j(n.code)}}function Ec(i,r){if(i&1&&(p(0," \u2022 "),s(1,"span"),p(2),l()),i&2){let n=u().$implicit,e=u(2);c(2),j(e.getRoleServiceName(n.id))}}function Tc(i,r){if(i&1){let n=E();s(0,"div",29)(1,"button",30),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openEditModal("role",t))}),M(2,"lucide-icon",31),p(3," Modifier"),l(),s(4,"button",32),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.handleDelete("role",t.id))}),M(5,"lucide-icon",33),p(6," Supprimer"),l()()}i&2&&(c(2),g("size",14),c(3),g("size",14))}function Ic(i,r){if(i&1){let n=E();s(0,"div",19),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.openEditModal("role",t))}),s(1,"div",20)(2,"div",21),p(3),l(),s(4,"div",22)(5,"div",23),p(6),l(),s(7,"div",24),q(8,kc,3,1),s(9,"span"),p(10),l(),q(11,Ec,3,1),l()()(),s(12,"div",25)(13,"div",26),_("click",function(t){return f(n),h(t.stopPropagation())}),s(14,"button",27),_("click",function(t){let o=f(n).$implicit,a=u(2);return h(a.toggleMenu(o.id,t))}),M(15,"lucide-icon",28),l(),q(16,Tc,7,2,"div",29),l()()()}if(i&2){let n=r.$implicit,e=u(2);c(2),oe("background-color",n.color||"#3b82f6"),c(),y(" ",n.nom.charAt(0).toUpperCase()," "),c(3),j(n.nom),c(2),W(n.code?8:-1),c(2),y("",n.jours_par_semaine,"j/sem"),c(),W(e.getRoleServiceName(n.id)?11:-1),c(4),g("size",20),c(),W(e.activeMenuId===n.id?16:-1)}}function jc(i,r){i&1&&(s(0,"div",18),p(1,"Aucun r\xF4le trouv\xE9."),l())}function Rc(i,r){if(i&1&&Pe(0,Ic,17,9,"div",17,$o,!1,jc,2,0,"div",18),i&2){let n=u();Se(n.filteredRoles())}}function Vc(i,r){if(i&1&&(s(0,"span"),p(1),l(),p(2," \u2022 ")),i&2){let n=u().$implicit;c(),j(n.email)}}function Dc(i,r){if(i&1&&(p(0," \u2022 "),s(1,"span"),p(2),l()),i&2){let n=u().$implicit,e=u(2);c(2),j(e.getServiceName(n.service_id))}}function Ac(i,r){if(i&1){let n=E();s(0,"div",29)(1,"button",30),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openEditModal("personne",t))}),M(2,"lucide-icon",31),p(3," Modifier"),l(),s(4,"button",32),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.handleDelete("personne",t.id))}),M(5,"lucide-icon",33),p(6," Supprimer"),l()()}i&2&&(c(2),g("size",14),c(3),g("size",14))}function Nc(i,r){if(i&1){let n=E();s(0,"div",19),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.openEditModal("personne",t))}),s(1,"div",20)(2,"div",34),p(3),l(),s(4,"div",22)(5,"div",23),p(6),l(),s(7,"div",24),q(8,Vc,3,1),s(9,"span"),p(10),l(),q(11,Dc,3,1),l()()(),s(12,"div",25)(13,"div",26),_("click",function(t){return f(n),h(t.stopPropagation())}),s(14,"button",27),_("click",function(t){let o=f(n).$implicit,a=u(2);return h(a.toggleMenu(o.id,t))}),M(15,"lucide-icon",28),l(),q(16,Ac,7,2,"div",29),l()()()}if(i&2){let n=r.$implicit,e=u(2);c(2),oe("background-color",n.color||"#10b981"),c(),y(" ",e.getPersonneInitials(n)," "),c(3),Ie("",n.prenom," ",n.nom),c(2),W(n.email?8:-1),c(2),y("",n.jours_par_semaine,"j/sem"),c(),W(e.getServiceName(n.service_id)?11:-1),c(4),g("size",20),c(),W(e.activeMenuId===n.id?16:-1)}}function Lc(i,r){i&1&&(s(0,"div",18),p(1,"Aucune personne trouv\xE9e."),l())}function Fc(i,r){if(i&1&&Pe(0,Nc,17,10,"div",17,$o,!1,Lc,2,0,"div",18),i&2){let n=u();Se(n.filteredPersonnes())}}function zc(i,r){if(i&1){let n=E();s(0,"div",40)(1,"label"),p(2,"Pr\xE9nom"),l(),s(3,"input",56),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.prenom,t)||(o.formData.prenom=t),h(t)}),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.prenom)}}function qc(i,r){if(i&1){let n=E();s(0,"div",42)(1,"label"),p(2,"Email"),l(),s(3,"input",57),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.email,t)||(o.formData.email=t),h(t)}),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.email)}}function Wc(i,r){if(i&1){let n=E();s(0,"div",40)(1,"label"),p(2,"Code"),l(),s(3,"input",58),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.code,t)||(o.formData.code=t),h(t)}),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.code)}}function Uc(i,r){if(i&1&&(s(0,"option",45),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom)}}function $c(i,r){if(i&1){let n=E();s(0,"div",59),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.selectColor(t))}),l()}if(i&2){let n=r.$implicit,e=u(2);oe("background-color",n),U("active",e.formData.color===n)}}function Bc(i,r){i&1&&M(0,"lucide-icon",10),i&2&&g("size",16)}function Hc(i,r){if(i&1&&M(0,"div",60),i&2){let n=u(2);oe("background-color",n.formData.color)}}function Gc(i,r){if(i&1){let n=E();s(0,"div",52)(1,"input",61),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.color,t)||(o.formData.color=t),h(t)}),l(),s(2,"input",62),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.color,t)||(o.formData.color=t),h(t)}),l()()}if(i&2){let n=u(2);c(),P("ngModel",n.formData.color),c(),P("ngModel",n.formData.color)}}function Jc(i,r){if(i&1){let n=E();s(0,"div",35),_("click",function(){f(n);let t=u();return h(t.closeModal())}),s(1,"div",36),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"h2",37),p(3),l(),s(4,"form",38),_("submit",function(t){f(n);let o=u();return t.preventDefault(),h(o.handleSave())}),s(5,"div",39),q(6,zc,4,1,"div",40),s(7,"div",40)(8,"label"),p(9,"Nom"),l(),s(10,"input",41),O("ngModelChange",function(t){f(n);let o=u();return S(o.formData.nom,t)||(o.formData.nom=t),h(t)}),l()(),q(11,qc,4,1,"div",42),q(12,Wc,4,1,"div",40),s(13,"div",40)(14,"label"),p(15,"Service rattach\xE9"),l(),s(16,"select",43),O("ngModelChange",function(t){f(n);let o=u();return S(o.formData.service_id,t)||(o.formData.service_id=t),h(t)}),s(17,"option",44),p(18,"Aucun service"),l(),Pe(19,Uc,2,2,"option",45,$o),l()(),s(21,"div",40)(22,"label"),p(23,"Jours / Semaine"),l(),s(24,"input",46),O("ngModelChange",function(t){f(n);let o=u();return S(o.formData.jours_par_semaine,t)||(o.formData.jours_par_semaine=t),h(t)}),l()(),s(25,"div",42)(26,"label"),p(27,"Couleur"),l(),s(28,"div",47),Pe(29,$c,1,4,"div",48,Nt),s(31,"div",49),_("click",function(){f(n);let t=u();return h(t.isCustomColor=!t.isCustomColor)}),b(32,Bc,1,1,"lucide-icon",50)(33,Hc,1,2,"div",51),l()(),q(34,Gc,3,2,"div",52),l()(),s(35,"div",53)(36,"button",54),_("click",function(){f(n);let t=u();return h(t.closeModal())}),p(37,"Annuler"),l(),s(38,"button",55),p(39),l()()()()()}if(i&2){let n=u();c(3),Ie("",n.isEditing?"Modifier":"Ajouter"," ",n.activeTab==="role"?"un R\xF4le":"une Personne"),c(3),W(n.activeTab==="personne"?6:-1),c(4),P("ngModel",n.formData.nom),g("placeholder",n.activeTab==="role"?"Ex: D\xE9veloppeur Senior":"Ex: Dupont"),c(),W(n.activeTab==="personne"?11:-1),c(),W(n.activeTab==="role"?12:-1),c(4),P("ngModel",n.formData.service_id),c(3),Se(n.services),c(5),P("ngModel",n.formData.jours_par_semaine),c(5),Se(n.predefinedColors),c(2),U("active",n.isCustomColor),c(),g("ngIf",!n.isCustomColor),c(),g("ngIf",n.isCustomColor),c(),W(n.isCustomColor?34:-1),c(5),j(n.isEditing?"Mettre \xE0 jour":"Cr\xE9er")}}var Yc=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Be({type:r}),r.\u0275inj=Ue({imports:[K.pick({Building2:Ft,Layers:Ut,Box:Xn,Users:xt,MoreVertical:zt,Plus:He,Edit:ti,Trash2:ni,Search:Yr,Check:zr,X:Kr,ChevronDown:Ct,User:$t}),K]});let i=r;return i})(),Li=(()=>{let r=class r{constructor(e,t){this.resourceService=e,this.rolesService=t,this.resourceCreated=new ye,this.activeTab="role",this.searchQuery="",this.activeMenuId=null,this.roles=[],this.personnes=[],this.services=[],this.roleAttachments=[],this.showModal=!1,this.isEditing=!1,this.editingId=null,this.formData=this.resetFormData(),this.predefinedColors=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],this.isCustomColor=!1,window.addEventListener("click",()=>this.activeMenuId=null)}ngOnInit(){return C(this,null,function*(){yield this.loadData()})}loadData(){return C(this,null,function*(){try{this.roles=yield this.rolesService.getAllRoles(),this.personnes=yield this.resourceService.getAllPersonnes(),this.services=yield this.resourceService.getAllServices(),this.roleAttachments=yield this.rolesService.getAllRoleAttachments()}catch(e){console.error("Error loading resources:",e)}})}resetFormData(){return{nom:"",prenom:"",email:"",jours_par_semaine:5,code:"",color:"#3b82f6",service_id:""}}filteredRoles(){return this.roles.filter(e=>e.nom.toLowerCase().includes(this.searchQuery.toLowerCase())||e.code&&e.code.toLowerCase().includes(this.searchQuery.toLowerCase()))}filteredPersonnes(){return this.personnes.filter(e=>e.nom.toLowerCase().includes(this.searchQuery.toLowerCase())||e.prenom.toLowerCase().includes(this.searchQuery.toLowerCase()))}getPersonneInitials(e){return e.prenom&&!e.nom?e.prenom.charAt(0).toUpperCase():e.nom&&!e.prenom?e.nom.charAt(0).toUpperCase():!e.prenom&&!e.nom?"?":(e.prenom.charAt(0)+e.nom.charAt(0)).toUpperCase()}getServiceName(e){return e&&this.services.find(t=>t.id===e)?.nom||""}getRoleServiceName(e){let t=this.roleAttachments.find(o=>o.role_id===e);return t?this.getServiceName(t.service_id):""}toggleMenu(e,t){t.stopPropagation(),this.activeMenuId=this.activeMenuId===e?null:e}openCreateModal(){this.isEditing=!1,this.editingId=null,this.formData=this.resetFormData(),this.isCustomColor=!1,this.showModal=!0}openEditModal(e,t){return C(this,null,function*(){if(this.isEditing=!0,this.editingId=t.id,this.formData=me(T({},t),{service_id:""}),e==="role"){let o=this.roleAttachments.find(a=>a.role_id===t.id);o&&(this.formData.service_id=o.service_id||"")}else this.formData.service_id=t.service_id||"";this.isCustomColor=!this.predefinedColors.includes(this.formData.color),this.showModal=!0,this.activeMenuId=null})}closeModal(){this.showModal=!1}selectColor(e){this.formData.color=e,this.isCustomColor=!1}handleSave(){return C(this,null,function*(){try{let e=this.services.find(a=>a.id===this.formData.service_id),t=e?.id_service||null,o=this.formData.service_id||null;if(this.activeTab==="role"){let a={nom:this.formData.nom,code:this.formData.code,jours_par_semaine:this.formData.jours_par_semaine,color:this.formData.color},d;this.isEditing&&this.editingId?d=yield this.rolesService.updateRole(this.editingId,a):d=yield this.rolesService.createRole(a);let m=this.roleAttachments.find(v=>v.role_id===d.id);if(o){let v={role_id:d.id,service_id:o,id_service:t,societe_id:e?.societe_id||null,departement_id:e?.departement_id||null};m?yield this.rolesService.updateRoleAttachment(m.id,v):yield this.rolesService.createRoleAttachment(v)}else m&&(yield this.rolesService.updateRoleAttachment(m.id,{service_id:null,id_service:null,societe_id:null,departement_id:null}))}else{let a={nom:this.formData.nom,prenom:this.formData.prenom||"",email:this.formData.email,jours_par_semaine:this.formData.jours_par_semaine,color:this.formData.color,service_id:o,id_service:t};this.isEditing&&this.editingId?yield this.resourceService.updatePersonne(this.editingId,a):yield this.resourceService.createPersonne(a)}this.closeModal(),yield this.loadData(),this.resourceCreated.emit()}catch(e){console.error("Error saving resource:",e)}})}handleDelete(e,t){return C(this,null,function*(){if(confirm("\xCAtes-vous s\xFBr de vouloir supprimer cette ressource ?"))try{e==="role"?yield this.rolesService.deleteRole(t):yield this.resourceService.deletePersonne(t),yield this.loadData(),this.resourceCreated.emit()}catch(o){console.error("Error deleting resource:",o)}})}};r.\u0275fac=function(t){return new(t||r)(L(yt),L(Ni))},r.\u0275cmp=B({type:r,selectors:[["app-resource-manager"]],outputs:{resourceCreated:"resourceCreated"},decls:25,vars:12,consts:[[1,"resource-manager"],[1,"view-header"],[1,"title-group"],[1,"view-title"],[1,"view-subtitle"],[1,"header-actions"],[1,"search-container"],["name","search",1,"search-icon",3,"size"],["type","text","placeholder","Rechercher par nom ou code...",1,"search-input",3,"ngModelChange","ngModel"],[1,"btn-create",3,"click"],["name","plus",3,"size"],[1,"tabs"],[1,"tab-btn",3,"click"],["name","layers",3,"size"],["name","users",3,"size"],[1,"resource-list"],[1,"modal-overlay"],[1,"resource-card"],[1,"empty-state"],[1,"resource-card",3,"click"],[1,"card-left"],[1,"avatar","role"],[1,"resource-info"],[1,"resource-name"],[1,"resource-meta"],[1,"card-right"],[1,"kebab-menu-container",3,"click"],[1,"kebab-btn",3,"click"],["name","more-vertical",3,"size"],[1,"menu-dropdown"],[3,"click"],["name","edit",3,"size"],[1,"delete-btn",3,"click"],["name","trash2",3,"size"],[1,"avatar","personne"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-title"],[3,"submit"],[1,"form-grid"],[1,"form-group"],["type","text","name","nom","required","",3,"ngModelChange","ngModel","placeholder"],[1,"form-group","full-width"],["name","service_id",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["type","number","name","jours_par_semaine","step","0.5","min","0.5","max","7","required","",3,"ngModelChange","ngModel"],[1,"color-palette"],[1,"color-swatch",3,"background-color","active"],[1,"color-swatch","custom-trigger",3,"click"],["name","plus",3,"size",4,"ngIf"],["class","custom-preview",3,"background-color",4,"ngIf"],[1,"custom-color-input-wrapper"],[1,"modal-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-confirm"],["type","text","name","prenom","placeholder","Ex: Jean","required","",3,"ngModelChange","ngModel"],["type","email","name","email","placeholder","jean.dupont@exemple.com",3,"ngModelChange","ngModel"],["type","text","name","code","placeholder","Ex: DEV-SEN",3,"ngModelChange","ngModel"],[1,"color-swatch",3,"click"],[1,"custom-preview"],["type","color","name","customColor",1,"color-input",3,"ngModelChange","ngModel"],["type","text","name","customColorText","placeholder","#HEXCODE",1,"color-hex-input",3,"ngModelChange","ngModel"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),p(4,"Ressources"),l(),s(5,"p",4),p(6,"G\xE9rez vos \xE9quipes et collaborateurs"),l()(),s(7,"div",5)(8,"div",6),M(9,"lucide-icon",7),s(10,"input",8),O("ngModelChange",function(d){return S(o.searchQuery,d)||(o.searchQuery=d),d}),l()(),s(11,"button",9),_("click",function(){return o.openCreateModal()}),M(12,"lucide-icon",10),p(13),l()()(),s(14,"div",11)(15,"button",12),_("click",function(){return o.activeTab="role"}),M(16,"lucide-icon",13),p(17," R\xF4les "),l(),s(18,"button",12),_("click",function(){return o.activeTab="personne"}),M(19,"lucide-icon",14),p(20," Personnes "),l()(),s(21,"div",15),q(22,Rc,3,1)(23,Fc,3,1),l(),q(24,Jc,40,15,"div",16),l()),t&2&&(c(9),g("size",18),c(),P("ngModel",o.searchQuery),c(2),g("size",18),c(),y(" Ajouter ",o.activeTab==="role"?"un R\xF4le":"une Personne"," "),c(2),U("active",o.activeTab==="role"),c(),g("size",18),c(2),U("active",o.activeTab==="personne"),c(),g("size",18),c(3),W(o.activeTab==="role"?22:23),c(2),W(o.showModal?24:-1))},dependencies:[G,X,Z,we,Re,Ve,ee,Qe,je,te,ve,be,Bt,Zr,ne,xe,Yc,de],styles:[".resource-manager[_ngcontent-%COMP%]{padding:20px;background:#f5f7fa;min-height:100vh;font-family:Inter,sans-serif}.view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:32px;gap:24px}.view-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#1e293b;margin:0}.view-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#64748b;margin:4px 0 0;font-weight:500}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.search-container[_ngcontent-%COMP%]{position:relative;width:320px}.search-icon[_ngcontent-%COMP%]{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#94a3b8;pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px 8px 36px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;transition:all .2s;background:#fff;color:#1e293b}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.btn-create[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#3b82f6;color:#fff;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;font-size:14px}.btn-create[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-1px)}.btn-create[_ngcontent-%COMP%]:active{transform:translateY(0)}.tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:24px;background:#f3f4f6;padding:6px;border-radius:14px;width:fit-content}.tab-btn[_ngcontent-%COMP%]{padding:10px 24px;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;color:#6b7280;display:flex;align-items:center;gap:8px;transition:all .2s;background:transparent}.tab-btn.active[_ngcontent-%COMP%]{background:#fff;color:#111827;box-shadow:0 1px 3px #0000001a}.tab-btn[_ngcontent-%COMP%]:hover:not(.active){color:#374151}.resource-list[_ngcontent-%COMP%]{display:grid;gap:16px}.resource-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;transition:all .2s;cursor:pointer}.resource-card[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 4px 12px #0000000d}.card-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;flex-shrink:0}.resource-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px}.resource-name[_ngcontent-%COMP%]{font-weight:700;color:#111827;font-size:16px}.resource-meta[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;font-weight:500}.kebab-menu-container[_ngcontent-%COMP%]{position:relative}.kebab-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;padding:8px;border-radius:8px;color:#9ca3af;display:flex;transition:all .2s}.kebab-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.menu-dropdown[_ngcontent-%COMP%]{position:absolute;right:0;top:100%;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 10px 15px -3px #0000001a;padding:6px;min-width:160px;z-index:50;display:flex;flex-direction:column;gap:2px;margin-top:4px}.menu-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:10px 12px;text-align:left;cursor:pointer;font-size:14px;color:#374151;width:100%;display:flex;align-items:center;gap:10px;border-radius:8px;font-weight:500}.menu-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f3f4f6}.menu-dropdown[_ngcontent-%COMP%]   button.delete-btn[_ngcontent-%COMP%]{color:#ef4444}.menu-dropdown[_ngcontent-%COMP%]   button.delete-btn[_ngcontent-%COMP%]:hover{background:#fee2e2}.empty-state[_ngcontent-%COMP%]{padding:48px;text-align:center;color:#9ca3af;font-size:15px;background:#fff;border-radius:16px;border:2px dashed #e5e7eb}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:100;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:32px;width:100%;max-width:540px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000040}.modal-title[_ngcontent-%COMP%]{font-size:24px;font-weight:800;color:#111827;margin-bottom:16px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-group.full-width[_ngcontent-%COMP%]{grid-column:span 2}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:12px 14px;border:1px solid #d1d5db;border-radius:10px;font-size:15px;color:#111827;transition:all .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3b82f6;outline:none;box-shadow:0 0 0 3px #3b82f61a}.color-palette[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:4px}.color-swatch[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:8px;cursor:pointer;transition:all .2s;border:2px solid transparent}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.color-swatch.active[_ngcontent-%COMP%]{border-color:#111827;box-shadow:0 0 0 2px #fff,0 0 0 4px #111827}.color-input[_ngcontent-%COMP%]{width:60px;height:40px;padding:2px;cursor:pointer;border-radius:8px;border:1px solid #d1d5db}.color-hex-input[_ngcontent-%COMP%]{flex:1;text-transform:uppercase}.custom-trigger[_ngcontent-%COMP%]{background:#f3f4f6;border:2px dashed #d1d5db;display:flex;align-items:center;justify-content:center;color:#6b7280}.custom-trigger.active[_ngcontent-%COMP%]{border:2px solid #111827;background:#fff;color:#111827}.custom-preview[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:6px}.custom-color-input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-top:16px;padding:12px;background:#f9fafb;border-radius:12px;border:1px solid #e5e7eb}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:32px}.btn-cancel[_ngcontent-%COMP%]{padding:12px 24px;background:#fff;border:1px solid #d1d5db;border-radius:12px;font-weight:600;color:#374151;cursor:pointer}.btn-confirm[_ngcontent-%COMP%]{padding:12px 24px;background:#3b82f6;border:none;border-radius:12px;font-weight:600;color:#fff;cursor:pointer}.btn-confirm[_ngcontent-%COMP%]:hover{background:#2563eb}"]});let i=r;return i})();var an=(()=>{let r=class r{constructor(e){this.supabase=e}getWeekStart(e){let t=new Date(e),o=t.getDay(),a=t.getDate()-o+(o===0?-6:1);return new Date(t.setDate(a))}getWeekNumber(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),o=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-o);let a=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-a.getTime())/864e5+1)/7)}isCurrentWeek(e){let t=new Date,o=this.getWeekStart(t);return this.formatWeekStart(e)===this.formatWeekStart(o)}formatWeekStart(e){return e.toISOString().split("T")[0]}getCapacites(e){return C(this,null,function*(){let t=this.supabase.client.from("capacites").select("*");e?.roleId&&(t=t.eq("role_id",e.roleId)),e?.personneId&&(t=t.eq("personne_id",e.personneId)),e?.equipeId&&(t=t.eq("equipe_id",e.equipeId)),e?.serviceId&&(t=t.eq("service_id",e.serviceId)),e?.departementId&&(t=t.eq("departement_id",e.departementId)),e?.societeId&&(t=t.eq("societe_id",e.societeId));let{data:o,error:a}=yield t.order("semaine_debut");if(a)throw a;return o||[]})}setCapacite(e){return C(this,null,function*(){let t=yield this.findExistingCapacite(e);if(t){let{data:o,error:a}=yield this.supabase.client.from("capacites").update({capacite:e.capacite}).eq("id",t.id).select().single();if(a)throw a;return o}else{let{data:o,error:a}=yield this.supabase.client.from("capacites").insert([e]).select().single();if(a)throw a;return o}})}findExistingCapacite(e){return C(this,null,function*(){let t=this.supabase.client.from("capacites").select("*").eq("semaine_debut",e.semaine_debut);e.role_id&&(t=t.eq("role_id",e.role_id)),e.personne_id&&(t=t.eq("personne_id",e.personne_id)),e.equipe_id&&(t=t.eq("equipe_id",e.equipe_id)),e.service_id&&(t=t.eq("service_id",e.service_id)),e.departement_id&&(t=t.eq("departement_id",e.departement_id)),e.societe_id&&(t=t.eq("societe_id",e.societe_id));let{data:o,error:a}=yield t.maybeSingle();if(a)throw a;return o})}setCapaciteForWeeks(e,t,o){return C(this,null,function*(){let a=e.map(d=>{let m={semaine_debut:this.formatWeekStart(d),capacite:t,role_id:o.roleId,personne_id:o.personneId,equipe_id:o.equipeId,service_id:o.serviceId,departement_id:o.departementId,societe_id:o.societeId};return this.setCapacite(m)});yield Promise.all(a)})}getCharges(e){return C(this,null,function*(){let t=this.supabase.client.from("charges").select("*");e&&(t=t.eq("projet_id",e));let{data:o,error:a}=yield t.order("semaine_debut");if(a)throw a;return o||[]})}createCharge(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("charges").insert([e]).select().single();if(o)throw o;return t})}updateCharge(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("charges").update(t).eq("id",e).select().single();if(a)throw a;return o})}deleteCharge(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("charges").delete().eq("id",e);if(t)throw t})}getJalons(e){return C(this,null,function*(){let t=this.supabase.client.from("jalons").select("*");e&&(t=t.eq("projet_id",e));let{data:o,error:a}=yield t.order("date_jalon");if(a)throw a;return o||[]})}createJalon(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("jalons").insert([e]).select().single();if(o)throw o;return t})}calculateDisponible(e,t){return e-t}calculateJoursCharges(e,t,o){return e*t*o}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var tt=(()=>{let r=class r{constructor(e){this.supabase=e,this._projetsCache=null,this._equipeProjetLinksCache=null}clearCache(){this._projetsCache=null,this._equipeProjetLinksCache=null}getAllProjets(){return C(this,null,function*(){if(this._projetsCache)return this._projetsCache;let{data:e,error:t}=yield this.supabase.client.from("projets").select("*").order("created_at",{ascending:!1});if(t)throw t;return this._projetsCache=e||[],this._projetsCache})}getProjet(e){return C(this,null,function*(){if(this._projetsCache){let a=this._projetsCache.find(d=>d.id===e)||null;if(a)return a}let{data:t,error:o}=yield this.supabase.client.from("projets").select("*").eq("id",e).maybeSingle();if(o)throw o;return t})}getProjetIdUUID(e){return C(this,null,function*(){if(this._projetsCache){let a=this._projetsCache.find(d=>d.id_projet===e)||null;if(a)return a.id}let{data:t,error:o}=yield this.supabase.client.from("projets").select("id").eq("id_projet",e).single();if(o)throw o;return t.id})}createProjet(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("projets").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updateProjet(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("projets").update(me(T({},t),{updated_at:new Date().toISOString()})).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteProjet(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("projets").delete().eq("id",e);if(t)throw t;this.clearCache()})}calculateRAF(e){return e.chiffrage_previsionnel-e.temps_consomme}getAllEquipeProjetLinks(){return C(this,null,function*(){if(this._equipeProjetLinksCache)return this._equipeProjetLinksCache;let{data:e,error:t}=yield this.supabase.client.from("equipes_projets").select("*");if(t)throw t;return this._equipeProjetLinksCache=e||[],this._equipeProjetLinksCache})}linkProjectToTeam(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("equipes_projets").insert({projet_id:e,equipe_id:t});if(o)throw o;this.clearCache()})}unlinkProjectFromTeam(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("equipes_projets").delete().eq("projet_id",e).eq("equipe_id",t);if(o)throw o;this.clearCache()})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function Qc(i,r){if(i&1&&(s(0,"div",24)(1,"div",25),p(2),l(),s(3,"div",26),p(4),l()()),i&2){let n=r.$implicit,e=u();U("current-week",e.isCurrentWeek(n)),c(2),j(e.formatWeekHeader(n)),c(2),y("S",e.getWeekNumber(n))}}function Kc(i,r){if(i&1&&(s(0,"div",34),p(1),l()),i&2){let n=r.$implicit;g("title",n.nom),c(),y(" \u{1F4CD} ",n.nom," ")}}function Zc(i,r){if(i&1&&(s(0,"div",32),b(1,Kc,2,2,"div",33),l()),i&2){let n=r.$implicit,e=u(2);c(),g("ngForOf",e.getJalonsForWeek(n))}}function Xc(i,r){if(i&1&&(s(0,"div",27)(1,"div",28),p(2,"Jalons"),l(),s(3,"div",29),b(4,Zc,2,1,"div",30),l(),M(5,"div",31),l()),i&2){let n=u();c(4),g("ngForOf",n.displayedWeeks)}}function ed(i,r){if(i&1&&(s(0,"span"),p(1),l()),i&2){let n=u(2).$implicit;c(),y(" \u2022 ",n.projet.chef_projet)}}function td(i,r){if(i&1&&(s(0,"div",40)(1,"span"),p(2),l(),b(3,ed,2,1,"span",41),l()),i&2){let n=u().$implicit;c(2),j(n.projet.code_projet),c(),g("ngIf",n.projet.chef_projet)}}function nd(i,r){if(i&1&&(s(0,"div",47),p(1),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u();c(),y(" Cap: ",t.getCapacite(e,n)," ")}}function id(i,r){if(i&1&&(s(0,"div",48),p(1),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u();c(),y(" Chg: ",t.getCharge(e,n)," ")}}function od(i,r){if(i&1&&(s(0,"div",49),p(1),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u();c(),y(" Disp: ",t.getDisponible(e,n)," ")}}function rd(i,r){if(i&1){let n=E();s(0,"div",42),_("click",function(){let t=f(n).$implicit,o=u().$implicit,a=u();return h(a.onCellClick(o,t))}),s(1,"div",43),b(2,nd,2,1,"div",44)(3,id,2,1,"div",45)(4,od,2,1,"div",46),l()()}if(i&2){let n=r.$implicit,e=u().$implicit,t=u();U("negative",t.isNegative(e,n))("zero",t.isZero(e,n))("selected",t.isCellSelected(e,n)),c(2),g("ngIf",t.getCapacite(e,n)!==void 0),c(),g("ngIf",t.getCharge(e,n)!==void 0),c(),g("ngIf",t.getDisponible(e,n)!==void 0)}}function ad(i,r){if(i&1&&(s(0,"div",50)(1,"div",51)(2,"label"),p(3,"Initial:"),l(),p(4),l(),s(5,"div",51)(6,"label"),p(7,"R\xE9vis\xE9:"),l(),p(8),l(),s(9,"div",51)(10,"label"),p(11,"Pr\xE9v:"),l(),p(12),l(),s(13,"div",51)(14,"label"),p(15,"Cons:"),l(),p(16),l(),s(17,"div",51)(18,"label"),p(19,"RAF:"),l(),p(20),l(),s(21,"div",52)(22,"label"),p(23,"Planifi\xE9:"),l(),p(24),l()()),i&2){let n=u().$implicit,e=u();c(4),y(" ",n.projet.chiffrage_initial,"j"),c(4),y(" ",n.projet.chiffrage_revise,"j"),c(4),y(" ",n.projet.chiffrage_previsionnel,"j"),c(4),y(" ",n.projet.temps_consomme,"j"),c(4),y(" ",e.calculateRAF(n.projet),"j"),c(4),y(" ",n.totalJours||0,"j")}}function sd(i,r){if(i&1&&(s(0,"div",35)(1,"div",28)(2,"div",36)(3,"strong"),p(4),l(),b(5,td,4,2,"div",37),l()(),s(6,"div",29),b(7,rd,5,9,"div",38),l(),s(8,"div",31),b(9,ad,25,6,"div",39),l()()),i&2){let n=r.$implicit,e=u();c(4),j(n.label),c(),g("ngIf",n.projet),c(2),g("ngForOf",e.displayedWeeks),c(2),g("ngIf",n.projet)}}function ld(i,r){if(i&1){let n=E();s(0,"div",53)(1,"div",54),p(2),l(),s(3,"div",55)(4,"input",56),O("ngModelChange",function(t){f(n);let o=u();return S(o.bulkCapaciteValue,t)||(o.bulkCapaciteValue=t),h(t)}),l(),s(5,"button",8),_("click",function(){f(n);let t=u();return h(t.applyBulkCapacite())}),p(6," Appliquer Capacit\xE9 "),l(),s(7,"input",57),O("ngModelChange",function(t){f(n);let o=u();return S(o.bulkChargeValue,t)||(o.bulkChargeValue=t),h(t)}),l(),s(8,"button",58),_("click",function(){f(n);let t=u();return h(t.applyBulkCharge())}),p(9," Appliquer Charge "),l(),s(10,"button",59),_("click",function(){f(n);let t=u();return h(t.clearSelection())}),p(11," Annuler "),l()()()}if(i&2){let n=u();c(2),y(" ",n.selectedCells.length," semaine(s) s\xE9lectionn\xE9e(s) "),c(2),P("ngModel",n.bulkCapaciteValue),c(3),P("ngModel",n.bulkChargeValue)}}function cd(i,r){if(i&1){let n=E();s(0,"div",60),_("click",function(){f(n);let t=u();return h(t.showResourceModal=!1)}),s(1,"div",61),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",62)(3,"h2"),p(4,"G\xE9rer les Ressources"),l(),s(5,"button",63),_("click",function(){f(n);let t=u();return h(t.showResourceModal=!1)}),p(6,"\xD7"),l()(),s(7,"app-resource-manager",64),_("resourceCreated",function(){f(n);let t=u();return h(t.onResourceCreated())}),l()()()}}function dd(i,r){if(i&1){let n=E();s(0,"div",60),_("click",function(){f(n);let t=u();return h(t.showProjectModal=!1)}),s(1,"div",65),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",62)(3,"h2"),p(4,"Nouveau Projet"),l(),s(5,"button",63),_("click",function(){f(n);let t=u();return h(t.showProjectModal=!1)}),p(6,"\xD7"),l()(),s(7,"form",66),_("ngSubmit",function(){f(n);let t=u();return h(t.createProjet())}),s(8,"div",67)(9,"label"),p(10,"Code Projet *"),l(),s(11,"input",68),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.code_projet,t)||(o.newProjet.code_projet=t),h(t)}),l()(),s(12,"div",67)(13,"label"),p(14,"Nom Projet *"),l(),s(15,"input",69),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.nom_projet,t)||(o.newProjet.nom_projet=t),h(t)}),l()(),s(16,"div",67)(17,"label"),p(18,"Chef de Projet"),l(),s(19,"input",70),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.chef_projet,t)||(o.newProjet.chef_projet=t),h(t)}),l()(),s(20,"div",67)(21,"label"),p(22,"Statut"),l(),s(23,"select",71),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.statut,t)||(o.newProjet.statut=t),h(t)}),s(24,"option",72),p(25,"En cours"),l(),s(26,"option",73),p(27,"Planifi\xE9"),l(),s(28,"option",74),p(29,"Termin\xE9"),l(),s(30,"option",75),p(31,"En pause"),l()()(),s(32,"div",76)(33,"div",67)(34,"label"),p(35,"Chiffrage Initial"),l(),s(36,"input",77),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.chiffrage_initial,t)||(o.newProjet.chiffrage_initial=t),h(t)}),l()(),s(37,"div",67)(38,"label"),p(39,"Chiffrage R\xE9vis\xE9"),l(),s(40,"input",78),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.chiffrage_revise,t)||(o.newProjet.chiffrage_revise=t),h(t)}),l()(),s(41,"div",67)(42,"label"),p(43,"Chiffrage Pr\xE9visionnel"),l(),s(44,"input",79),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.chiffrage_previsionnel,t)||(o.newProjet.chiffrage_previsionnel=t),h(t)}),l()()(),s(45,"div",67)(46,"label"),p(47,"Description"),l(),s(48,"textarea",80),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.description,t)||(o.newProjet.description=t),h(t)}),l()(),s(49,"div",81)(50,"button",82),p(51,"Cr\xE9er"),l(),s(52,"button",83),_("click",function(){f(n);let t=u();return h(t.showProjectModal=!1)}),p(53,"Annuler"),l()()()()()}if(i&2){let n=u();c(11),P("ngModel",n.newProjet.code_projet),c(4),P("ngModel",n.newProjet.nom_projet),c(4),P("ngModel",n.newProjet.chef_projet),c(4),P("ngModel",n.newProjet.statut),c(13),P("ngModel",n.newProjet.chiffrage_initial),c(4),P("ngModel",n.newProjet.chiffrage_revise),c(4),P("ngModel",n.newProjet.chiffrage_previsionnel),c(4),P("ngModel",n.newProjet.description)}}var is=(()=>{let r=class r{constructor(e,t,o){this.calendarService=e,this.projetService=t,this.resourceService=o,this.viewMode="project",this.displayedWeeks=[],this.currentDate=new Date,this.projets=[],this.charges=[],this.capacites=[],this.jalons=[],this.calendarRows=[],this.selectedCells=[],this.bulkCapaciteValue=1,this.bulkChargeValue=1,this.showProjectModal=!1,this.showResourceModal=!1,this.newProjet={code_projet:"",nom_projet:"",statut:"En cours",chiffrage_initial:0,chiffrage_revise:0,chiffrage_previsionnel:0,temps_consomme:0}}ngOnInit(){return C(this,null,function*(){this.generateWeeks(),yield this.loadData()})}generateWeeks(){this.displayedWeeks=[];let e=new Date(this.currentDate);e.setDate(1);let t=this.calendarService.getWeekStart(e);for(let o=0;o<16;o++){let a=new Date(t);a.setDate(a.getDate()+o*7),this.displayedWeeks.push(a)}}loadData(){return C(this,null,function*(){try{this.projets=yield this.projetService.getAllProjets(),this.charges=yield this.calendarService.getCharges(),this.jalons=yield this.calendarService.getJalons(),this.buildCalendarRows()}catch(e){console.error("Error loading data:",e)}})}buildCalendarRows(){this.calendarRows=[],this.viewMode==="project"&&this.projets.forEach(e=>{let t={type:"projet",id:e.id,label:e.nom_projet,projet:e,weeks:new Map,totalJours:0},o=this.charges.filter(a=>a.projet_id===e.id);this.displayedWeeks.forEach(a=>{let d=this.calendarService.formatWeekStart(a),v=o.filter(x=>{let w=new Date(x.semaine_debut),k=new Date(x.semaine_fin);return a>=w&&a<=k}).reduce((x,w)=>x+w.unite_ressource,0);v>0&&(t.weeks.set(d,{charge:v}),t.totalJours=(t.totalJours||0)+v*5)}),this.calendarRows.push(t)})}formatWeekHeader(e){let t=e.getDate().toString().padStart(2,"0"),o=(e.getMonth()+1).toString().padStart(2,"0");return`${t}/${o}`}getWeekNumber(e){return this.calendarService.getWeekNumber(e)}isCurrentWeek(e){let t=new Date,o=this.calendarService.getWeekStart(t);return this.calendarService.formatWeekStart(e)===this.calendarService.formatWeekStart(o)}getCapacite(e,t){let o=this.calendarService.formatWeekStart(t);return e.weeks.get(o)?.capacite}getCharge(e,t){let o=this.calendarService.formatWeekStart(t);return e.weeks.get(o)?.charge}getDisponible(e,t){let o=this.calendarService.formatWeekStart(t),a=e.weeks.get(o);if(a?.capacite!==void 0&&a?.charge!==void 0)return a.capacite-a.charge}isNegative(e,t){let o=this.getDisponible(e,t);return o!==void 0&&o<0}isZero(e,t){return this.getDisponible(e,t)===0}getJalonsForWeek(e){let t=this.calendarService.formatWeekStart(e);return this.jalons.filter(o=>{let a=this.calendarService.getWeekStart(new Date(o.date_jalon));return this.calendarService.formatWeekStart(a)===t})}onCellClick(e,t){let o=this.selectedCells.findIndex(a=>a.row.id===e.id&&a.week.getTime()===t.getTime());o>=0?this.selectedCells.splice(o,1):this.selectedCells.push({row:e,week:t})}isCellSelected(e,t){return this.selectedCells.some(o=>o.row.id===e.id&&o.week.getTime()===t.getTime())}clearSelection(){this.selectedCells=[]}applyBulkCapacite(){return C(this,null,function*(){console.log("Apply bulk capacite:",this.bulkCapaciteValue),this.clearSelection()})}applyBulkCharge(){return C(this,null,function*(){console.log("Apply bulk charge:",this.bulkChargeValue),this.clearSelection()})}calculateRAF(e){return this.projetService.calculateRAF(e)}createProjet(){return C(this,null,function*(){try{yield this.projetService.createProjet(this.newProjet),this.showProjectModal=!1,this.newProjet={code_projet:"",nom_projet:"",statut:"En cours",chiffrage_initial:0,chiffrage_revise:0,chiffrage_previsionnel:0,temps_consomme:0},yield this.loadData()}catch(e){console.error("Error creating project:",e)}})}goToPreviousMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1),this.generateWeeks()}goToNextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1),this.generateWeeks()}goToToday(){this.currentDate=new Date,this.generateWeeks()}onViewModeChange(){this.buildCalendarRows()}onResourceCreated(){this.loadData()}};r.\u0275fac=function(t){return new(t||r)(L(an),L(tt),L(yt))},r.\u0275cmp=B({type:r,selectors:[["app-calendar-view"]],decls:38,vars:8,consts:[[1,"calendar-container"],[1,"calendar-header"],[1,"header-actions"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-secondary",3,"click"],[1,"calendar-controls"],[1,"date-navigation"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"view-controls"],[3,"ngModelChange","change","ngModel"],["value","project"],["value","resource"],[1,"calendar-grid-wrapper"],[1,"calendar-grid"],[1,"grid-header","sticky-header"],[1,"row-label-header"],[1,"weeks-header"],["class","week-header",3,"current-week",4,"ngFor","ngForOf"],[1,"metrics-header"],["class","jalons-row sticky-jalons",4,"ngIf"],["class","calendar-row",4,"ngFor","ngForOf"],["class","selection-toolbar",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"week-header"],[1,"week-date"],[1,"week-number"],[1,"jalons-row","sticky-jalons"],[1,"row-label"],[1,"weeks-content"],["class","week-cell jalon-cell",4,"ngFor","ngForOf"],[1,"metrics-cell"],[1,"week-cell","jalon-cell"],["class","jalon-marker",3,"title",4,"ngFor","ngForOf"],[1,"jalon-marker",3,"title"],[1,"calendar-row"],[1,"row-label-content"],["class","row-label-meta text-sm text-gray",4,"ngIf"],["class","week-cell",3,"negative","zero","selected","click",4,"ngFor","ngForOf"],["class","projet-metrics",4,"ngIf"],[1,"row-label-meta","text-sm","text-gray"],[4,"ngIf"],[1,"week-cell",3,"click"],[1,"cell-content"],["class","capacite",4,"ngIf"],["class","charge",4,"ngIf"],["class","disponible",4,"ngIf"],[1,"capacite"],[1,"charge"],[1,"disponible"],[1,"projet-metrics"],[1,"metric"],[1,"metric","metric-highlight"],[1,"selection-toolbar"],[1,"selection-info"],[1,"selection-actions"],["type","number","placeholder","Capacit\xE9","step","0.5",1,"bulk-input",3,"ngModelChange","ngModel"],["type","number","placeholder","Charge","step","0.5",1,"bulk-input",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal","modal-large",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[3,"resourceCreated"],[1,"modal",3,"click"],[1,"form",3,"ngSubmit"],[1,"form-group"],["name","code","required","",3,"ngModelChange","ngModel"],["name","nom","required","",3,"ngModelChange","ngModel"],["name","chef",3,"ngModelChange","ngModel"],["name","statut",3,"ngModelChange","ngModel"],["value","En cours"],["value","Planifi\xE9"],["value","Termin\xE9"],["value","En pause"],[1,"grid","grid-3"],["type","number","name","initial",3,"ngModelChange","ngModel"],["type","number","name","revise",3,"ngModelChange","ngModel"],["type","number","name","prev",3,"ngModelChange","ngModel"],["name","desc","rows","3",3,"ngModelChange","ngModel"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"h1"),p(3,"Planification des Ressources"),l(),s(4,"div",2)(5,"button",3),_("click",function(){return o.showProjectModal=!0}),p(6,"+ Nouveau Projet"),l(),s(7,"button",4),_("click",function(){return o.showResourceModal=!0}),p(8,"+ Nouvelle Ressource"),l()()(),s(9,"div",5)(10,"div",6)(11,"button",7),_("click",function(){return o.goToPreviousMonth()}),p(12,"\u2190 Mois pr\xE9c\xE9dent"),l(),s(13,"button",8),_("click",function(){return o.goToToday()}),p(14,"Aujourd'hui"),l(),s(15,"button",7),_("click",function(){return o.goToNextMonth()}),p(16,"Mois suivant \u2192"),l()(),s(17,"div",9)(18,"select",10),O("ngModelChange",function(d){return S(o.viewMode,d)||(o.viewMode=d),d}),_("change",function(){return o.onViewModeChange()}),s(19,"option",11),p(20,"Vue par Projet"),l(),s(21,"option",12),p(22,"Vue par Ressource"),l()()()(),s(23,"div",13)(24,"div",14)(25,"div",15)(26,"div",16)(27,"span"),p(28),l()(),s(29,"div",17),b(30,Qc,5,4,"div",18),l(),s(31,"div",19),p(32,"M\xE9triques"),l()(),b(33,Xc,6,1,"div",20)(34,sd,10,4,"div",21),l()(),b(35,ld,12,3,"div",22),l(),b(36,cd,8,0,"div",23)(37,dd,54,8,"div",23)),t&2&&(c(18),P("ngModel",o.viewMode),c(10),j(o.viewMode==="project"?"Projets":"Ressources"),c(2),g("ngForOf",o.displayedWeeks),c(3),g("ngIf",o.jalons.length>0),c(),g("ngForOf",o.calendarRows),c(),g("ngIf",o.selectedCells.length>0),c(),g("ngIf",o.showResourceModal),c(),g("ngIf",o.showProjectModal))},dependencies:[G,Ce,X,Z,we,Re,Ve,ee,Qe,je,te,ve,be,ne,xe,Li],styles:[".calendar-container[_ngcontent-%COMP%]{padding:20px;background:#f5f7fa;min-height:100vh}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.calendar-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.date-navigation[_ngcontent-%COMP%]{display:flex;gap:8px}.calendar-grid-wrapper[_ngcontent-%COMP%]{overflow-x:auto;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.calendar-grid[_ngcontent-%COMP%]{min-width:1200px;display:flex;flex-direction:column}.grid-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:250px 1fr 200px;background:#f8fafc;border-bottom:2px solid #e2e8f0;font-weight:600;position:sticky;top:0;z-index:100}.row-label-header[_ngcontent-%COMP%]{padding:12px 16px;border-right:1px solid #e2e8f0}.weeks-header[_ngcontent-%COMP%]{display:flex;overflow-x:auto}.week-header[_ngcontent-%COMP%]{min-width:100px;padding:8px;text-align:center;border-right:1px solid #e2e8f0;font-size:12px}.week-header.current-week[_ngcontent-%COMP%]{background:#dbeafe;border-left:2px solid #3b82f6;border-right:2px solid #3b82f6}.week-date[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.week-number[_ngcontent-%COMP%]{font-size:11px;color:#6b7280}.metrics-header[_ngcontent-%COMP%]{padding:12px 16px;border-left:1px solid #e2e8f0}.jalons-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:250px 1fr 200px;border-bottom:1px solid #e2e8f0;background:#fef3c7;position:sticky;top:60px;z-index:99}.calendar-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:250px 1fr 200px;border-bottom:1px solid #e2e8f0;transition:background .15s ease}.calendar-row[_ngcontent-%COMP%]:hover{background:#f9fafb}.row-label[_ngcontent-%COMP%]{padding:16px;border-right:1px solid #e2e8f0;display:flex;align-items:center}.row-label-content[_ngcontent-%COMP%]{width:100%}.row-label-meta[_ngcontent-%COMP%]{margin-top:4px}.weeks-content[_ngcontent-%COMP%]{display:flex;overflow-x:auto}.week-cell[_ngcontent-%COMP%]{min-width:100px;padding:8px;border-right:1px solid #e2e8f0;cursor:pointer;transition:background .15s ease}.week-cell[_ngcontent-%COMP%]:hover{background:#f3f4f6}.week-cell.selected[_ngcontent-%COMP%]{background:#dbeafe;border:2px solid #3b82f6}.week-cell.negative[_ngcontent-%COMP%]{background:#fee2e2}.week-cell.zero[_ngcontent-%COMP%]{background:#fef3c7}.cell-content[_ngcontent-%COMP%]{font-size:12px;line-height:1.4}.capacite[_ngcontent-%COMP%]{color:#059669;font-weight:500}.charge[_ngcontent-%COMP%]{color:#dc2626;font-weight:500}.disponible[_ngcontent-%COMP%]{color:#2563eb;font-weight:600;margin-top:4px}.jalon-cell[_ngcontent-%COMP%]{padding:4px}.jalon-marker[_ngcontent-%COMP%]{font-size:11px;background:#fbbf24;padding:2px 6px;border-radius:4px;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.metrics-cell[_ngcontent-%COMP%]{padding:12px 16px;border-left:1px solid #e2e8f0;font-size:12px}.projet-metrics[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.metric[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px}.metric[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#6b7280;font-weight:500}.metric-highlight[_ngcontent-%COMP%]{font-weight:600;color:#2563eb;padding-top:4px;border-top:1px solid #e2e8f0;margin-top:4px}.selection-toolbar[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:50%;transform:translate(-50%);background:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 10px 25px #0003;display:flex;align-items:center;gap:16px;z-index:1000}.selection-info[_ngcontent-%COMP%]{font-weight:600;color:#374151}.selection-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.bulk-input[_ngcontent-%COMP%]{width:100px}.form[_ngcontent-%COMP%]{width:100%}.modal-large[_ngcontent-%COMP%]{min-width:800px}"]});let i=r;return i})();var os=i=>({$implicit:i}),sn=(i,r)=>r.id;function pd(i,r){i&1&&ao(0)}function ud(i,r){if(i&1&&b(0,pd,1,0,"ng-container",29),i&2){let n=r.$implicit;u();let e=Lt(62);g("ngTemplateOutlet",e)("ngTemplateOutletContext",so(2,os,n))}}function md(i,r){if(i&1){let n=E();s(0,"div",45),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.selectColor(t))}),l()}if(i&2){let n=r.$implicit,e=u(2);oe("background-color",n),U("active",e.formData.color===n&&!e.isCustomColor)}}function gd(i,r){i&1&&M(0,"lucide-icon",39),i&2&&g("size",16)}function fd(i,r){if(i&1&&M(0,"div",46),i&2){let n=u(2);oe("background-color",n.formData.color)}}function hd(i,r){if(i&1){let n=E();s(0,"div",41)(1,"input",47),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.color,t)||(o.formData.color=t),h(t)}),l(),s(2,"input",48),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.color,t)||(o.formData.color=t),h(t)}),l()()}if(i&2){let n=u(2);c(),P("ngModel",n.formData.color),c(),P("ngModel",n.formData.color)}}function _d(i,r){if(i&1&&(s(0,"option",50),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom)}}function Cd(i,r){if(i&1){let n=E();s(0,"div",33)(1,"label"),p(2,"Soci\xE9t\xE9 de rattachement"),l(),s(3,"select",49),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.societe_id,t)||(o.formData.societe_id=t),h(t)}),Pe(4,_d,2,2,"option",50,sn),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.societe_id),c(),Se(n.societes)}}function vd(i,r){if(i&1&&(s(0,"option",50),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom)}}function xd(i,r){if(i&1){let n=E();s(0,"div",33)(1,"label"),p(2,"D\xE9partement de rattachement"),l(),s(3,"select",49),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.departement_id,t)||(o.formData.departement_id=t),h(t)}),Pe(4,vd,2,2,"option",50,sn),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.departement_id),c(),Se(n.departements)}}function wd(i,r){if(i&1){let n=E();s(0,"div",33)(1,"label"),p(2,"Rattachement (Service ou D\xE9partement)"),l(),s(3,"select",51),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.parentType,t)||(o.formData.parentType=t),h(t)}),_("change",function(){f(n);let t=u(2);return h(t.formData.parentId="")}),s(4,"option",52),p(5,"Service"),l(),s(6,"option",53),p(7,"D\xE9partement"),l()()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.parentType)}}function bd(i,r){if(i&1&&(s(0,"option",50),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom)}}function yd(i,r){if(i&1){let n=E();s(0,"div",33)(1,"label"),p(2,"Service"),l(),s(3,"select",49),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.parentId,t)||(o.formData.parentId=t),h(t)}),Pe(4,bd,2,2,"option",50,sn),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.parentId),c(),Se(n.services)}}function Md(i,r){if(i&1&&(s(0,"option",50),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom)}}function Pd(i,r){if(i&1){let n=E();s(0,"div",33)(1,"label"),p(2,"D\xE9partement"),l(),s(3,"select",49),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.formData.parentId,t)||(o.formData.parentId=t),h(t)}),Pe(4,Md,2,2,"option",50,sn),l()()}if(i&2){let n=u(2);c(3),P("ngModel",n.formData.parentId),c(),Se(n.departements)}}function Sd(i,r){if(i&1){let n=E();s(0,"div",30),_("click",function(){f(n);let t=u();return h(t.closeModals())}),s(1,"div",31),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"h2",32),p(3),l(),s(4,"div",33)(5,"label"),p(6,"Nom"),l(),s(7,"input",34),O("ngModelChange",function(t){f(n);let o=u();return S(o.formData.nom,t)||(o.formData.nom=t),h(t)}),l()(),s(8,"div",33)(9,"label"),p(10,"Code"),l(),s(11,"input",35),O("ngModelChange",function(t){f(n);let o=u();return S(o.formData.code,t)||(o.formData.code=t),h(t)}),l()(),s(12,"div",33)(13,"label"),p(14,"Couleur"),l(),s(15,"div",36),Pe(16,md,1,4,"div",37,Nt),s(18,"div",38),_("click",function(){f(n);let t=u();return h(t.isCustomColor=!t.isCustomColor)}),q(19,gd,1,1,"lucide-icon",39)(20,fd,1,2,"div",40),l()(),q(21,hd,3,2,"div",41),l(),q(22,Cd,6,1,"div",33),q(23,xd,6,1,"div",33),q(24,wd,8,1,"div",33),q(25,yd,6,1,"div",33),q(26,Pd,6,1,"div",33),s(27,"div",42)(28,"button",43),_("click",function(){f(n);let t=u();return h(t.closeModals())}),p(29,"Annuler"),l(),s(30,"button",44),_("click",function(){f(n);let t=u();return h(t.showEditModal?t.handleUpdate():t.handleCreate())}),p(31,"Enregistrer"),l()()()()}if(i&2){let n=u();c(3),Ie(" ",n.showEditModal?"Modifier":"Cr\xE9er"," ",n.getModalTitleType()," "),c(4),P("ngModel",n.formData.nom),c(4),P("ngModel",n.formData.code),c(5),Se(n.predefinedColors),c(2),U("active",n.isCustomColor),c(),W(n.isCustomColor?20:19),c(2),W(n.isCustomColor?21:-1),c(),W(n.createModalType==="departement"||(n.editingNode==null?null:n.editingNode.type)==="departement"?22:-1),c(),W(n.createModalType==="service"||(n.editingNode==null?null:n.editingNode.type)==="service"?23:-1),c(),W(n.createModalType==="equipe"||(n.editingNode==null?null:n.editingNode.type)==="equipe"?24:-1),c(),W((n.createModalType==="equipe"||(n.editingNode==null?null:n.editingNode.type)==="equipe")&&n.formData.parentType==="service"?25:-1),c(),W((n.createModalType==="equipe"||(n.editingNode==null?null:n.editingNode.type)==="equipe")&&n.formData.parentType==="departement"?26:-1)}}function Od(i,r){if(i&1&&(s(0,"div",55),M(1,"lucide-icon",65),l()),i&2){let n=u().$implicit;c(),g("name",n.expanded?"chevron-down":"chevron-right")("size",20)}}function kd(i,r){i&1&&M(0,"div",56)}function Ed(i,r){i&1&&M(0,"lucide-icon",11),i&2&&g("size",18)}function Td(i,r){i&1&&M(0,"lucide-icon",12),i&2&&g("size",18)}function Id(i,r){i&1&&M(0,"lucide-icon",13),i&2&&g("size",18)}function jd(i,r){i&1&&M(0,"lucide-icon",14),i&2&&g("size",18)}function Rd(i,r){if(i&1&&(s(0,"span",60),p(1),l()),i&2){let n=u().$implicit;c(),y("(",n.code,")")}}function Vd(i,r){if(i&1){let n=E();s(0,"div",64)(1,"button",66),_("click",function(){f(n);let t=u().$implicit,o=u();return h(o.openEditModal(t))}),p(2,"Modifier"),l(),s(3,"button",67),_("click",function(){f(n);let t=u().$implicit,o=u();return h(o.handleDelete(t))}),p(4,"Supprimer"),l()()}}function Dd(i,r){i&1&&ao(0)}function Ad(i,r){if(i&1&&b(0,Dd,1,0,"ng-container",29),i&2){let n=r.$implicit;u(3);let e=Lt(62);g("ngTemplateOutlet",e)("ngTemplateOutletContext",so(2,os,n))}}function Nd(i,r){if(i&1&&Pe(0,Ad,1,4,"ng-container",null,sn),i&2){let n=u().$implicit;Se(n.children)}}function Ld(i,r){if(i&1){let n=E();s(0,"div",54),_("click",function(){let t=f(n).$implicit,o=u();return h(o.toggleNode(t))}),q(1,Od,2,2,"div",55)(2,kd,1,0,"div",56),s(3,"div",57),q(4,Ed,1,1,"lucide-icon",11),q(5,Td,1,1,"lucide-icon",12),q(6,Id,1,1,"lucide-icon",13),q(7,jd,1,1,"lucide-icon",14),l(),s(8,"div",58)(9,"span",59),p(10),l(),q(11,Rd,2,1,"span",60),l(),s(12,"div",61),_("click",function(t){return f(n),h(t.stopPropagation())}),s(13,"button",62),_("click",function(t){let o=f(n).$implicit,a=u();return h(a.toggleMenu(o,t))}),M(14,"lucide-icon",63),l(),q(15,Vd,5,0,"div",64),l()(),q(16,Nd,2,0)}if(i&2){let n=r.$implicit,e=u();oe("margin-left",n.level*32,"px"),c(),W(n.children.length>0?1:2),c(2),oe("background-color",n.color||"#e5e7eb")("color","#fff"),g("ngClass",n.type),c(),W(n.type==="societe"?4:-1),c(),W(n.type==="departement"?5:-1),c(),W(n.type==="service"?6:-1),c(),W(n.type==="equipe"?7:-1),c(3),j(n.nom),c(),W(n.code?11:-1),c(3),g("size",16),c(),W(e.activeMenuId===n.id?15:-1),c(),W(n.expanded?16:-1)}}var Fd=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Be({type:r}),r.\u0275inj=Ue({imports:[K.pick({Building2:Ft,Layers:Ut,Box:Xn,Users:xt,ChevronRight:vt,ChevronDown:Ct,MoreVertical:zt,Plus:He}),K]});let i=r;return i})(),rs=(()=>{let r=class r{selectColor(e){this.formData.color=e,this.isCustomColor=!1}constructor(e){this.resourceService=e,this.societes=[],this.departements=[],this.services=[],this.equipes=[],this.orgTree=[],this.showCreateModal=!1,this.showEditModal=!1,this.createModalType=null,this.editingNode=null,this.activeMenuId=null,this.formData={nom:"",code:"",color:"#3b82f6",societe_id:"",departement_id:"",service_id:"",parentType:"service",parentId:""},this.predefinedColors=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],this.isCustomColor=!1,window.addEventListener("click",()=>{this.activeMenuId=null})}ngOnInit(){return C(this,null,function*(){yield this.loadData()})}loadData(){return C(this,null,function*(){try{this.societes=yield this.resourceService.getAllSocietes(),this.departements=yield this.resourceService.getAllDepartements(),this.services=yield this.resourceService.getAllServices(),this.equipes=yield this.resourceService.getAllEquipes(),this.buildOrgTree()}catch(e){console.error("Error loading data:",e)}})}buildOrgTree(){this.orgTree=this.societes.map(e=>{let o=this.departements.filter(a=>a.societe_id===e.id).map(a=>{let m=this.services.filter(w=>w.departement_id===a.id).map(w=>{let k=this.equipes.filter(V=>V.service_id===w.id);return{type:"service",id:w.id,nom:w.nom,code:w.code,color:w.color,originalData:w,children:k.map(V=>({type:"equipe",id:V.id,nom:V.nom,code:V.code,color:V.color,originalData:V,children:[],expanded:!1,level:3,parentId:w.id})),expanded:!1,level:2,parentId:a.id}}),x=this.equipes.filter(w=>w.departement_id===a.id).map(w=>({type:"equipe",id:w.id,nom:w.nom,code:w.code,color:w.color,originalData:w,children:[],expanded:!1,level:2,parentId:a.id}));return{type:"departement",id:a.id,nom:a.nom,code:a.code,color:a.color,originalData:a,children:[...m,...x],expanded:!1,level:1,parentId:e.id}});return{type:"societe",id:e.id,nom:e.nom,code:e.code,color:e.color||"#3b82f6",originalData:e,children:o,expanded:!1,level:0}})}toggleNode(e){e.expanded=!e.expanded}toggleMenu(e,t){t.stopPropagation(),this.activeMenuId===e.id?this.activeMenuId=null:this.activeMenuId=e.id}openCreateModal(e){this.createModalType=e,this.showCreateModal=!0,this.showEditModal=!1,this.formData={nom:"",code:"",color:"#3b82f6",societe_id:"",departement_id:"",service_id:"",parentType:"service",parentId:""},e==="departement"&&this.societes.length>0&&(this.formData.societe_id=this.societes[0].id??""),e==="service"&&this.departements.length>0&&(this.formData.departement_id=this.departements[0].id??""),e==="equipe"&&(this.services.length>0?(this.formData.parentType="service",this.formData.parentId=this.services[0].id??""):this.departements.length>0&&(this.formData.parentType="departement",this.formData.parentId=this.departements[0].id??""))}openEditModal(e){this.editingNode=e,this.createModalType=null,this.showEditModal=!0,this.showCreateModal=!1,this.activeMenuId=null,this.formData=T({},e.originalData),this.isCustomColor=!this.predefinedColors.includes(this.formData.color),e.type==="equipe"&&(console.log(e),e.originalData.service_id?(this.formData.parentType="service",this.formData.parentId=e.originalData.service_id??""):e.originalData.departement_id&&(this.formData.parentType="departement",this.formData.parentId=e.originalData.departement_id??""))}closeModals(){this.showCreateModal=!1,this.showEditModal=!1,this.createModalType=null,this.editingNode=null}getModalTitleType(){switch(this.showEditModal?this.editingNode?.type:this.createModalType){case"societe":return"une Soci\xE9t\xE9";case"departement":return"un D\xE9partement";case"service":return"un Service";case"equipe":return"une \xC9quipe";default:return""}}handleCreate(){return C(this,null,function*(){try{if(this.createModalType==="societe"){let e={nom:this.formData.nom,code:this.formData.code,color:this.formData.color};yield this.resourceService.createSociete(e)}else if(this.createModalType==="departement"){let e={nom:this.formData.nom,code:this.formData.code,color:this.formData.color,societe_id:this.formData.societe_id};yield this.resourceService.createDepartement(e)}else if(this.createModalType==="service"){let e={nom:this.formData.nom,code:this.formData.code,color:this.formData.color,departement_id:this.formData.departement_id};yield this.resourceService.createService(e)}else if(this.createModalType==="equipe"){let e={nom:this.formData.nom,code:this.formData.code,color:this.formData.color};this.formData.parentType==="service"?e.service_id=this.formData.parentId:this.formData.parentType==="departement"&&(e.departement_id=this.formData.parentId),yield this.resourceService.createEquipe(e)}this.closeModals(),yield this.loadData()}catch(e){console.error("Error creating:",e)}})}handleUpdate(){return C(this,null,function*(){if(this.editingNode)try{let e=this.editingNode.id;if(this.editingNode.type==="societe"){let t={nom:this.formData.nom,code:this.formData.code,color:this.formData.color};yield this.resourceService.updateSociete(e,t)}else if(this.editingNode.type==="departement"){let t={nom:this.formData.nom,code:this.formData.code,color:this.formData.color,societe_id:this.formData.societe_id};yield this.resourceService.updateDepartement(e,t)}else if(this.editingNode.type==="service"){let t={nom:this.formData.nom,code:this.formData.code,color:this.formData.color,departement_id:this.formData.departement_id};yield this.resourceService.updateService(e,t)}else if(this.editingNode.type==="equipe"){let t={nom:this.formData.nom,code:this.formData.code,color:this.formData.color};this.formData.parentType==="service"?t.service_id=this.formData.parentId:this.formData.parentType==="departement"&&(t.departement_id=this.formData.parentId),yield this.resourceService.updateEquipe(e,t)}this.closeModals(),yield this.loadData()}catch(e){console.error("Error updating:",e)}})}handleDelete(e){return C(this,null,function*(){if(confirm(`\xCAtes-vous s\xFBr de vouloir supprimer ${e.nom} ?`))try{e.type==="societe"?yield this.resourceService.deleteSociete(e.id):e.type==="departement"?yield this.resourceService.deleteDepartement(e.id):e.type==="service"?yield this.resourceService.deleteService(e.id):e.type==="equipe"&&(yield this.resourceService.deleteEquipe(e.id)),this.activeMenuId=null,yield this.loadData()}catch(t){console.error("Error deleting:",t)}})}};r.\u0275fac=function(t){return new(t||r)(L(yt))},r.\u0275cmp=B({type:r,selectors:[["app-organization-view"]],decls:63,vars:13,consts:[["nodeTemplate",""],[1,"organization-view"],[1,"header"],[1,"header-left"],[1,"logo"],["width","24","height","24","viewBox","0 0 24 24","fill","none"],["d","M12 2L2 7L12 12L22 7L12 2Z","fill","#3b82f6"],["d","M2 17L12 22L22 17V12L12 17L2 12V17Z","fill","#3b82f6","opacity","0.6"],[1,"logo-text"],[1,"header-right"],[1,"header-btn",3,"click"],["name","building-2",3,"size"],["name","layers",3,"size"],["name","box",3,"size"],["name","users",3,"size"],[1,"main-content"],[1,"page-title"],[1,"page-subtitle"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-icon","societe"],[1,"stat-value"],[1,"stat-label"],[1,"stat-icon","departement"],[1,"stat-icon","service"],[1,"stat-icon","equipe"],[1,"org-structure"],[1,"tree-container"],[1,"modal-overlay"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-title"],[1,"form-group"],["type","text","placeholder","Nom",3,"ngModelChange","ngModel"],["type","text","placeholder","Code (e.g. CAT)",3,"ngModelChange","ngModel"],[1,"color-palette"],[1,"color-swatch",3,"background-color","active"],["title","Couleur personnalis\xE9e",1,"color-swatch","custom-trigger",3,"click"],["name","plus",3,"size"],[1,"custom-preview",3,"background-color"],[1,"custom-color-input-wrapper"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-confirm",3,"click"],[1,"color-swatch",3,"click"],[1,"custom-preview"],["type","color",1,"color-input",3,"ngModelChange","ngModel"],["type","text","placeholder","#000000",1,"color-hex-input",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"ngModelChange","change","ngModel"],["value","service","selected",""],["value","departement"],[1,"tree-node",3,"click"],[1,"toggle-icon"],[1,"toggle-placeholder"],[1,"node-icon",3,"ngClass"],[1,"node-info"],[1,"node-name"],[1,"node-code"],[1,"kebab-menu-container",3,"click"],[1,"kebab-btn",3,"click"],["name","more-vertical",3,"size"],[1,"menu-dropdown"],[3,"name","size"],[3,"click"],[1,"delete-btn",3,"click"]],template:function(t,o){if(t&1){let a=E();s(0,"div",1)(1,"header",2)(2,"div",3)(3,"div",4),ht(),s(4,"svg",5),M(5,"path",6)(6,"path",7),l(),Ot(),s(7,"span",8),p(8,"ResourceFlow"),l()()(),s(9,"div",9)(10,"button",10),_("click",function(){return f(a),h(o.openCreateModal("societe"))}),M(11,"lucide-icon",11),p(12," Soci\xE9t\xE9 "),l(),s(13,"button",10),_("click",function(){return f(a),h(o.openCreateModal("departement"))}),M(14,"lucide-icon",12),p(15," D\xE9partement "),l(),s(16,"button",10),_("click",function(){return f(a),h(o.openCreateModal("service"))}),M(17,"lucide-icon",13),p(18," Service "),l(),s(19,"button",10),_("click",function(){return f(a),h(o.openCreateModal("equipe"))}),M(20,"lucide-icon",14),p(21," \xC9quipe "),l()()(),s(22,"main",15)(23,"h1",16),p(24,"Organisation"),l(),s(25,"p",17),p(26,"Structurez votre organisation"),l(),s(27,"div",18)(28,"div",19)(29,"div",20),M(30,"lucide-icon",11),l(),s(31,"div",21),p(32),l(),s(33,"div",22),p(34,"Soci\xE9t\xE9s"),l()(),s(35,"div",19)(36,"div",23),M(37,"lucide-icon",12),l(),s(38,"div",21),p(39),l(),s(40,"div",22),p(41,"D\xE9partements"),l()(),s(42,"div",19)(43,"div",24),M(44,"lucide-icon",13),l(),s(45,"div",21),p(46),l(),s(47,"div",22),p(48,"Services"),l()(),s(49,"div",19)(50,"div",25),M(51,"lucide-icon",14),l(),s(52,"div",21),p(53),l(),s(54,"div",22),p(55,"\xC9quipes"),l()()(),s(56,"section",26)(57,"div",27),Pe(58,ud,1,4,"ng-container",null,sn),l()()(),q(60,Sd,32,13,"div",28),b(61,Ld,17,17,"ng-template",null,0,fn),l()}t&2&&(c(11),g("size",20),c(3),g("size",20),c(3),g("size",20),c(3),g("size",20),c(10),g("size",24),c(2),j(o.societes.length),c(5),g("size",24),c(2),j(o.departements.length),c(5),g("size",24),c(2),j(o.services.length),c(5),g("size",24),c(2),j(o.equipes.length),c(5),Se(o.orgTree),c(2),W(o.showCreateModal||o.showEditModal?60:-1))},dependencies:[G,Kn,Vr,Z,Re,Ve,ee,je,te,ne,Fd,de],styles:[".organization-view[_ngcontent-%COMP%]{min-height:100vh;background:#f3f4f6;font-family:Inter,sans-serif}.header[_ngcontent-%COMP%]{background:#fff;padding:16px 32px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #e5e7eb;position:sticky;top:0;z-index:10}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:24px}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.logo-text[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#111827}.header-right[_ngcontent-%COMP%]{display:flex;gap:12px}.header-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;color:#374151;transition:all .2s}.header-btn[_ngcontent-%COMP%]:hover{background:#f9fafb;border-color:#d1d5db;color:#111827}.main-content[_ngcontent-%COMP%]{padding:32px}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#111827;margin:0 0 4px}.page-subtitle[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin:0 0 32px}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;margin-bottom:40px}.stat-card[_ngcontent-%COMP%]{background:#fff;padding:24px;border-radius:16px;box-shadow:0 4px 6px -1px #0000000d,0 2px 4px -1px #00000008;display:flex;flex-direction:column;align-items:center;transition:all .2s;border:1px solid #f3f4f6}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 10px 15px -3px #0000001a}.stat-icon[_ngcontent-%COMP%]{margin-bottom:12px;padding:12px;border-radius:12px;display:flex;align-items:center;justify-content:center}.stat-icon.societe[_ngcontent-%COMP%]{color:#3b82f6;background:#eff6ff}.stat-icon.departement[_ngcontent-%COMP%]{color:#8b5cf6;background:#f5f3ff}.stat-icon.service[_ngcontent-%COMP%]{color:#10b981;background:#ecfdf5}.stat-icon.equipe[_ngcontent-%COMP%]{color:#f97316;background:#fff7ed}.stat-value[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#111827;line-height:1;margin-bottom:4px}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;font-weight:500}.org-structure[_ngcontent-%COMP%]{background:transparent}.tree-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.tree-node[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px 20px;background:#fff;border-radius:16px;border:1px solid #e5e7eb;transition:all .2s;position:relative;cursor:pointer}.tree-node[_ngcontent-%COMP%]:hover{border-color:#3b82f6;box-shadow:0 4px 12px #0000000d;transform:translateY(-1px)}.toggle-icon[_ngcontent-%COMP%]{cursor:pointer;color:#9ca3af;display:flex;align-items:center;justify-content:center;width:24px;height:24px;margin-right:12px;border-radius:4px}.toggle-icon[_ngcontent-%COMP%]:hover{background:#e5e7eb;color:#4b5563}.toggle-placeholder[_ngcontent-%COMP%]{width:32px}.node-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;margin-right:16px;background:#f3f4f6;color:#6b7280;flex-shrink:0}.node-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:baseline;gap:8px}.node-name[_ngcontent-%COMP%]{font-weight:700;color:#111827;font-size:16px}.node-code[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;font-weight:500}.kebab-menu-container[_ngcontent-%COMP%]{position:relative}.kebab-btn[_ngcontent-%COMP%]{background:transparent;border:none;cursor:pointer;padding:4px;border-radius:4px;color:#9ca3af;display:flex;opacity:0;transition:opacity .2s}.tree-node[_ngcontent-%COMP%]:hover   .kebab-btn[_ngcontent-%COMP%]{opacity:1}.kebab-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb;color:#4b5563}.menu-dropdown[_ngcontent-%COMP%]{position:absolute;right:0;top:100%;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 4px 12px #0000001a;py:4px;min-width:120px;z-index:20;overflow:hidden;display:flex;flex-direction:column}.menu-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:8px 12px;text-align:left;cursor:pointer;font-size:13px;color:#374151;width:100%}.menu-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f3f4f6}.menu-dropdown[_ngcontent-%COMP%]   button.delete-btn[_ngcontent-%COMP%]{color:#ef4444}.menu-dropdown[_ngcontent-%COMP%]   button.delete-btn[_ngcontent-%COMP%]:hover{background:#fee2e2}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:50;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:24px;width:100%;max-width:480px;box-shadow:0 20px 25px -5px #0000001a}.modal-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#111827;margin-bottom:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px;display:flex;flex-direction:column;gap:8px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;color:#111827;transition:border-color .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3b82f6;outline:none;ring:2px solid #fee2e2}.color-input[_ngcontent-%COMP%]{width:60px;height:36px;padding:2px;cursor:pointer;border-radius:6px;border:1px solid #d1d5db}.color-hex-input[_ngcontent-%COMP%]{flex:1;text-transform:uppercase}.color-palette[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}.color-swatch[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:8px;cursor:pointer;transition:all .2s;border:2px solid transparent}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.color-swatch.active[_ngcontent-%COMP%]{border-color:#111827;box-shadow:0 0 0 2px #fff,0 0 0 4px #111827}.custom-trigger[_ngcontent-%COMP%]{background:#f3f4f6;border:1px dashed #d1d5db;display:flex;align-items:center;justify-content:center;color:#6b7280}.custom-trigger.active[_ngcontent-%COMP%]{border:2px solid #111827;background:#fff}.custom-preview[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:6px}.custom-color-input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-top:12px;padding:12px;background:#f9fafb;border-radius:12px;border:1px solid #e5e7eb}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:32px}.btn-cancel[_ngcontent-%COMP%]{padding:10px 20px;background:#fff;border:1px solid #d1d5db;border-radius:8px;font-weight:500;color:#374151;cursor:pointer}.btn-confirm[_ngcontent-%COMP%]{padding:10px 20px;background:#3b82f6;border:none;border-radius:8px;font-weight:500;color:#fff;cursor:pointer}.btn-confirm[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-confirm[_ngcontent-%COMP%]:active{transform:translateY(1px)}"]});let i=r;return i})();var ln=(()=>{let r=class r{constructor(e){this.supabase=e,this._equipesCache=null,this._rolesCache=null,this._personnesCache=null,this._equipeResourcesCache=new Map,this._capacitesCache=new Map,this._allCapacitiesCache=null}clearCache(){this._equipesCache=null,this._rolesCache=null,this._personnesCache=null,this._equipeResourcesCache.clear(),this._capacitesCache.clear(),this._allCapacitiesCache=null}getAllEquipes(){return C(this,null,function*(){if(this._equipesCache)return this._equipesCache;let{data:e,error:t}=yield this.supabase.client.from("equipes").select("*").order("nom");if(t)throw t;return this._equipesCache=e||[],this._equipesCache})}getEquipeResources(e){return C(this,null,function*(){if(this._equipeResourcesCache.has(e))return this._equipeResourcesCache.get(e);let t=[],{data:o,error:a}=yield this.supabase.client.from("role_attachments").select("id, role_id, roles(*)").eq("equipe_id",e);!a&&o&&o.forEach(v=>{v.roles&&t.push({type:"role",id:v.roles.id,uniqueId:v.id,nom:v.roles.nom,jours_par_semaine:v.roles.jours_par_semaine})});let{data:d,error:m}=yield this.supabase.client.from("personnes").select("*").eq("equipe_id",e);return!m&&d&&d.forEach(v=>{t.push({type:"personne",id:v.id,uniqueId:v.id,nom:v.nom,prenom:v.prenom,jours_par_semaine:v.jours_par_semaine})}),this._equipeResourcesCache.set(e,t),t})}getAllRoles(){return C(this,null,function*(){if(this._rolesCache)return this._rolesCache;let{data:e,error:t}=yield this.supabase.client.from("roles").select("*").order("nom");if(t)throw t;return this._rolesCache=e||[],this._rolesCache})}getAvailableRolesForEquipe(e){return C(this,null,function*(){let t=yield this.getAllRoles(),{data:o,error:a}=yield this.supabase.client.from("role_attachments").select("role_id").eq("equipe_id",e);if(a)throw a;let d=new Set((o||[]).map(m=>m.role_id));return t.filter(m=>!d.has(m.id))})}getAllPersonnes(){return C(this,null,function*(){if(this._personnesCache)return this._personnesCache;let{data:e,error:t}=yield this.supabase.client.from("personnes").select("*").order("nom",{ascending:!0});if(t)throw t;return this._personnesCache=e||[],this._personnesCache})}getAvailablePersonnesForEquipe(e){return C(this,null,function*(){let t=yield this.getAllPersonnes(),{data:o,error:a}=yield this.supabase.client.from("personnes").select("id").eq("equipe_id",e);if(a)throw a;let d=new Set((o||[]).map(m=>m.id));return t.filter(m=>!d.has(m.id))})}addRoleToEquipe(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("role_attachments").insert({role_id:t,equipe_id:e});if(o)throw o.code==="23505"||o.message.includes("unique_role_per_team")?new Error("Ce r\xF4le est d\xE9j\xE0 attach\xE9 \xE0 cette \xE9quipe."):o;this.clearCache()})}addPersonneToEquipe(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("personnes").update({equipe_id:e}).eq("id",t);if(o)throw o;this.clearCache()})}removeRoleFromEquipe(e,t){return C(this,null,function*(){let{error:o}=yield this.supabase.client.from("role_attachments").delete().eq("role_id",e).eq("equipe_id",t);if(o)throw o;this.clearCache()})}removePersonneFromEquipe(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("personnes").update({equipe_id:null}).eq("id",e);if(t)throw t;this.clearCache()})}getCapacites(e,t,o){return C(this,null,function*(){let a=`${e}:${t}:${o}`;if(this._capacitesCache.has(a))return this._capacitesCache.get(a);let d=this.supabase.client.from("capacites").select("*").eq("equipe_id",o);t==="role"?d.eq("role_id",e):d.eq("personne_id",e);let{data:m,error:v}=yield d.order("semaine_debut");if(v)throw v;let x=m||[];return this._capacitesCache.set(a,x),x})}saveCapacite(e,t,o,a,d){return C(this,null,function*(){let m={semaine_debut:a,capacite:d,equipe_id:o};t==="role"?m.role_id=e:m.personne_id=e;let v=this.supabase.client.from("capacites").select("id").eq("semaine_debut",a).eq("equipe_id",o);t==="role"?v.eq("role_id",e):v.eq("personne_id",e);let{data:x}=yield v.single();if(x){let{error:w}=yield this.supabase.client.from("capacites").update({capacite:d}).eq("id",x.id);if(w)throw w}else{let{error:w}=yield this.supabase.client.from("capacites").insert(m);if(w)throw w}this.clearCache()})}deleteCapacite(e,t,o){return C(this,null,function*(){let a=this.supabase.client.from("capacites").delete().eq("semaine_debut",o);t==="role"?a.eq("role_id",e):a.eq("personne_id",e);let{error:d}=yield a;if(d)throw d;this.clearCache()})}getAllCapacities(){return C(this,null,function*(){if(this._allCapacitiesCache)return this._allCapacitiesCache;let{data:e,error:t}=yield this.supabase.client.from("capacites").select("*");if(t)throw t;return this._allCapacitiesCache=e||[],this._allCapacitiesCache})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var zd=["bulkCapaciteInput"];function qd(i,r){if(i&1){let n=E();s(0,"div",31)(1,"div",32)(2,"span",33),p(3),l(),s(4,"span",34),p(5),l(),s(6,"button",35),_("click",function(){let t=f(n).$implicit,o=u(2).$implicit,a=u();return h(a.removeResource(t,o.equipe))}),p(7,"\xD7"),l()()()}if(i&2){let n=r.$implicit;c(3),j(n.type==="role"?"\u{1F464}":"\u{1F468}"),c(2),j(n.label)}}function Wd(i,r){if(i&1&&(Oe(0),b(1,qd,8,2,"div",30),ke()),i&2){let n=u().$implicit;c(),g("ngForOf",n.resources)}}function Ud(i,r){if(i&1){let n=E();Oe(0),s(1,"div",25)(2,"div",26),_("click",function(){let t=f(n).$implicit,o=u();return h(o.toggleTeam(t))}),M(3,"lucide-icon",27),s(4,"strong"),p(5),l(),s(6,"button",28),_("click",function(t){let o=f(n).$implicit;return u().openAddResourceModal(o.equipe),h(t.stopPropagation())}),p(7," + Ressource "),l()()(),b(8,Wd,2,1,"ng-container",29),ke()}if(i&2){let n=r.$implicit;c(3),g("name",n.expanded?"chevron-down":"chevron-right")("size",18),c(2),j(n.equipe.nom),c(3),g("ngIf",n.expanded)}}function $d(i,r){i&1&&(s(0,"div",36)(1,"p"),p(2,"Aucune \xE9quipe"),l()())}function Bd(i,r){if(i&1&&(s(0,"div",37)(1,"div",38),p(2),l(),s(3,"div",39),p(4),l()()),i&2){let n=r.$implicit,e=u();U("current-week",e.isCurrentWeek(n)),c(2),j(e.formatWeekHeader(n)),c(2),y("S",e.getWeekNumber(n))}}function Hd(i,r){if(i&1&&(s(0,"div",47),p(1),se(2,"number"),l()),i&2){let n=u(2).$implicit,e=u().$implicit,t=u();c(),y(" ",le(2,1,t.getTeamTotalDays(e,n),"1.1-1"),"j ")}}function Gd(i,r){if(i&1&&(s(0,"div",44)(1,"div",45),p(2),se(3,"number"),l(),b(4,Hd,3,4,"div",46),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u();c(2),y(" ",le(3,2,t.getTeamTotalCapacity(e,n),"1.0-1")," "),c(2),g("ngIf",t.showDaysInCells)}}function Jd(i,r){if(i&1&&(s(0,"div",42),b(1,Gd,5,5,"div",43),l()),i&2){let n=r.$implicit,e=u().$implicit,t=u();c(),g("ngIf",t.getTeamTotalCapacity(e,n)>0)}}function Yd(i,r){if(i&1&&(s(0,"div",47),p(1),se(2,"number"),l()),i&2){let n=u(2).$implicit,e=u().$implicit,t=u(3);c(),y(" ",le(2,1,t.getCapacite(e,n)*e.jours_par_semaine,"1.1-1"),"j ")}}function Qd(i,r){if(i&1&&(s(0,"div",53)(1,"div",45),p(2),l(),b(3,Yd,3,4,"div",46),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u(3);c(2),j(t.getCapacite(e,n)),c(),g("ngIf",t.showDaysInCells)}}function Kd(i,r){if(i&1&&(s(0,"div",51),b(1,Qd,4,2,"div",52),l()),i&2){let n=r.$implicit,e=r.index,t=u().$implicit,o=u(3);U("selected",o.isCellSelected(t,n))("has-capacity",o.getCapacite(t,n)>0),Me("data-week-index",e),c(),g("ngIf",o.getCapacite(t,n)>0)}}function Zd(i,r){if(i&1){let n=E();s(0,"div",49),_("mousedown",function(t){let o=f(n).$implicit,a=u(3);return h(a.onMouseDown(t,o))})("mousemove",function(t){let o=f(n).$implicit,a=u(3);return h(a.onMouseMove(t,o))})("mouseup",function(){f(n);let t=u(3);return h(t.onMouseUp())})("mouseleave",function(){f(n);let t=u(3);return h(t.onMouseUp())}),b(1,Kd,2,6,"div",50),l()}if(i&2){let n=r.$implicit,e=u(3);Me("data-resource-id",n.uniqueId),c(),g("ngForOf",e.displayedWeeks)}}function Xd(i,r){if(i&1&&(Oe(0),b(1,Zd,2,2,"div",48),ke()),i&2){let n=u().$implicit;c(),g("ngForOf",n.resources)}}function ep(i,r){if(i&1&&(Oe(0),s(1,"div",40),b(2,Jd,2,1,"div",41),l(),b(3,Xd,2,1,"ng-container",29),ke()),i&2){let n=r.$implicit,e=u();c(2),g("ngForOf",e.displayedWeeks),c(),g("ngIf",n.expanded)}}function tp(i,r){i&1&&(s(0,"div",54)(1,"p"),p(2,"Aucune donn\xE9e"),l()())}function np(i,r){if(i&1){let n=E();s(0,"div",55)(1,"div",56),p(2),s(3,"div",57),p(4),se(5,"number"),l()(),s(6,"div",58)(7,"input",59,0),O("ngModelChange",function(t){f(n);let o=u();return S(o.bulkCapaciteValue,t)||(o.bulkCapaciteValue=t),h(t)}),_("keydown.enter",function(){f(n);let t=u();return h(t.applyBulkCapacite())}),l()(),s(9,"div",60)(10,"button",61),_("click",function(){f(n);let t=u();return h(t.clearSelection())}),p(11,"Annuler"),l(),s(12,"button",8),_("click",function(){f(n);let t=u();return h(t.applyBulkCapacite())}),p(13,"Appliquer"),l()()()}if(i&2){let n=u();oe("top",n.toolbarPosition==null?null:n.toolbarPosition.top,"px")("left",n.toolbarPosition==null?null:n.toolbarPosition.left,"px")("transform","translate(-50%, 10px)")("opacity",n.toolbarVisible?1:0),c(2),y(" ",n.selectedCells.length," semaine(s) s\xE9lectionn\xE9e(s) "),c(2),y(" Total jours s\xE9lectionn\xE9s: ",le(5,11,n.totalSelectedDays,"1.1-1"),"j "),c(3),P("ngModel",n.bulkCapaciteValue)}}function ip(i,r){i&1&&(s(0,"div",76)(1,"p"),p(2,"Aucun r\xF4le disponible. Tous les r\xF4les sont d\xE9j\xE0 utilis\xE9s."),l()())}function op(i,r){if(i&1&&(s(0,"option",79),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),Ie(" ",n.nom," (",n.jours_par_semaine,"j/sem) ")}}function rp(i,r){if(i&1){let n=E();s(0,"select",68),O("ngModelChange",function(t){f(n);let o=u(3);return S(o.selectedResourceId,t)||(o.selectedResourceId=t),h(t)}),s(1,"option",77),p(2,"-- Choisir un r\xF4le --"),l(),b(3,op,2,3,"option",78),l()}if(i&2){let n=u(3);P("ngModel",n.selectedResourceId),c(3),g("ngForOf",n.availableRoles)}}function ap(i,r){if(i&1&&(s(0,"div",67)(1,"label"),p(2,"S\xE9lectionner un r\xF4le"),l(),b(3,ip,3,0,"div",74)(4,rp,4,2,"select",75),l()),i&2){let n=u(2);c(3),g("ngIf",n.availableRoles.length===0),c(),g("ngIf",n.availableRoles.length>0)}}function sp(i,r){i&1&&(s(0,"div",76)(1,"p"),p(2,"Aucune personne disponible."),l()())}function lp(i,r){if(i&1&&(s(0,"option",79),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),Gn(" ",n.prenom," ",n.nom," (",n.jours_par_semaine,"j/sem) ")}}function cp(i,r){if(i&1){let n=E();s(0,"select",68),O("ngModelChange",function(t){f(n);let o=u(3);return S(o.selectedResourceId,t)||(o.selectedResourceId=t),h(t)}),s(1,"option",77),p(2,"-- Choisir une personne --"),l(),b(3,lp,2,4,"option",78),l()}if(i&2){let n=u(3);P("ngModel",n.selectedResourceId),c(3),g("ngForOf",n.availablePersonnes)}}function dp(i,r){if(i&1&&(s(0,"div",67)(1,"label"),p(2,"S\xE9lectionner une personne"),l(),b(3,sp,3,0,"div",74)(4,cp,4,2,"select",75),l()),i&2){let n=u(2);c(3),g("ngIf",n.availablePersonnes.length===0),c(),g("ngIf",n.availablePersonnes.length>0)}}function pp(i,r){if(i&1){let n=E();s(0,"div",62),_("click",function(){f(n);let t=u();return h(t.showAddResourceModal=!1)}),s(1,"div",63),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",64)(3,"h2"),p(4),l(),s(5,"button",65),_("click",function(){f(n);let t=u();return h(t.showAddResourceModal=!1)}),p(6,"\xD7"),l()(),s(7,"div",66)(8,"div",67)(9,"label"),p(10,"Type de ressource"),l(),s(11,"select",68),O("ngModelChange",function(t){f(n);let o=u();return S(o.resourceTypeToAdd,t)||(o.resourceTypeToAdd=t),h(t)}),s(12,"option",69),p(13,"R\xF4le"),l(),s(14,"option",70),p(15,"Personne"),l()()(),b(16,ap,5,2,"div",71)(17,dp,5,2,"div",71),s(18,"div",72)(19,"button",73),_("click",function(){f(n);let t=u();return h(t.addResourceToTeam())}),p(20," Ajouter "),l(),s(21,"button",4),_("click",function(){f(n);let t=u();return h(t.showAddResourceModal=!1)}),p(22,"Annuler"),l()()()()()}if(i&2){let n=u();c(4),y("Ajouter une Ressource \xE0 ",n.selectedEquipe==null?null:n.selectedEquipe.nom),c(7),P("ngModel",n.resourceTypeToAdd),c(5),g("ngIf",n.resourceTypeToAdd==="role"),c(),g("ngIf",n.resourceTypeToAdd==="personne"),c(2),g("disabled",!n.selectedResourceId||n.resourceTypeToAdd==="role"&&n.availableRoles.length===0||n.resourceTypeToAdd==="personne"&&n.availablePersonnes.length===0)}}var up=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Be({type:r}),r.\u0275inj=Ue({imports:[K.pick({ChevronDown:Ct,ChevronRight:vt,Plus:He,User:$t,Users:xt}),K]});let i=r;return i})(),as=(()=>{let r=class r{constructor(e,t){this.teamService=e,this.calendarService=t,this.displayedWeeks=[],this.currentDate=new Date,this.teamRows=[],this.availableRoles=[],this.availablePersonnes=[],this.showAddResourceModal=!1,this.selectedEquipe=null,this.resourceTypeToAdd="role",this.selectedResourceId="",this.isDragging=!1,this.dragStartResource=null,this.dragStartWeekIndex=-1,this.dragEndWeekIndex=-1,this.selectedCells=[],this.isSelectionFinished=!1,this.toolbarPosition=null,this.toolbarVisible=!1,this.bulkCapaciteValue=null,this.showDaysInCells=!1}ngOnInit(){return C(this,null,function*(){this.generateWeeks(),yield this.loadData()})}generateWeeks(){this.displayedWeeks=[];let e=new Date(this.currentDate);e.setDate(1);let t=this.calendarService.getWeekStart(e);for(let o=0;o<32;o++){let a=new Date(t);a.setDate(a.getDate()+o*7),this.displayedWeeks.push(a)}}loadData(){return C(this,null,function*(){try{let e=yield this.teamService.getAllEquipes();this.availableRoles=yield this.teamService.getAllRoles(),this.availablePersonnes=yield this.teamService.getAllPersonnes(),this.teamRows=[];for(let t of e){let o=yield this.teamService.getEquipeResources(t.id),a=[];for(let d of o){let m=yield this.teamService.getCapacites(d.id,d.type,t.id),v=new Map;m.forEach(x=>{let w=this.calendarService.formatWeekStart(new Date(x.semaine_debut));v.set(w,x.capacite)}),a.push({type:d.type,id:d.id,uniqueId:d.uniqueId,label:d.type==="role"?d.nom:`${d.prenom} ${d.nom}`,equipeId:t.id,weeks:v,jours_par_semaine:d.jours_par_semaine})}this.teamRows.push({equipe:t,resources:a,expanded:!0})}}catch(e){console.error("Error loading data:",e)}})}formatWeekHeader(e){let t=e.getDate().toString().padStart(2,"0"),o=(e.getMonth()+1).toString().padStart(2,"0");return`${t}/${o}`}getWeekNumber(e){return this.calendarService.getWeekNumber(e)}isCurrentWeek(e){let t=new Date,o=this.calendarService.getWeekStart(t);return this.calendarService.formatWeekStart(e)===this.calendarService.formatWeekStart(o)}getCapacite(e,t){let o=this.calendarService.formatWeekStart(t);return e.weeks.get(o)||0}toggleTeam(e){e.expanded=!e.expanded}openAddResourceModal(e){return C(this,null,function*(){this.selectedEquipe=e,this.resourceTypeToAdd="role",this.selectedResourceId="",this.showAddResourceModal=!0,this.availableRoles=yield this.teamService.getAvailableRolesForEquipe(e.id),this.availablePersonnes=yield this.teamService.getAvailablePersonnesForEquipe(e.id)})}addResourceToTeam(){return C(this,null,function*(){if(!(!this.selectedEquipe||!this.selectedResourceId))try{this.resourceTypeToAdd==="role"?yield this.teamService.addRoleToEquipe(this.selectedEquipe.id,this.selectedResourceId):yield this.teamService.addPersonneToEquipe(this.selectedEquipe.id,this.selectedResourceId),this.showAddResourceModal=!1,yield this.loadData()}catch(e){console.error("Error adding resource:",e),e.message&&e.message.includes("d\xE9j\xE0 attach\xE9")?alert(e.message):alert("Erreur lors de l'ajout de la ressource. Veuillez r\xE9essayer.")}})}removeResource(e,t){return C(this,null,function*(){if(confirm(`Retirer ${e.label} de l'\xE9quipe ${t.nom} ?`))try{e.type==="role"?yield this.teamService.removeRoleFromEquipe(e.id,t.id):yield this.teamService.removePersonneFromEquipe(e.id),yield this.loadData()}catch(o){console.error("Error removing resource:",o)}})}onMouseDown(e,t){this.isDragging=!0,this.isSelectionFinished=!1,this.dragStartResource=t;let a=e.target.closest(".week-cell");if(a){let d=a.getAttribute("data-week-index");d&&(this.dragStartWeekIndex=parseInt(d,10),this.dragEndWeekIndex=this.dragStartWeekIndex,this.updateSelection())}}onMouseMove(e,t){if(!this.isDragging||!this.dragStartResource||t.uniqueId!==this.dragStartResource.uniqueId)return;let a=e.target.closest(".week-cell");if(a){let d=a.getAttribute("data-week-index");if(d){let m=parseInt(d,10);m!==this.dragEndWeekIndex&&(this.dragEndWeekIndex=m,this.updateSelection())}}}onMouseUp(){this.isDragging=!1,this.selectedCells.length>0&&(this.isSelectionFinished=!0,this.updateToolbarPosition())}updateToolbarPosition(){!this.dragStartResource||this.dragEndWeekIndex<0||setTimeout(()=>{let e=`[data-resource-id="${this.dragStartResource.uniqueId}"]`,t=document.querySelector(e);if(t){let o=`[data-week-index="${this.dragEndWeekIndex}"]`,a=t.querySelector(o);if(a){let d=a.getBoundingClientRect();this.toolbarPosition={top:d.bottom,left:d.left+d.width/2},this.toolbarVisible=!0,setTimeout(()=>{this.bulkCapaciteInput?.nativeElement.focus()},50)}}},0)}updateSelection(){if(!this.dragStartResource||this.dragStartWeekIndex<0||this.dragEndWeekIndex<0)return;this.selectedCells=[];let e=Math.min(this.dragStartWeekIndex,this.dragEndWeekIndex),t=Math.max(this.dragStartWeekIndex,this.dragEndWeekIndex);for(let o=e;o<=t;o++)this.selectedCells.push({resource:this.dragStartResource,week:this.displayedWeeks[o]})}isCellSelected(e,t){return this.selectedCells.some(o=>o.resource.uniqueId===e.uniqueId&&o.week.getTime()===t.getTime())}clearSelection(){this.selectedCells=[],this.isSelectionFinished=!1,this.toolbarPosition=null,this.toolbarVisible=!1,this.dragStartResource=null,this.dragStartWeekIndex=-1,this.dragEndWeekIndex=-1}applyBulkCapacite(){return C(this,null,function*(){if(!(this.selectedCells.length===0||this.bulkCapaciteValue==null))try{for(let e of this.selectedCells){let t=this.calendarService.formatWeekStart(e.week);yield this.teamService.saveCapacite(e.resource.id,e.resource.type,e.resource.equipeId,t,this.bulkCapaciteValue),e.resource.weeks.set(t,this.bulkCapaciteValue)}this.clearSelection()}catch(e){console.error("Error saving capacities:",e)}})}get totalSelectedDays(){let e=0;for(let t of this.selectedCells){let o=this.getCapacite(t.resource,t.week)||0,a=t.resource.jours_par_semaine||0;e+=o*a}return e}goToPreviousMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1),this.generateWeeks()}goToNextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1),this.generateWeeks()}goToToday(){this.currentDate=new Date,this.generateWeeks()}getTeamTotalCapacity(e,t){return e.resources.reduce((o,a)=>o+this.getCapacite(a,t),0)}getTeamTotalDays(e,t){return e.resources.reduce((o,a)=>o+this.getCapacite(a,t)*a.jours_par_semaine,0)}};r.\u0275fac=function(t){return new(t||r)(L(ln),L(an))},r.\u0275cmp=B({type:r,selectors:[["app-capacity-view"]],viewQuery:function(t,o){if(t&1&&kt(zd,5),t&2){let a;lt(a=ct())&&(o.bulkCapaciteInput=a.first)}},decls:35,vars:8,consts:[["bulkCapaciteInput",""],[1,"capacity-container"],[1,"capacity-header"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click"],[1,"calendar-controls"],[1,"date-navigation"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"controls-right",2,"display","flex","align-items","center","gap","12px"],["title","Afficher les jours (j)",1,"ios-switch"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"ios-slider"],[2,"user-select","none"],[1,"calendar-wrapper"],[1,"labels-column"],[1,"labels-header"],[4,"ngFor","ngForOf"],["class","empty-state-label",4,"ngIf"],[1,"weeks-column"],[1,"weeks-header"],["class","week-header",3,"current-week",4,"ngFor","ngForOf"],["class","empty-state-weeks",4,"ngIf"],["class","selection-toolbar",3,"top","left","transform","opacity",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"team-label-row"],[1,"team-label",3,"click"],[1,"expand-icon-l",3,"name","size"],[1,"btn","btn-xs","btn-add",3,"click"],[4,"ngIf"],["class","resource-label-row",4,"ngFor","ngForOf"],[1,"resource-label-row"],[1,"resource-label"],[1,"resource-type-icon"],[1,"resource-name"],[1,"btn","btn-xs","btn-danger",3,"click"],[1,"empty-state-label"],[1,"week-header"],[1,"week-date"],[1,"week-number"],[1,"team-weeks-row"],["class","week-cell team-cell",4,"ngFor","ngForOf"],[1,"week-cell","team-cell"],["class","team-summary",4,"ngIf"],[1,"team-summary"],[1,"capacity-value"],["class","days-value",4,"ngIf"],[1,"days-value"],["class","resource-weeks-row",3,"mousedown","mousemove","mouseup","mouseleave",4,"ngFor","ngForOf"],[1,"resource-weeks-row",3,"mousedown","mousemove","mouseup","mouseleave"],["class","week-cell resource-cell",3,"selected","has-capacity",4,"ngFor","ngForOf"],[1,"week-cell","resource-cell"],["class","cell-content",4,"ngIf"],[1,"cell-content"],[1,"empty-state-weeks"],[1,"selection-toolbar"],[1,"selection-info"],[1,"selection-total"],[1,"selection-input-row"],["type","number","placeholder","Capacit\xE9 (unit\xE9s)","step","0.5","min","0",1,"bulk-input",3,"ngModelChange","keydown.enter","ngModel"],[1,"selection-actions"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[1,"modal-body"],[1,"form-group"],[1,"form-control",3,"ngModelChange","ngModel"],["value","role"],["value","personne"],["class","form-group",4,"ngIf"],[1,"modal-actions"],[1,"btn","btn-primary",3,"click","disabled"],["class","no-roles-message",4,"ngIf"],["class","form-control",3,"ngModel","ngModelChange",4,"ngIf"],[1,"no-roles-message"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){t&1&&(s(0,"div",1)(1,"div",2)(2,"h1"),p(3,"Gestion de Capacit\xE9 par \xC9quipe"),l(),s(4,"div",3)(5,"button",4),_("click",function(){return o.goToToday()}),p(6,"Aujourd'hui"),l()()(),s(7,"div",5)(8,"div",6)(9,"button",7),_("click",function(){return o.goToPreviousMonth()}),p(10,"\u2190 Mois pr\xE9c\xE9dent"),l(),s(11,"button",8),_("click",function(){return o.goToToday()}),p(12,"Aujourd'hui"),l(),s(13,"button",7),_("click",function(){return o.goToNextMonth()}),p(14,"Mois suivant \u2192"),l()(),s(15,"div",9)(16,"label",10)(17,"input",11),O("ngModelChange",function(d){return S(o.showDaysInCells,d)||(o.showDaysInCells=d),d}),l(),M(18,"span",12),l(),s(19,"span",13),p(20,"Afficher les jours (j) dans les cellules"),l()()(),s(21,"div",14)(22,"div",15)(23,"div",16)(24,"span"),p(25,"\xC9quipes / Ressources"),l()(),b(26,Ud,9,4,"ng-container",17)(27,$d,3,0,"div",18),l(),s(28,"div",19)(29,"div",20),b(30,Bd,5,4,"div",21),l(),b(31,ep,4,2,"ng-container",17)(32,tp,3,0,"div",22),l()(),b(33,np,14,14,"div",23),l(),b(34,pp,23,5,"div",24)),t&2&&(c(17),P("ngModel",o.showDaysInCells),c(9),g("ngForOf",o.teamRows),c(),g("ngIf",o.teamRows.length===0),c(3),g("ngForOf",o.displayedWeeks),c(),g("ngForOf",o.teamRows),c(),g("ngIf",o.teamRows.length===0),c(),g("ngIf",o.selectedCells.length>0&&o.isSelectionFinished),c(),g("ngIf",o.showAddResourceModal))},dependencies:[G,Ce,X,Z,Re,Ve,ee,Qe,ii,je,te,Bt,ne,up,de,Zn],styles:['.capacity-container[_ngcontent-%COMP%]{padding:20px;background:#f5f7fa;min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}.capacity-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.calendar-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.date-navigation[_ngcontent-%COMP%]{display:flex;gap:8px}.calendar-wrapper[_ngcontent-%COMP%]{display:flex;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden;max-height:calc(100vh - 200px);position:relative}.labels-column[_ngcontent-%COMP%]{width:300px;flex-shrink:0;border-right:2px solid #e2e8f0;overflow-y:auto;overflow-x:hidden}.labels-header[_ngcontent-%COMP%]{padding:12px 16px;background:#f8fafc;border-bottom:2px solid #e2e8f0;font-weight:600;position:sticky;top:0;z-index:10;min-height:60px;display:flex;align-items:center}.team-label-row[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;background:#f9fafb}.team-label[_ngcontent-%COMP%]{padding:12px 16px;display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:600;-webkit-user-select:none;user-select:none;min-height:48px}.team-label[_ngcontent-%COMP%]:hover{background:#f3f4f6}.expand-icon[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.resource-label-row[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;background:#fff}.resource-label-row[_ngcontent-%COMP%]:hover{background:#f9fafb}.resource-label[_ngcontent-%COMP%]{padding:12px 16px 12px 32px;display:flex;align-items:center;gap:8px;min-height:48px}.resource-type-icon[_ngcontent-%COMP%]{font-size:16px}.resource-name[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.btn-add[_ngcontent-%COMP%]{margin-left:auto;padding:2px 8px;font-size:11px}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;font-size:14px;line-height:1}.btn-danger[_ngcontent-%COMP%]:hover{background:#dc2626}.empty-state-label[_ngcontent-%COMP%]{padding:40px 20px;text-align:center;color:#6b7280}.weeks-column[_ngcontent-%COMP%]{flex:1;overflow-x:auto;overflow-y:auto}.weeks-header[_ngcontent-%COMP%]{display:flex;background:#f8fafc;border-bottom:2px solid #e2e8f0;position:sticky;top:0;z-index:10;min-height:60px}.week-header[_ngcontent-%COMP%]{min-width:80px;width:80px;padding:8px;text-align:center;border-right:1px solid #e2e8f0;font-size:12px;display:flex;flex-direction:column;justify-content:center;flex-shrink:0}.week-header.current-week[_ngcontent-%COMP%]{background:#dbeafe;border-left:2px solid #3b82f6;border-right:2px solid #3b82f6}.week-date[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.week-number[_ngcontent-%COMP%]{font-size:11px;color:#6b7280}.team-weeks-row[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #e2e8f0;background:#f9fafb;min-height:48px}.resource-weeks-row[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #e2e8f0;background:#fff;min-height:48px;-webkit-user-select:none;user-select:none}.resource-weeks-row[_ngcontent-%COMP%]:hover{background:#f9fafb}.week-cell[_ngcontent-%COMP%]{min-width:80px;width:80px;padding:8px;border-right:1px solid #e2e8f0;text-align:center;display:flex;align-items:center;justify-content:center;flex-shrink:0}.team-cell[_ngcontent-%COMP%]{background:#f9fafb}.resource-cell[_ngcontent-%COMP%]{cursor:pointer;transition:background .15s ease;position:relative}.resource-cell[_ngcontent-%COMP%]:hover{background:#f3f4f6}.resource-cell.selected[_ngcontent-%COMP%]{background:#dbeafe;border:2px solid #3b82f6}.resource-cell.has-capacity[_ngcontent-%COMP%]{background:#d1fae5;font-weight:600;color:#059669}.resource-cell.has-capacity.selected[_ngcontent-%COMP%]{background:#a7f3d0;border:2px solid #3b82f6}.cell-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.1}.capacity-value[_ngcontent-%COMP%]{font-size:13px;font-weight:600}.days-value[_ngcontent-%COMP%]{font-size:10px;opacity:.9}.team-summary[_ngcontent-%COMP%]{color:#6b7280;display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.1}.empty-state-weeks[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#6b7280}.selection-toolbar[_ngcontent-%COMP%]{position:fixed;background:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 10px 25px #0003;align-items:center;gap:16px;z-index:1000;transition:top .2s ease,left .2s ease;min-width:260px}.selection-info[_ngcontent-%COMP%]{font-weight:600;color:#374151}.selection-total[_ngcontent-%COMP%]{font-weight:500;font-size:13px;margin-top:6px;margin-bottom:10px;color:#065f46}.selection-input-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;display:flex;gap:8px;align-items:center;margin-bottom:12px;width:100%}.selection-actions[_ngcontent-%COMP%]{display:flex;flex:1;gap:8px;align-items:center;justify-content:center}.selection-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.bulk-input[_ngcontent-%COMP%]{width:150px;padding:6px 12px;border:1px solid #d1d5db;border-radius:6px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:2000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;min-width:500px;max-width:90vw;max-height:90vh;overflow:auto}.modal-header[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#6b7280;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px}.modal-close[_ngcontent-%COMP%]:hover{background:#f3f4f6}.modal-body[_ngcontent-%COMP%]{padding:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#374151}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}.no-roles-message[_ngcontent-%COMP%]{padding:9px;background:#fef3c7;border:1px solid #f59e0b;border-radius:6px;color:#92400e;text-align:center}.no-roles-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:24px}.ios-switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:40px;height:20px;vertical-align:middle}.ios-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0;position:absolute;left:0;top:0}.ios-slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:#e5e7eb;border-radius:999px;transition:background-color .18s ease;box-shadow:inset 0 0 0 1px #00000008}.ios-slider[_ngcontent-%COMP%]:before{content:"";position:absolute;height:14px;width:14px;left:3px;top:3px;background:#fff;border-radius:50%;transition:transform .22s cubic-bezier(.2,.8,.2,1),box-shadow .12s ease;box-shadow:0 1px 2px #0000002e}.ios-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .ios-slider[_ngcontent-%COMP%]{background-color:#34d399}.ios-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .ios-slider[_ngcontent-%COMP%]:before{transform:translate(20px)}.ios-switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus + .ios-slider[_ngcontent-%COMP%]{box-shadow:0 0 0 4px #3b82f61f}']});let i=r;return i})();var ss=(()=>{let r=class r{constructor(e){this.supabase=e,this._servicesCache=null}clearCache(){this._servicesCache=null}getAllServices(){return C(this,null,function*(){if(this._servicesCache)return this._servicesCache;let{data:e,error:t}=yield this.supabase.client.from("services").select("*").order("nom",{ascending:!0});if(t)throw t;return this._servicesCache=e||[],this._servicesCache})}getIdByServiceId(e){return C(this,null,function*(){return(yield this.getAllServices()).find(a=>a.id_service===e)?.id||null})}getServiceByServiceId(e){return C(this,null,function*(){return(yield this.getAllServices()).find(o=>o.id_service===e)||null})}getServiceIdById(e){return C(this,null,function*(){return(yield this.getAllServices()).find(a=>a.id===e)?.id_service||null})}getService(e){return C(this,null,function*(){if(this._servicesCache){let a=this._servicesCache.find(d=>d.id===e);if(a)return a}let{data:t,error:o}=yield this.supabase.client.from("services").select("*").eq("id",e).maybeSingle();if(o)throw o;return t})}createService(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("services").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updateService(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("services").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteService(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("services").delete().eq("id",e);if(t)throw t;this.clearCache()})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var ls=(()=>{let r=class r{constructor(e){this.supabase=e,this._personnesCache=null}clearCache(){this._personnesCache=null}getAllPersonnes(){return C(this,null,function*(){if(this._personnesCache)return this._personnesCache;let{data:e,error:t}=yield this.supabase.client.from("personnes").select("*").order("nom",{ascending:!0});if(t)throw t;return this._personnesCache=e||[],this._personnesCache})}getPersonne(e){return C(this,null,function*(){if(this._personnesCache){let a=this._personnesCache.find(d=>d.id===e);if(a)return a}let{data:t,error:o}=yield this.supabase.client.from("personnes").select("*").eq("id",e).maybeSingle();if(o)throw o;return t})}getServiceIdsByPersonneId(e){return C(this,null,function*(){let t=yield this.getPersonne(e);return t?{service_id:t.service_id||null,id_service:t.id_service||null}:{service_id:null,id_service:null}})}createPersonne(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("personnes").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updatePersonne(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("personnes").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deletePersonne(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("personnes").delete().eq("id",e);if(t)throw t;this.clearCache()})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var Fi=(()=>{let r=class r{constructor(e,t){this.supabase=e,this.teamService=t,this._chargesCache=null}clearCache(){this._chargesCache=null}getAllCharges(){return C(this,null,function*(){if(this._chargesCache)return this._chargesCache;let{data:e,error:t}=yield this.supabase.client.from("charges").select("*").order("semaine_debut");if(t)throw t;return this._chargesCache=e||[],this._chargesCache})}getChargesByProject(e){return C(this,null,function*(){if(this._chargesCache)return this._chargesCache.filter(a=>a.projet_id===e);let{data:t,error:o}=yield this.supabase.client.from("charges").select("*").eq("projet_id",e).order("semaine_debut");if(o)throw o;return t||[]})}getChargesByTeam(e){return C(this,null,function*(){if(this._chargesCache)return this._chargesCache.filter(a=>a.equipe_id===e);let{data:t,error:o}=yield this.supabase.client.from("charges").select("*").eq("equipe_id",e).order("semaine_debut");if(o)throw o;return t||[]})}createChargeWithoutDates(e,t,o,a,d=1){return C(this,null,function*(){let m={projet_id:e,equipe_id:t,unite_ressource:d,semaine_debut:null,semaine_fin:null};o&&(m.role_id=o),a&&(m.personne_id=a);let{data:v,error:x}=yield this.supabase.client.from("charges").insert([m]).select().single();if(x)throw x;return this.clearCache(),v})}createOrUpdateCharge(e,t,o,a,d,m){return C(this,null,function*(){let v=this.supabase.client.from("charges").select("*").eq("projet_id",e).eq("equipe_id",t).eq("semaine_debut",o);d?v=v.eq("role_id",d):v=v.is("role_id",null),m?v=v.eq("personne_id",m):v=v.is("personne_id",null);let{data:x,error:w}=yield v;if(w)throw w;let k={projet_id:e,equipe_id:t,semaine_debut:o,semaine_fin:o,unite_ressource:a};if(d&&(k.role_id=d),m&&(k.personne_id=m),x&&x.length>0){let{data:V,error:$}=yield this.supabase.client.from("charges").update({unite_ressource:a}).eq("id",x[0].id).select().single();if($)throw $;return this.clearCache(),V}else{let{data:V,error:$}=yield this.supabase.client.from("charges").insert([k]).select().single();if($)throw $;return this.clearCache(),V}})}getAvailableRolesForProjectTeam(e,t){return C(this,null,function*(){let o=yield this.teamService.getAllRoles(),a=yield this.supabase.client.from("charges").select("role_id").eq("projet_id",e).eq("equipe_id",t);if(a.error)throw a.error;let d=new Set((a.data||[]).filter(m=>m.role_id).map(m=>m.role_id));return o.filter(m=>!d.has(m.id))})}getAvailablePersonnesForProjectTeam(e,t){return C(this,null,function*(){let o=yield this.teamService.getAllPersonnes(),a=yield this.supabase.client.from("charges").select("personne_id").eq("projet_id",e).eq("equipe_id",t);if(a.error)throw a.error;let d=new Set((a.data||[]).filter(m=>m.personne_id).map(m=>m.personne_id));return o.filter(m=>!d.has(m.id))})}getChargesByProjectIdAndDate(e,t){return C(this,null,function*(){let o=this.getFirstDayOfWeek(t),{data:a,error:d}=yield this.supabase.client.from("charges").select("*").eq("projet_id",e).gte("semaine_debut",o);if(d)throw d;return a||[]})}getFirstDayOfWeek(e){let t=new Date(e),o=new Date(t);return o.setDate(t.getDate()-t.getDay()+(t.getDay()===0?-6:1)),o.toISOString().split("T")[0]}};r.\u0275fac=function(t){return new(t||r)(R(H),R(ln))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var ds=(()=>{let r=class r{constructor(e,t,o,a,d,m){this.supabase=e,this.servicesService=t,this.rolesService=o,this.personnesService=a,this.chargeService=d,this.projetService=m,this._chiffresCache=null}clearCache(){this._chiffresCache=null}getAllChiffres(){return C(this,null,function*(){if(this._chiffresCache)return this._chiffresCache;let{data:e,error:t}=yield this.supabase.client.from("chiffres").select("*").order("date_mise_a_jour",{ascending:!1});if(t)throw t;return this._chiffresCache=e||[],this._chiffresCache})}getChiffresByProject(e){return C(this,null,function*(){if(this._chiffresCache)return this._chiffresCache.filter(a=>a.id_projet===e);let{data:t,error:o}=yield this.supabase.client.from("chiffres").select("*").eq("id_projet",e).order("id_service");if(o)throw o;return t||[]})}getChiffre(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("chiffres").select("*").eq("id_projet",e).eq("id_service",t).maybeSingle();if(a)throw a;return o})}createChiffre(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("chiffres").insert([{id_projet:e.id_projet,id_service:e.id_service,initial:e.initial||0,revise:e.revise||0,previsionnel:e.previsionnel||0,consomme:e.consomme||0,date_mise_a_jour:e.date_mise_a_jour||new Date().toISOString()}]).select().single();if(o)throw o;return this.clearCache(),t})}updateChiffre(e,t){return C(this,null,function*(){let o={};t.initial!==void 0&&(o.initial=t.initial),t.revise!==void 0&&(o.revise=t.revise),t.previsionnel!==void 0&&(o.previsionnel=t.previsionnel),t.consomme!==void 0&&(o.consomme=t.consomme),t.date_mise_a_jour!==void 0&&(o.date_mise_a_jour=t.date_mise_a_jour),o.updated_at=new Date().toISOString();let{data:a,error:d}=yield this.supabase.client.from("chiffres").update(o).eq("id_chiffres",e).select().single();if(d)throw d;return this.clearCache(),a})}deleteChiffre(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("chiffres").delete().eq("id_chiffres",e);if(t)throw t;this.clearCache()})}getRAFByDate(e,t,o){return C(this,null,function*(){let a=yield this.projetService.getProjetIdUUID(e),d=yield this.chargeService.getChargesByProjectIdAndDate(a,o);console.log(d);let m=[];for(let x of d){if(x.role_id&&(yield this.rolesService.getIdServiceListFromRoleId(x.role_id)).includes(t)){m.push(x);let k=yield this.rolesService.getRole(x.role_id);k&&(x.jours_par_semaine=k.jours_par_semaine)}if(x.personne_id&&(yield this.personnesService.getServiceIdsByPersonneId(x.personne_id)).id_service===t){m.push(x);let k=yield this.personnesService.getPersonne(x.personne_id);k&&(x.jours_par_semaine=k.jours_par_semaine)}}return console.log("filteredData : "+m),m.reduce((x,w)=>x+(w.unite_ressource||0)*(w.jours_par_semaine||0),0)})}};r.\u0275fac=function(t){return new(t||r)(R(H),R(ss),R(Ni),R(ls),R(Fi),R(tt))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function hp(i,r){if(i&1&&(s(0,"div",24),p(1),l()),i&2){let n=u(2);c(),y(" ",n.error," ")}}function _p(i,r){i&1&&(s(0,"div",25)(1,"p")(2,"strong"),p(3,"Delta:"),l(),p(4," Pr\xE9visionnel - R\xE9vis\xE9"),l(),s(5,"p")(6,"strong"),p(7,"Restant:"),l(),p(8," Pr\xE9visionnel - Consomm\xE9"),l(),s(9,"p")(10,"strong"),p(11,"RAF:"),l(),p(12," Ressources affect\xE9es \xE0 partir de la date s\xE9lectionn\xE9e"),l(),s(13,"p")(14,"strong"),p(15,"Copier-coller:"),l(),p(16," Vous pouvez copier des cellules Excel (Initial, R\xE9vis\xE9, Pr\xE9visionnel, Consomm\xE9) et les coller pour remplir automatiquement. "),l()())}function Cp(i,r){if(i&1){let n=E();s(0,"tr",26)(1,"td",27),p(2),l(),s(3,"td")(4,"input",28),O("ngModelChange",function(t){let o=f(n).$implicit,a=u(2);return S(a.getChiffresData(a.getNumericId(o)).initial,t)||(a.getChiffresData(a.getNumericId(o)).initial=t),h(t)}),_("change",function(){let t=f(n).$implicit,o=u(2);return h(o.onValueChange(o.getNumericId(t),"initial"))})("paste",function(t){let o=f(n).$implicit,a=u(2);return h(a.handlePaste(t,a.getNumericId(o),"initial"))}),l()(),s(5,"td")(6,"input",28),O("ngModelChange",function(t){let o=f(n).$implicit,a=u(2);return S(a.getChiffresData(a.getNumericId(o)).revise,t)||(a.getChiffresData(a.getNumericId(o)).revise=t),h(t)}),_("change",function(){let t=f(n).$implicit,o=u(2);return h(o.onValueChange(o.getNumericId(t),"revise"))})("paste",function(t){let o=f(n).$implicit,a=u(2);return h(a.handlePaste(t,a.getNumericId(o),"revise"))}),l()(),s(7,"td")(8,"input",28),O("ngModelChange",function(t){let o=f(n).$implicit,a=u(2);return S(a.getChiffresData(a.getNumericId(o)).previsionnel,t)||(a.getChiffresData(a.getNumericId(o)).previsionnel=t),h(t)}),_("change",function(){let t=f(n).$implicit,o=u(2);return h(o.onValueChange(o.getNumericId(t),"previsionnel"))})("paste",function(t){let o=f(n).$implicit,a=u(2);return h(a.handlePaste(t,a.getNumericId(o),"previsionnel"))}),l()(),s(9,"td")(10,"input",28),O("ngModelChange",function(t){let o=f(n).$implicit,a=u(2);return S(a.getChiffresData(a.getNumericId(o)).consomme,t)||(a.getChiffresData(a.getNumericId(o)).consomme=t),h(t)}),_("change",function(){let t=f(n).$implicit,o=u(2);return h(o.onValueChange(o.getNumericId(t),"consomme"))})("paste",function(t){let o=f(n).$implicit,a=u(2);return h(a.handlePaste(t,a.getNumericId(o),"consomme"))}),l()(),s(11,"td",29),p(12),l(),s(13,"td",29),p(14),l(),s(15,"td",29),p(16),l(),s(17,"td")(18,"input",30),O("ngModelChange",function(t){let o=f(n).$implicit,a=u(2);return S(a.getChiffresData(a.getNumericId(o)).date_mise_a_jour,t)||(a.getChiffresData(a.getNumericId(o)).date_mise_a_jour=t),h(t)}),l()()()}if(i&2){let n,e,t,o=r.$implicit,a=u(2);c(2),y(" ",o.nom," "),c(2),P("ngModel",a.getChiffresData(a.getNumericId(o)).initial),c(2),P("ngModel",a.getChiffresData(a.getNumericId(o)).revise),c(2),P("ngModel",a.getChiffresData(a.getNumericId(o)).previsionnel),c(2),P("ngModel",a.getChiffresData(a.getNumericId(o)).consomme),c(2),y(" ",((n=a.getChiffresData(a.getNumericId(o)).delta)==null?null:n.toFixed(3))||"0.000"," "),c(2),y(" ",((e=a.getChiffresData(a.getNumericId(o)).restant)==null?null:e.toFixed(3))||"0.000"," "),c(2),y(" ",((t=a.getChiffresData(a.getNumericId(o)).raf)==null?null:t.toFixed(3))||"0.000"," "),c(2),P("ngModel",a.getChiffresData(a.getNumericId(o)).date_mise_a_jour)}}function vp(i,r){if(i&1){let n=E();s(0,"div",1),_("click",function(){f(n);let t=u();return h(t.onClose())}),s(1,"div",2),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",3)(3,"h2"),p(4,"Chiffrage par service"),l(),s(5,"button",4),_("click",function(){f(n);let t=u();return h(t.onClose())}),p(6,"\xD7"),l()(),b(7,hp,2,1,"div",5),s(8,"div",6)(9,"div",7)(10,"div",8)(11,"label",9),p(12,"RAF au"),l(),s(13,"input",10),O("ngModelChange",function(t){f(n);let o=u();return S(o.rafDate,t)||(o.rafDate=t),h(t)}),_("change",function(){f(n);let t=u();return h(t.onRAFDateChange())}),l()(),s(14,"button",11),_("click",function(){f(n);let t=u();return h(t.showHelp=!t.showHelp)}),M(15,"lucide-icon",12),l()(),s(16,"div",13),b(17,_p,17,0,"div",14),l(),s(18,"div",15)(19,"table",16)(20,"thead")(21,"tr")(22,"th"),p(23,"SERVICE"),l(),s(24,"th"),p(25,"INITIAL"),l(),s(26,"th"),p(27,"R\xC9VIS\xC9"),l(),s(28,"th"),p(29,"PR\xC9VISIONNEL"),l(),s(30,"th"),p(31,"CONSOMM\xC9"),l(),s(32,"th"),p(33,"DELTA"),l(),s(34,"th"),p(35,"RESTANT"),l(),s(36,"th"),p(37,"RAF"),l(),s(38,"th"),p(39,"DATE MAJ"),l()()(),s(40,"tbody"),b(41,Cp,19,9,"tr",17),l(),s(42,"tfoot")(43,"tr",18)(44,"td",19),p(45,"TOTAL"),l(),s(46,"td",20),p(47),l(),s(48,"td",20),p(49),l(),s(50,"td",20),p(51),l(),s(52,"td",20),p(53),l(),s(54,"td",20),p(55),l(),s(56,"td",20),p(57),l(),s(58,"td",20),p(59),l(),M(60,"td"),l()()()()(),s(61,"div",21)(62,"button",22),_("click",function(){f(n);let t=u();return h(t.onClose())}),p(63,"Annuler"),l(),s(64,"button",23),_("click",function(){f(n);let t=u();return h(t.save())}),p(65),l()()()()}if(i&2){let n=u();c(7),g("ngIf",n.error),c(6),P("ngModel",n.rafDate),c(2),g("name",n.LucideHelpCircle),c(2),g("ngIf",n.showHelp),c(24),g("ngForOf",n.services),c(6),y(" ",n.calculateTotal("initial")," "),c(2),y(" ",n.calculateTotal("revise")," "),c(2),y(" ",n.calculateTotal("previsionnel")," "),c(2),y(" ",n.calculateTotal("consomme")," "),c(2),y(" ",n.calculateTotal("delta")," "),c(2),y(" ",n.calculateTotal("restant")," "),c(2),y(" ",n.calculateTotal("raf")," "),c(3),g("disabled",n.isLoading),c(2),g("disabled",n.isLoading),c(),y(" ",n.isLoading?"Enregistrement...":"Enregistrer"," ")}}var ps=(()=>{let r=class r{constructor(e,t){this.chiffresService=e,this.resourceService=t,this.visible=!1,this.idProjet=null,this.close=new ye,this.saved=new ye,this.LucideCalculator=ei,this.LucideHelpCircle=Wr,this.services=[],this.chiffres=new Map,this.rafDate=new Date().toISOString().split("T")[0],this.isLoading=!1,this.showHelp=!1,this.error=""}ngOnInit(){this.loadServices()}ngOnChanges(e){e.visible&&e.visible.currentValue&&this.idProjet&&(console.log("Loading chiffres for project:",this.idProjet),this.loadChiffres())}loadServices(){return C(this,null,function*(){try{this.services=yield this.resourceService.getAllServices()}catch(e){console.error("Error loading services:",e),this.error="Erreur lors du chargement des services"}})}loadChiffres(){return C(this,null,function*(){if(this.idProjet)try{this.isLoading=!0;let e=yield this.chiffresService.getChiffresByProject(this.idProjet);this.chiffres.clear();for(let t of this.services){let o=e.find(d=>d.id_service===t.id_service),a={id_chiffres:o?.id_chiffres,id_service:o?.id_service,initial:o?.initial||void 0,revise:o?.revise||void 0,previsionnel:o?.previsionnel||void 0,consomme:o?.consomme||void 0,date_mise_a_jour:o?.date_mise_a_jour?o.date_mise_a_jour.split("T")[0]:new Date().toISOString().split("T")[0]};this.updateCalculatedFields(a),t.id_service!==void 0&&t.id_service!==null?this.chiffres.set(t.id_service,a):console.error("Le service n'a pas d'id_service !")}for(let t of this.chiffres.keys())this.updateRAF(t);this.isLoading=!1}catch(e){this.error="Erreur lors du chargement des chiffres",this.isLoading=!1,console.error(e)}})}getChiffresData(e){let t=this.chiffres.get(e);return t||{id_service:e,initial:0,revise:0,previsionnel:0,consomme:0,date_mise_a_jour:new Date().toISOString().split("T")[0],delta:0,restant:0,raf:0,raf_date:new Date().toISOString().split("T")[0]}}getServiceName(e){return this.services.find(t=>t.id===e.toString())?.nom||`Service ${e}`}getNumericId(e){return e?e.id_service||0:(console.error("Le service est undefined !"),0)}calculateTotal(e){let t=0;for(let o of this.chiffres.values()){let a=o[e];typeof a=="number"&&(t+=a)}return t.toFixed(3)}updateCalculatedFields(e){e.previsionnel!==void 0&&e.revise!==void 0&&(e.delta=e.previsionnel-e.revise),e.previsionnel!==void 0&&e.consomme!==void 0&&(e.restant=e.previsionnel-e.consomme)}updateRAF(e){return C(this,null,function*(){if(this.idProjet)try{let t=yield this.chiffresService.getRAFByDate(this.idProjet,e,this.rafDate+"T00:00:00"),o=this.chiffres.get(e);o&&(o.raf=t,o.raf_date=this.rafDate)}catch(t){console.error("Error calculating RAF:",t)}})}onValueChange(e,t){let o=this.chiffres.get(e);o&&this.updateCalculatedFields(o)}onRAFDateChange(){for(let e of this.chiffres.keys())this.updateRAF(e)}handlePaste(e,t,o){return C(this,null,function*(){e.preventDefault();let d=(e.clipboardData?.getData("text")||"").trim().split(`
`),m=["initial","revise","previsionnel","consomme"];console.log("fieldName",o);let v=o?m.indexOf(o):0;if(console.log("startFieldIndex",v),v!==-1){if(d.length===1){let x=d[0].split("	").map(w=>w.trim());this.fillRowWithValues(t,x,v)}else if(d.length>1){let x=this.services.findIndex(w=>this.getNumericId(w)===t);d.forEach((w,k)=>{let V=w.split("	").map($=>$.trim());if(x+k<this.services.length){let $=this.getNumericId(this.services[x+k]),re=v;this.fillRowWithValues($,V,re)}})}}})}fillRowWithValues(e,t,o){let a=this.getChiffresData(e);if(!a)return;let d=["initial","revise","previsionnel","consomme"];t.forEach((m,v)=>{let x=o+v;if(x<d.length&&m){let w=d[x],k=parseFloat(m.replace(",","."));if(!isNaN(k)){let V=d[x];a[V]=k,(V==="initial"||V==="revise"||V==="previsionnel"||V==="consomme")&&(a[V]=k)}}}),this.onValueChange(e,d[o])}parseNumber(e){let t=parseFloat(e.trim().replace(",","."));return isNaN(t)?0:t}save(){return C(this,null,function*(){if(this.idProjet)try{this.isLoading=!0;let e=[];for(let[t,o]of this.chiffres.entries()){let a={id_projet:this.idProjet,id_service:t,initial:o.initial||0,revise:o.revise||0,previsionnel:o.previsionnel||0,consomme:o.consomme||0,date_mise_a_jour:o.date_mise_a_jour};if(o.id_chiffres){let d=yield this.chiffresService.updateChiffre(o.id_chiffres,a);e.push(d)}else if(o.initial||o.revise||o.previsionnel||o.consomme){let d=yield this.chiffresService.createChiffre(a);e.push(d)}}this.isLoading=!1,this.saved.emit(e),this.onClose()}catch(e){this.error="Erreur lors de la sauvegarde des chiffres",this.isLoading=!1,console.error(e)}})}onClose(){this.error="",this.close.emit()}};r.\u0275fac=function(t){return new(t||r)(L(ds),L(yt))},r.\u0275cmp=B({type:r,selectors:[["app-chiffres-modal"]],inputs:{visible:"visible",idProjet:"idProjet"},outputs:{close:"close",saved:"saved"},features:[rt],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],["class","error-message",4,"ngIf"],[1,"modal-content"],[1,"raf-date-section"],[1,"raf-date-group"],["for","rafDate"],["type","date","id","rafDate",1,"raf-date-input",3,"ngModelChange","change","ngModel"],["type","button","title","Besoin d'aide ?",1,"help-toggle",3,"click"],["size","20",3,"name"],[1,"help-container"],["class","help-text",4,"ngIf"],[1,"table-container"],[1,"chiffres-table"],["class","service-row",4,"ngFor","ngForOf"],[1,"total-row"],[1,"total-label"],[1,"total-value"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"error-message"],[1,"help-text"],[1,"service-row"],[1,"service-name"],["type","number","placeholder","0",1,"input-field",3,"ngModelChange","change","paste","ngModel"],[1,"calculated-field"],["type","date",1,"input-field",3,"ngModelChange","ngModel"]],template:function(t,o){t&1&&b(0,vp,66,15,"div",0),t&2&&g("ngIf",o.visible)},dependencies:[G,Ce,X,Z,ee,Qe,te,ne,K,de],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 4px 12px #00000026;max-width:90vw;max-height:90vh;width:1400px;display:flex;flex-direction:column;overflow:hidden}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #e0e0e0;background-color:#f5f5f5}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#333}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:28px;cursor:pointer;color:#666;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center}.modal-close[_ngcontent-%COMP%]:hover{color:#000;background-color:#e0e0e0;border-radius:4px}.error-message[_ngcontent-%COMP%]{background-color:#ffebee;border-left:4px solid #f44336;color:#c62828;padding:12px 16px;margin:16px;border-radius:4px}.modal-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:20px}.raf-date-section[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-bottom:24px;padding:16px;background-color:#f9f9f9;border-radius:6px;justify-content:space-between}.raf-date-group[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.raf-date-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;margin:0}.raf-date-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px;min-width:140px}.raf-date-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a}.table-container[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid #e0e0e0;border-radius:6px;margin-bottom:20px}.chiffres-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}.chiffres-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f5f5f5;border-bottom:2px solid #ddd;position:sticky;top:0}.chiffres-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:12px;text-align:left;font-weight:600;color:#333;white-space:nowrap;border-right:1px solid #e0e0e0}.chiffres-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:last-child{border-right:none}.chiffres-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #e0e0e0;transition:background-color .2s}.chiffres-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.chiffres-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-right:1px solid #e0e0e0}.chiffres-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:none}.service-name[_ngcontent-%COMP%]{font-weight:500;color:#333;min-width:180px}.input-field[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:13px;font-family:Courier New,monospace;text-align:right;min-width:100px}.input-field[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a}.input-field[disabled][_ngcontent-%COMP%]{background-color:#f5f5f5;color:#999;cursor:not-allowed}.calculated-field[_ngcontent-%COMP%]{text-align:right;background-color:#f9f9f9;font-family:Courier New,monospace;color:#666;font-weight:500;min-width:100px}.help-toggle[_ngcontent-%COMP%]{background:none;border:none;color:#6366f1;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:8px;border-radius:50%;transition:all .2s;background-color:#fff;border:1px solid #e0e0e0}.help-toggle[_ngcontent-%COMP%]:hover{background-color:#f0f1ff;color:#4f46e5;border-color:#6366f1;transform:scale(1.1)}.total-row[_ngcontent-%COMP%]{background-color:#f0f0f0;font-weight:600;border-top:2px solid #ddd;border-bottom:2px solid #ddd}.total-label[_ngcontent-%COMP%]{color:#333;font-weight:600}.total-value[_ngcontent-%COMP%]{text-align:right;background-color:#e8e8e8;font-family:Courier New,monospace;color:#000}.help-text[_ngcontent-%COMP%]{background-color:#e3f2fd;border-left:4px solid #2196f3;padding:16px;border-radius:4px;margin-top:20px}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0;font-size:13px;color:#1565c0}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{margin-top:0}.help-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;padding:20px;border-top:1px solid #e0e0e0;background-color:#f5f5f5}.btn[_ngcontent-%COMP%]{padding:10px 24px;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s;min-width:100px}.btn-primary[_ngcontent-%COMP%]{background-color:#6366f1;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#4f46e5;box-shadow:0 2px 8px #6366f14d}.btn-primary[disabled][_ngcontent-%COMP%]{background-color:#c7c9e5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background-color:#e0e0e0;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#d0d0d0}.btn-secondary[disabled][_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6}@media (max-width: 1400px){.modal[_ngcontent-%COMP%]{width:calc(100vw - 40px);max-width:none}}@media (max-width: 768px){.modal[_ngcontent-%COMP%]{width:calc(100vw - 20px);max-height:95vh}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px}.chiffres-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .chiffres-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;font-size:12px}.service-name[_ngcontent-%COMP%]{min-width:120px}.input-field[_ngcontent-%COMP%]{min-width:70px;padding:6px}}"]});let i=r;return i})();function xp(i,r){if(i&1){let n=E();Oe(0),s(1,"a",59),_("click",function(t){return f(n),h(t.stopPropagation())}),p(2),M(3,"lucide-icon",45),l(),ke()}if(i&2){let n=u(2).$implicit,e=u(2);c(),g("href",e.externalReferenceUrl+n.reference_externe,io),c(),y(" #",n.reference_externe," "),c(),g("img",e.ExternalLink)("size",12)}}function wp(i,r){if(i&1&&p(0),i&2){let n=u(2).$implicit;y(" #",n.reference_externe," ")}}function bp(i,r){if(i&1&&(s(0,"span",57),b(1,xp,4,4,"ng-container",58)(2,wp,1,1,"ng-template",null,0,fn),l()),i&2){let n=Lt(3),e=u(3);c(),g("ngIf",e.externalReferenceUrl)("ngIfElse",n)}}function yp(i,r){if(i&1){let n=E();s(0,"div",60)(1,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openEditModal(t))}),M(2,"lucide-icon",45),p(3," Modifier "),l(),s(4,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openChiffresModal(t.id_projet))}),M(5,"lucide-icon",45),p(6," G\xE9rer les chiffres "),l(),s(7,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.duplicateProjet(t))}),M(8,"lucide-icon",45),p(9," Dupliquer "),l(),s(10,"button",62),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.deleteProjet(t))}),M(11,"lucide-icon",45),p(12," Supprimer "),l()()}if(i&2){let n=u(3);c(2),g("img",n.Edit)("size",14),c(3),g("img",n.LucideCalculator)("size",14),c(3),g("img",n.Copy)("size",14),c(3),g("img",n.Trash2)("size",14)}}function Mp(i,r){if(i&1&&(s(0,"p",63)(1,"span",64),p(2,"Chef de projet:"),l(),p(3),l()),i&2){let n=u().$implicit;c(3),y(" ",n.chef_projet," ")}}function Pp(i,r){if(i&1&&(s(0,"p",65),p(1),l()),i&2){let n=u().$implicit;c(),j(n.description)}}function Sp(i,r){if(i&1){let n=E();s(0,"div",35),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.openEditModal(t))}),s(1,"div",36)(2,"div",37)(3,"div",38)(4,"span",39),p(5),l(),b(6,bp,4,2,"span",40),l(),s(7,"div",41)(8,"span",42),p(9),l(),s(10,"div",43),_("click",function(t){return f(n),h(t.stopPropagation())}),s(11,"button",44),_("click",function(t){let o=f(n).$implicit,a=u(2);return h(a.toggleMenu(t,o.id))}),M(12,"lucide-icon",45),l(),b(13,yp,13,8,"div",46),l()()()(),s(14,"div",47)(15,"h3",48),p(16),l(),b(17,Mp,4,1,"p",49)(18,Pp,2,1,"p",50),s(19,"div",51)(20,"div",52)(21,"span",53),p(22,"Progression"),l(),s(23,"span",54),p(24),l()(),s(25,"div",55),M(26,"div",56),l()()()()}if(i&2){let n=r.$implicit,e=u(2);oe("border-left-color",n.color||"#3b82f6"),U("menu-active",e.activeMenuId===n.id),c(4),oe("color",n.color||"#3b82f6"),c(),j(n.code_projet),c(),g("ngIf",n.reference_externe),c(2),Me("data-status",n.statut),c(),j(n.statut),c(3),g("img",e.MoreVertical)("size",20),c(),g("ngIf",e.activeMenuId===n.id),c(3),j(n.nom_projet),c(),g("ngIf",n.chef_projet),c(),g("ngIf",n.description),c(6),y("",e.getProgressPercent(n),"%"),c(2),oe("width",e.getProgressPercent(n),"%"),U("warning",e.getProgressPercent(n)>80&&e.getProgressPercent(n)<=100)("danger",e.getProgressPercent(n)>100)}}function Op(i,r){i&1&&(s(0,"div",66)(1,"p"),p(2,"Aucun projet trouv\xE9"),l()())}function kp(i,r){if(i&1&&(s(0,"div",32),b(1,Sp,27,23,"div",33)(2,Op,3,0,"div",34),l()),i&2){let n=u();c(),g("ngForOf",n.filteredProjects),c(),g("ngIf",n.filteredProjects.length===0)}}function Ep(i,r){if(i&1){let n=E();Oe(0),s(1,"a",59),_("click",function(t){return f(n),h(t.stopPropagation())}),p(2),M(3,"lucide-icon",45),l(),ke()}if(i&2){let n=u(2).$implicit,e=u(2);c(),g("href",e.externalReferenceUrl+n.reference_externe,io),c(),y(" #",n.reference_externe," "),c(),g("img",e.ExternalLink)("size",12)}}function Tp(i,r){if(i&1&&p(0),i&2){let n=u(2).$implicit;y(" #",n.reference_externe," ")}}function Ip(i,r){if(i&1&&(s(0,"span"),p(1," \u2022 "),s(2,"span",57),b(3,Ep,4,4,"ng-container",58)(4,Tp,1,1,"ng-template",null,1,fn),l()()),i&2){let n=Lt(5),e=u(3);c(3),g("ngIf",e.externalReferenceUrl)("ngIfElse",n)}}function jp(i,r){if(i&1&&(s(0,"span"),p(1," \u2022 "),s(2,"span",78),p(3),l()()),i&2){let n=u().$implicit;c(3),j(n.chef_projet)}}function Rp(i,r){if(i&1){let n=E();s(0,"div",79)(1,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openEditModal(t))}),M(2,"lucide-icon",45),p(3," Modifier "),l(),s(4,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.openChiffresModal(t.id_projet))}),M(5,"lucide-icon",45),p(6," G\xE9rer les chiffres "),l(),s(7,"button",61),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.duplicateProjet(t))}),M(8,"lucide-icon",45),p(9," Dupliquer "),l(),s(10,"button",62),_("click",function(){f(n);let t=u().$implicit,o=u(2);return h(o.deleteProjet(t))}),M(11,"lucide-icon",45),p(12," Supprimer "),l()()}if(i&2){let n=u(3);c(2),g("img",n.Edit)("size",14),c(3),g("img",n.LucideCalculator)("size",14),c(3),g("img",n.Copy)("size",14),c(3),g("img",n.Trash2)("size",14)}}function Vp(i,r){if(i&1){let n=E();s(0,"div",69),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.openEditModal(t))}),s(1,"div",70)(2,"div",71)(3,"div",72)(4,"span",48),p(5),l(),s(6,"span",73),p(7),l()(),s(8,"div",74)(9,"span",39),p(10),l(),b(11,Ip,6,2,"span",75)(12,jp,4,1,"span",75),l()()(),s(13,"div",76)(14,"div",43),_("click",function(t){return f(n),h(t.stopPropagation())}),s(15,"button",44),_("click",function(t){let o=f(n).$implicit,a=u(2);return h(a.toggleMenu(t,o.id))}),M(16,"lucide-icon",45),l(),b(17,Rp,13,8,"div",77),l()()()}if(i&2){let n=r.$implicit,e=u(2);oe("border-left-color",n.color||"#3b82f6"),U("menu-active",e.activeMenuId===n.id),c(5),j(n.nom_projet),c(),Me("data-status",n.statut),c(),j(n.statut),c(3),j(n.code_projet),c(),g("ngIf",n.reference_externe),c(),g("ngIf",n.chef_projet),c(4),g("img",e.MoreVertical)("size",20),c(),g("ngIf",e.activeMenuId===n.id)}}function Dp(i,r){i&1&&(s(0,"div",66)(1,"p"),p(2,"Aucun projet trouv\xE9"),l()())}function Ap(i,r){if(i&1&&(s(0,"div",67),b(1,Vp,18,13,"div",68)(2,Dp,3,0,"div",34),l()),i&2){let n=u();c(),g("ngForOf",n.filteredProjects),c(),g("ngIf",n.filteredProjects.length===0)}}function Np(i,r){if(i&1){let n=E();s(0,"div",102),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.selectColor(t))}),l()}if(i&2){let n=r.$implicit,e=u(2);oe("background-color",n),U("active",e.newProjet.color===n)}}function Lp(i,r){if(i&1&&M(0,"div",103),i&2){let n=u(2);oe("background-color",n.newProjet.color)}}function Fp(i,r){if(i&1&&M(0,"lucide-icon",45),i&2){let n=u(2);g("img",n.Plus)("size",16)}}function zp(i,r){if(i&1){let n=E();s(0,"div",98)(1,"input",104),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.newProjet.color,t)||(o.newProjet.color=t),h(t)}),l(),s(2,"input",105),O("ngModelChange",function(t){f(n);let o=u(2);return S(o.newProjet.color,t)||(o.newProjet.color=t),h(t)}),l()()}if(i&2){let n=u(2);c(),P("ngModel",n.newProjet.color),c(),P("ngModel",n.newProjet.color)}}function qp(i,r){if(i&1){let n=E();s(0,"div",80),_("mousedown",function(t){f(n);let o=u();return h(o.onOverlayMouseDown(t))})("mouseup",function(t){f(n);let o=u();return h(o.onOverlayMouseUp(t))}),s(1,"div",81),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",82)(3,"h2"),p(4),l(),s(5,"button",83),_("click",function(){f(n);let t=u();return h(t.closeModal())}),p(6,"\xD7"),l()(),s(7,"form",84),_("ngSubmit",function(){f(n);let t=u();return h(t.saveProjet())}),s(8,"div",85)(9,"div",86)(10,"label"),p(11,"Code Projet *"),l(),s(12,"input",87),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.code_projet,t)||(o.newProjet.code_projet=t),h(t)}),l()(),s(13,"div",86)(14,"label"),p(15,"R\xE9f\xE9rence Externe"),l(),s(16,"input",88),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.reference_externe,t)||(o.newProjet.reference_externe=t),h(t)}),l()()(),s(17,"div",89)(18,"label"),p(19,"Nom Projet *"),l(),s(20,"input",90),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.nom_projet,t)||(o.newProjet.nom_projet=t),h(t)}),l()(),s(21,"div",85)(22,"div",86)(23,"label"),p(24,"Statut"),l(),s(25,"select",91),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.statut,t)||(o.newProjet.statut=t),h(t)}),s(26,"option",13),p(27,"En cours"),l(),s(28,"option",14),p(29,"Planifi\xE9"),l(),s(30,"option",15),p(31,"Termin\xE9"),l(),s(32,"option",16),p(33,"En pause"),l(),s(34,"option",12),p(35,"Actif"),l()()(),s(36,"div",86)(37,"label"),p(38,"Chef de Projet"),l(),s(39,"input",92),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.chef_projet,t)||(o.newProjet.chef_projet=t),h(t)}),l()()(),s(40,"div",89)(41,"label"),p(42,"Description"),l(),s(43,"textarea",93),O("ngModelChange",function(t){f(n);let o=u();return S(o.newProjet.description,t)||(o.newProjet.description=t),h(t)}),l()(),s(44,"div",89)(45,"label"),p(46,"Couleur"),l(),s(47,"div",94),Pe(48,Np,1,4,"div",95,Nt),s(50,"div",96),_("click",function(){f(n);let t=u();return h(t.isCustomColor=!0)}),q(51,Lp,1,2,"div",97)(52,Fp,1,2,"lucide-icon",45),l()(),q(53,zp,3,2,"div",98),l(),s(54,"div",99)(55,"button",100),p(56),l(),s(57,"button",101),_("click",function(){f(n);let t=u();return h(t.closeModal())}),p(58,"Annuler"),l()()()()()}if(i&2){let n=u();c(4),j(n.editingProjetId?"Modifier le projet":"Nouveau Projet"),c(8),P("ngModel",n.newProjet.code_projet),c(4),P("ngModel",n.newProjet.reference_externe),c(4),P("ngModel",n.newProjet.nom_projet),c(5),P("ngModel",n.newProjet.statut),c(14),P("ngModel",n.newProjet.chef_projet),c(4),P("ngModel",n.newProjet.description),c(5),Se(n.predefinedColors),c(2),U("active",n.isCustomColor),c(),W(n.isCustomColor?51:52),c(2),W(n.isCustomColor?53:-1),c(3),j(n.editingProjetId?"Mettre \xE0 jour":"Cr\xE9er")}}var us=(()=>{let r=class r{constructor(e,t){this.projetService=e,this.settingsService=t,this.viewMode="list",this.searchQuery="",this.statusFilter="",this.LucideCalculator=ei,this.MoreVertical=zt,this.Edit=ti,this.Trash2=ni,this.Copy=Ur,this.ExternalLink=$r,this.Plus=He,this.projets=[],this.filteredProjects=[],this.externalReferenceUrl=null,this.showProjectModal=!1,this.editingProjetId=null,this.activeMenuId=null,this.isMouseDownOnOverlay=!1,this.showChiffresModal=!1,this.selectedProjetId=null,this.predefinedColors=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],this.isCustomColor=!1,this.newProjet={code_projet:"",nom_projet:"",statut:"En cours",description:"",reference_externe:"",color:"#3b82f6"}}onDocumentClick(e){this.activeMenuId&&(this.activeMenuId=null)}toggleMenu(e,t){e.stopPropagation(),this.activeMenuId===t?this.activeMenuId=null:this.activeMenuId=t}ngOnInit(){return C(this,null,function*(){yield this.loadProjects(),this.externalReferenceUrl=yield this.settingsService.getSettingValue("external_reference_url","global")})}loadProjects(){return C(this,null,function*(){try{this.projets=yield this.projetService.getAllProjets(),this.filterProjects()}catch(e){console.error("Error loading projects:",e)}})}filterProjects(){this.filteredProjects=this.projets.filter(e=>{let t=!this.searchQuery||e.nom_projet.toLowerCase().includes(this.searchQuery.toLowerCase())||e.code_projet.toLowerCase().includes(this.searchQuery.toLowerCase()),o=!this.statusFilter||e.statut===this.statusFilter;return t&&o})}getProgressPercent(e){if(e.chiffrage_previsionnel===0)return 0;let t=e.temps_consomme/e.chiffrage_previsionnel*100;return Math.min(Math.round(t),100)}calculateRAF(e){return this.projetService.calculateRAF(e)}openCreateModal(){this.editingProjetId=null,this.newProjet={code_projet:"",nom_projet:"",statut:"En cours",description:"",reference_externe:"",color:"#3b82f6"},this.isCustomColor=!1,this.showProjectModal=!0,this.activeMenuId=null}selectColor(e){this.newProjet.color=e,this.isCustomColor=!1}openEditModal(e){this.editingProjetId=e.id,this.newProjet=T({},e),this.isCustomColor=!this.predefinedColors.includes(this.newProjet.color),this.showProjectModal=!0,this.activeMenuId=null}duplicateProjet(e){this.editingProjetId=null,console.log("PROJET Origine : ",e);let m=e,{id:t,created_at:o,updated_at:a}=m,d=Jo(m,["id","created_at","updated_at"]);this.newProjet=me(T({},d),{code_projet:`${e.code_projet}-COPY`,nom_projet:`${e.nom_projet} (Copie)`}),console.log("PROJET Copie : ",this.newProjet),this.showProjectModal=!0,this.activeMenuId=null}onOverlayMouseDown(e){e.target===e.currentTarget&&(this.isMouseDownOnOverlay=!0)}onOverlayMouseUp(e){this.isMouseDownOnOverlay&&e.target===e.currentTarget&&this.closeModal(),this.isMouseDownOnOverlay=!1}closeModal(){this.showProjectModal=!1,this.editingProjetId=null}deleteProjet(e){return C(this,null,function*(){if(this.activeMenuId=null,confirm(`\xCAtes-vous s\xFBr de vouloir supprimer le projet "${e.nom_projet}" ?`))try{yield this.projetService.deleteProjet(e.id),yield this.loadProjects()}catch(t){console.error("Error deleting project:",t)}})}saveProjet(){return C(this,null,function*(){try{this.editingProjetId?yield this.projetService.updateProjet(this.editingProjetId,this.newProjet):yield this.projetService.createProjet(this.newProjet),this.closeModal(),yield this.loadProjects()}catch(e){console.error("Error saving project:",e)}})}openChiffresModal(e){this.selectedProjetId=e,this.showChiffresModal=!0,this.activeMenuId=null}closeChiffresModal(){this.showChiffresModal=!1}onChiffresModalSaved(e){console.log("Chiffres sauvegard\xE9s:",e)}};r.\u0275fac=function(t){return new(t||r)(L(tt),L(ea))},r.\u0275cmp=B({type:r,selectors:[["app-projects-view"]],hostBindings:function(t,o){t&1&&_("click",function(d){return o.onDocumentClick(d)},Bn)},decls:43,vars:11,consts:[["noLink",""],["noLinkList",""],[1,"projects-container"],[1,"projects-header"],[1,"subtitle"],[1,"btn","btn-primary",3,"click"],[1,"projects-controls"],[1,"search-box"],["type","text","placeholder","Rechercher un projet...",1,"search-input",3,"ngModelChange","ngModel"],[1,"controls-right"],[1,"filter-select",3,"ngModelChange","ngModel"],["value",""],["value","Actif"],["value","En cours"],["value","Planifi\xE9"],["value","Termin\xE9"],["value","En pause"],[1,"view-toggle"],["title","Vue en cartes",1,"toggle-btn",3,"click"],["width","20","height","20","viewBox","0 0 20 20","fill","currentColor"],["x","2","y","2","width","7","height","7","rx","1"],["x","11","y","2","width","7","height","7","rx","1"],["x","2","y","11","width","7","height","7","rx","1"],["x","11","y","11","width","7","height","7","rx","1"],["title","Vue en liste",1,"toggle-btn",3,"click"],["x","2","y","3","width","16","height","2","rx","1"],["x","2","y","8","width","16","height","2","rx","1"],["x","2","y","13","width","16","height","2","rx","1"],["class","projects-grid",4,"ngIf"],["class","projects-list-view",4,"ngIf"],["class","modal-overlay",3,"mousedown","mouseup",4,"ngIf"],[3,"close","saved","visible","idProjet"],[1,"projects-grid"],["class","project-card",3,"border-left-color","menu-active","click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"project-card",3,"click"],[1,"card-header"],[1,"card-header-top"],[1,"project-identifiers"],[1,"project-code"],["class","external-ref-tag",4,"ngIf"],[1,"header-actions"],[1,"status-badge"],[1,"menu-container",3,"click"],[1,"menu-btn",3,"click"],[3,"img","size"],["class","dropdown-menu",4,"ngIf"],[1,"card-body"],[1,"project-name"],["class","project-manager",4,"ngIf"],["class","project-description",4,"ngIf"],[1,"progress-section"],[1,"progress-header"],[1,"progress-label"],[1,"progress-percent"],[1,"progress-bar"],[1,"progress-fill"],[1,"external-ref-tag"],[4,"ngIf","ngIfElse"],["target","_blank",1,"ref-link",3,"click","href"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"],[1,"dropdown-item","delete",3,"click"],[1,"project-manager"],[1,"label"],[1,"project-description"],[1,"empty-state"],[1,"projects-list-view"],["class","project-list-card",3,"border-left-color","menu-active","click",4,"ngFor","ngForOf"],[1,"project-list-card",3,"click"],[1,"card-left"],[1,"project-info"],[1,"project-name-row"],[1,"status-badge","small"],[1,"project-meta"],[4,"ngIf"],[1,"card-right"],["class","dropdown-menu right",4,"ngIf"],[1,"manager-name"],[1,"dropdown-menu","right"],[1,"modal-overlay",3,"mousedown","mouseup"],[1,"modal",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[1,"form",3,"ngSubmit"],[1,"grid","grid-2"],[1,"form-group"],["name","code","required","",3,"ngModelChange","ngModel"],["name","ref_ext","placeholder","ex: JIRA-123",3,"ngModelChange","ngModel"],[1,"form-group","full-width"],["name","nom","required","",3,"ngModelChange","ngModel"],["name","statut",3,"ngModelChange","ngModel"],["name","chef",3,"ngModelChange","ngModel"],["name","desc","rows","3",3,"ngModelChange","ngModel"],[1,"color-palette"],[1,"color-swatch",3,"background-color","active"],[1,"color-swatch","custom-trigger",3,"click"],[1,"custom-preview",3,"background-color"],[1,"custom-color-input-wrapper"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"color-swatch",3,"click"],[1,"custom-preview"],["type","color","name","customColor",1,"color-input",3,"ngModelChange","ngModel"],["type","text","name","customColorText","placeholder","#HEXCODE",1,"color-hex-input",3,"ngModelChange","ngModel"]],template:function(t,o){t&1&&(s(0,"div",2)(1,"div",3)(2,"div")(3,"h1"),p(4,"Projets"),l(),s(5,"p",4),p(6,"G\xE9rez vos projets et leur chiffrage"),l()(),s(7,"button",5),_("click",function(){return o.openCreateModal()}),p(8,"+ Nouveau projet"),l()(),s(9,"div",6)(10,"div",7)(11,"input",8),O("ngModelChange",function(d){return S(o.searchQuery,d)||(o.searchQuery=d),d}),_("ngModelChange",function(){return o.filterProjects()}),l()(),s(12,"div",9)(13,"select",10),O("ngModelChange",function(d){return S(o.statusFilter,d)||(o.statusFilter=d),d}),_("ngModelChange",function(){return o.filterProjects()}),s(14,"option",11),p(15,"Tous les statuts"),l(),s(16,"option",12),p(17,"Actif"),l(),s(18,"option",13),p(19,"En cours"),l(),s(20,"option",14),p(21,"Planifi\xE9"),l(),s(22,"option",15),p(23,"Termin\xE9"),l(),s(24,"option",16),p(25,"En pause"),l()(),s(26,"div",17)(27,"button",18),_("click",function(){return o.viewMode="card"}),ht(),s(28,"svg",19),M(29,"rect",20)(30,"rect",21)(31,"rect",22)(32,"rect",23),l()(),Ot(),s(33,"button",24),_("click",function(){return o.viewMode="list"}),ht(),s(34,"svg",19),M(35,"rect",25)(36,"rect",26)(37,"rect",27),l()()()()(),b(38,kp,3,2,"div",28)(39,Ap,3,2,"div",29),l(),b(40,qp,59,12,"div",30),Ot(),s(41,"div")(42,"app-chiffres-modal",31),_("close",function(){return o.closeChiffresModal()})("saved",function(d){return o.onChiffresModalSaved(d)}),l()()),t&2&&(c(11),P("ngModel",o.searchQuery),c(2),P("ngModel",o.statusFilter),c(14),U("active",o.viewMode==="card"),c(6),U("active",o.viewMode==="list"),c(5),g("ngIf",o.viewMode==="card"),c(),g("ngIf",o.viewMode==="list"),c(),g("ngIf",o.showProjectModal),c(2),g("visible",o.showChiffresModal)("idProjet",o.selectedProjetId))},dependencies:[G,Ce,X,Z,we,Re,Ve,ee,je,te,ve,be,ne,xe,ps,K,de],styles:['.projects-container[_ngcontent-%COMP%]{padding:32px;background:#f5f7fa;min-height:100vh}.projects-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}.projects-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 4px;font-size:32px;font-weight:700;color:#111827}.subtitle[_ngcontent-%COMP%]{margin:0;color:#6b7280;font-size:16px}.projects-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:24px;flex-wrap:wrap}.search-box[_ngcontent-%COMP%]{flex:1;min-width:300px;max-width:500px}.search-input[_ngcontent-%COMP%]{width:100%;padding:10px 16px;border:1px solid #e5e7eb;border-radius:8px;font-size:14px;transition:all .2s}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.controls-right[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.filter-select[_ngcontent-%COMP%]{padding:10px 16px;border:1px solid #e5e7eb;border-radius:8px;background:#fff;font-size:14px;cursor:pointer;transition:all .2s}.filter-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.view-toggle[_ngcontent-%COMP%]{display:flex;gap:4px;background:#fff;padding:4px;border-radius:8px;border:1px solid #e5e7eb}.toggle-btn[_ngcontent-%COMP%]{padding:8px 12px;border:none;background:transparent;border-radius:6px;cursor:pointer;color:#6b7280;transition:all .2s;display:flex;align-items:center;justify-content:center}.toggle-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.toggle-btn.active[_ngcontent-%COMP%]{background:#4f46e5;color:#fff}.projects-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:24px}.project-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;position:relative;box-shadow:0 1px 3px #0000001a;transition:all .3s cubic-bezier(.4,0,.2,1);border-left:4px solid #4f46e5;cursor:pointer}.project-card.menu-active[_ngcontent-%COMP%], .project-list-card.menu-active[_ngcontent-%COMP%]{z-index:100;position:relative}.project-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 25px #00000026;transform:translateY(-4px)}.card-header[_ngcontent-%COMP%]{padding:16px 20px 12px;border-bottom:1px solid #f3f4f6}.card-header-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.project-identifiers[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.project-code[_ngcontent-%COMP%]{font-family:Consolas,Monaco,monospace;font-weight:700;font-size:13px;letter-spacing:.5px}.status-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}.status-badge[data-status=Actif][_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.status-badge[data-status="En cours"][_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.status-badge[data-status=Planifi\\e9][_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.status-badge[data-status=Termin\\e9][_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.status-badge[data-status="En pause"][_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.status-badge.small[_ngcontent-%COMP%]{padding:2px 8px;font-size:11px}.card-body[_ngcontent-%COMP%]{padding:20px}.project-name[_ngcontent-%COMP%]{margin:0 0 12px;font-size:18px;font-weight:600;color:#111827;line-height:1.4}.project-manager[_ngcontent-%COMP%]{margin:0 0 12px;color:#6b7280;font-size:14px}.project-manager[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#9ca3af}.project-description[_ngcontent-%COMP%]{margin:0 0 16px;color:#6b7280;font-size:14px;line-height:1.6;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.metrics[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px;padding:16px;background:#f9fafb;border-radius:8px}.metric-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.metric-label[_ngcontent-%COMP%]{font-size:11px;font-weight:500;color:#9ca3af;text-transform:uppercase;letter-spacing:.5px}.metric-value[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#111827}.progress-section[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid #f3f4f6}.progress-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.progress-label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#6b7280}.progress-value[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#111827}.progress-bar[_ngcontent-%COMP%]{height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden;margin-bottom:8px}.progress-bar.small[_ngcontent-%COMP%]{height:6px;margin:0}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#10b981;transition:width .3s ease;border-radius:4px}.progress-fill.warning[_ngcontent-%COMP%]{background:#f59e0b}.progress-fill.danger[_ngcontent-%COMP%]{background:#ef4444}.raf-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.raf-label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#6b7280}.raf-value[_ngcontent-%COMP%]{font-size:14px;font-weight:700;color:#10b981}.raf-value.negative[_ngcontent-%COMP%]{color:#ef4444}.projects-list-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.project-list-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-left:4px solid #4f46e5;border-radius:12px;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;transition:all .2s;cursor:pointer}.project-list-card[_ngcontent-%COMP%]:hover{border-color:#4f46e5;box-shadow:0 4px 12px #0000000d;transform:translateY(-1px)}.card-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.project-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.project-name-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.project-name[_ngcontent-%COMP%]{font-weight:700;color:#111827;font-size:16px}.project-meta[_ngcontent-%COMP%]{font-size:13px;color:#6b7280;font-weight:500;display:flex;align-items:center;gap:4px}.manager-name[_ngcontent-%COMP%]{color:#4f46e5;font-weight:600}.external-ref-tag[_ngcontent-%COMP%]{display:inline-flex;align-items:center;background:#f3f4f6;padding:2px 8px;border-radius:6px;border:1px solid #e5e7eb;transition:all .2s}.external-ref-tag[_ngcontent-%COMP%]:hover{background:#e5e7eb;border-color:#d1d5db}.ref-link[_ngcontent-%COMP%]{color:#4f46e5;text-decoration:none;font-weight:600;font-size:12px;display:flex;align-items:center;gap:4px}.ref-link[_ngcontent-%COMP%]:hover{color:#4338ca;text-decoration:underline}.ref-link[_ngcontent-%COMP%]   lucide-icon[_ngcontent-%COMP%]{display:flex;align-items:center}.color-palette[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:4px}.color-swatch[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:8px;cursor:pointer;transition:all .2s;border:2px solid transparent}.color-swatch[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.color-swatch.active[_ngcontent-%COMP%]{border-color:#111827;box-shadow:0 0 0 2px #fff,0 0 0 4px #111827}.color-input[_ngcontent-%COMP%]{width:60px;height:40px;padding:2px;cursor:pointer;border-radius:8px;border:1px solid #d1d5db}.color-hex-input[_ngcontent-%COMP%]{flex:1;text-transform:uppercase}.custom-trigger[_ngcontent-%COMP%]{background:#f3f4f6;border:2px dashed #d1d5db;display:flex;align-items:center;justify-content:center;color:#6b7280}.custom-trigger.active[_ngcontent-%COMP%]{border:2px solid #111827;background:#fff;color:#111827}.custom-preview[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:6px}.custom-color-input-wrapper[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-top:16px;padding:12px;background:#f9fafb;border-radius:12px;border:1px solid #e5e7eb}.form-group.full-width[_ngcontent-%COMP%]{grid-column:span 2}.empty-state[_ngcontent-%COMP%]{padding:48px;text-align:center;color:#9ca3af;font-size:15px;background:#fff;border-radius:16px;border:2px dashed #e5e7eb}.menu-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.menu-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#9ca3af;padding:4px;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.menu-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:160px;background:#fff;border-radius:8px;box-shadow:0 4px 12px #0000001a,0 0 0 1px #0000000d;padding:4px;z-index:50;margin-top:4px}.dropdown-menu.right[_ngcontent-%COMP%]{right:0}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;padding:8px 12px;text-align:left;border:none;background:transparent;font-size:13px;color:#374151;cursor:pointer;border-radius:4px;transition:background .15s}.dropdown-item[_ngcontent-%COMP%]:hover{background:#f3f4f6}.dropdown-item[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#6b7280}.dropdown-item.delete[_ngcontent-%COMP%]{color:#ef4444}.dropdown-item.delete[_ngcontent-%COMP%]:hover{background:#fee2e2}.dropdown-item.delete[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#ef4444}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:8px}.btn-primary[_ngcontent-%COMP%]{background:#4f46e5;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#4338ca;transform:translateY(-1px);box-shadow:0 4px 12px #4f46e54d}.btn-secondary[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e5e7eb}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:2000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:0;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:24px;border-bottom:1px solid #e5e7eb}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700;color:#111827}.modal-close[_ngcontent-%COMP%]{width:32px;height:32px;border:none;background:#f3f4f6;border-radius:8px;font-size:24px;color:#6b7280;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.modal-close[_ngcontent-%COMP%]:hover{background:#e5e7eb;color:#374151}.form[_ngcontent-%COMP%]{padding:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:14px;font-weight:600;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;transition:all .2s;font-family:inherit}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.grid[_ngcontent-%COMP%]{display:grid;gap:16px}.grid-3[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}.grid-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.flex[_ngcontent-%COMP%]{display:flex}.gap-2[_ngcontent-%COMP%]{gap:8px}.mt-4[_ngcontent-%COMP%]{margin-top:16px}']});let i=r;return i})();var cn=(()=>{let r=class r{constructor(e){this.supabase=e,this._jalonsCache=null}clearCache(){this._jalonsCache=null}getAllJalons(){return C(this,null,function*(){if(this._jalonsCache)return this._jalonsCache;let{data:e,error:t}=yield this.supabase.client.from("jalons").select("*").order("date_jalon",{ascending:!0});if(t)throw t;return this._jalonsCache=e||[],this._jalonsCache})}getJalonsByProject(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("jalons").select("*").eq("projet_id",e).order("date_jalon",{ascending:!0});if(o)throw o;return t||[]})}createJalon(e){return C(this,null,function*(){let{data:t,error:o}=yield this.supabase.client.from("jalons").insert([e]).select().single();if(o)throw o;return this.clearCache(),t})}updateJalon(e,t){return C(this,null,function*(){let{data:o,error:a}=yield this.supabase.client.from("jalons").update(t).eq("id",e).select().single();if(a)throw a;return this.clearCache(),o})}deleteJalon(e){return C(this,null,function*(){let{error:t}=yield this.supabase.client.from("jalons").delete().eq("id",e);if(t)throw t;this.clearCache()})}};r.\u0275fac=function(t){return new(t||r)(R(H))},r.\u0275prov=D({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();function Wp(i,r){if(i&1&&(s(0,"option",20),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),j(n.nom_projet)}}function Up(i,r){if(i&1){let n=E();s(0,"div",1),_("click",function(){f(n);let t=u();return h(t.close())}),s(1,"div",2),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",3)(3,"h2"),p(4),l(),s(5,"button",4),_("click",function(){f(n);let t=u();return h(t.close())}),p(6,"\xD7"),l()(),s(7,"form",5),_("ngSubmit",function(){f(n);let t=u();return h(t.save())}),s(8,"div",6)(9,"label"),p(10,"Nom du jalon *"),l(),s(11,"input",7),O("ngModelChange",function(t){f(n);let o=u();return S(o.currentJalon.nom,t)||(o.currentJalon.nom=t),h(t)}),l()(),s(12,"div",6)(13,"label"),p(14,"Date *"),l(),s(15,"input",8),O("ngModelChange",function(t){f(n);let o=u();return S(o.currentJalon.date_jalon,t)||(o.currentJalon.date_jalon=t),h(t)}),l()(),s(16,"div",6)(17,"label"),p(18,"Projet"),l(),s(19,"select",9),O("ngModelChange",function(t){f(n);let o=u();return S(o.currentJalon.projet_id,t)||(o.currentJalon.projet_id=t),h(t)}),s(20,"option",10),p(21,"-- Aucun projet --"),l(),b(22,Wp,2,2,"option",11),l()(),s(23,"div",6)(24,"label"),p(25,"Type"),l(),s(26,"select",12),O("ngModelChange",function(t){f(n);let o=u();return S(o.currentJalon.type,t)||(o.currentJalon.type=t),h(t)}),s(27,"option",13),p(28,"Autre"),l(),s(29,"option",14),p(30,"Livraison (LV)"),l(),s(31,"option",15),p(32,"Mise en production (MEP)"),l(),s(33,"option",16),p(34,"Sprint (SP)"),l()()(),s(35,"div",17)(36,"button",18),_("click",function(){f(n);let t=u();return h(t.close())}),p(37,"Annuler"),l(),s(38,"button",19),p(39),l()()()()()}if(i&2){let n=u();c(4),j(n.isEditing?"Modifier le jalon":"Nouveau Jalon"),c(7),P("ngModel",n.currentJalon.nom),c(4),P("ngModel",n.currentJalon.date_jalon),c(4),P("ngModel",n.currentJalon.projet_id),c(),g("ngValue",void 0),c(2),g("ngForOf",n.projets),c(4),P("ngModel",n.currentJalon.type),c(13),j(n.isEditing?"Mettre \xE0 jour":"Cr\xE9er")}}var zi=(()=>{let r=class r{constructor(e){this.jalonService=e,this.visible=!1,this.jalon=null,this.projets=[],this.visibleChange=new ye,this.saved=new ye,this.currentJalon={nom:"",date_jalon:"",type:""}}ngOnChanges(e){e.jalon&&this.jalon?this.currentJalon=T({},this.jalon):e.visible&&this.visible&&!this.jalon&&(this.currentJalon={nom:"",date_jalon:new Date().toISOString().split("T")[0],type:""})}get isEditing(){return!!this.currentJalon.id}close(){this.visible=!1,this.visibleChange.emit(!1)}save(){return C(this,null,function*(){if(!(!this.currentJalon.nom||!this.currentJalon.date_jalon))try{this.currentJalon.id?yield this.jalonService.updateJalon(this.currentJalon.id,this.currentJalon):yield this.jalonService.createJalon(this.currentJalon),this.saved.emit(),this.close()}catch(e){console.error("Error saving jalon:",e)}})}};r.\u0275fac=function(t){return new(t||r)(L(cn))},r.\u0275cmp=B({type:r,selectors:[["app-milestone-modal"]],inputs:{visible:"visible",jalon:"jalon",projets:"projets"},outputs:{visibleChange:"visibleChange",saved:"saved"},features:[rt],decls:1,vars:1,consts:[["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[1,"form",3,"ngSubmit"],[1,"form-group"],["name","nom","required","","placeholder","Ex: Livraison V1",3,"ngModelChange","ngModel"],["type","date","name","date_jalon","required","",3,"ngModelChange","ngModel"],["name","projet_id",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["name","type",3,"ngModelChange","ngModel"],["value",""],["value","LV"],["value","MEP"],["value","SP"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],[3,"value"]],template:function(t,o){t&1&&b(0,Up,40,8,"div",0),t&2&&g("ngIf",o.visible)},dependencies:[G,Ce,X,Z,we,Re,Ve,ee,je,te,ve,be,ne,xe],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:500px;box-shadow:0 20px 25px -5px #0000001a,0 10px 10px -5px #0000000a;padding:24px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:600;color:#111827}.modal-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;color:#9ca3af;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:#374151}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;color:#111827;transition:all .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51a}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;margin-top:32px}.btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:500;cursor:pointer;border:none;transition:all .2s}.btn-primary[_ngcontent-%COMP%]{background:#4f46e5;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#4338ca}.btn-secondary[_ngcontent-%COMP%]{background:#e5e7eb;color:#374151}.btn-secondary[_ngcontent-%COMP%]:hover{background:#d1d5db}"]});let i=r;return i})();var $p=["bulkChargeInput"],Bp=["headerScroll"],Hp=["dataScroll"],Gp=["milestonesScroll"],ms=(i,r,n)=>({"availability-positive":i,"availability-zero":r,"availability-negative":n});function Jp(i,r){if(i&1&&(s(0,"span",48),p(1),l()),i&2){let n=r.$implicit,e=u();c(),j(e.getEquipeName(n))}}function Yp(i,r){i&1&&(s(0,"span",49),p(1,"Tous"),l())}function Qp(i,r){if(i&1&&(s(0,"span",48),p(1),l()),i&2){let n=r.$implicit,e=u();c(),j(e.getProjetLabel(n))}}function Kp(i,r){i&1&&(s(0,"span",49),p(1,"Tous"),l())}function Zp(i,r){if(i&1&&(s(0,"span",48),p(1),l()),i&2){let n=r.$implicit,e=u();c(),j(e.getResourceLabel(n))}}function Xp(i,r){i&1&&(s(0,"span",49),p(1,"Tous"),l())}function eu(i,r){if(i&1){let n=E();s(0,"label",53)(1,"input",54),_("change",function(t){let o=f(n).$implicit,a=u(2);return h(a.onEquipeToggle(o.id,t))}),l(),p(2),l()}if(i&2){let n=r.$implicit,e=u(2);c(),g("value",n.id)("checked",e.filterEquipeIds.includes(n.id)),c(),y(" ",n.nom," ")}}function tu(i,r){if(i&1){let n=E();s(0,"div",50),_("click",function(t){return f(n),h(t.stopPropagation())}),s(1,"div",51),b(2,eu,3,3,"label",52),l()()}if(i&2){let n=u();c(2),g("ngForOf",n.allEquipes)}}function nu(i,r){if(i&1){let n=E();s(0,"label",53)(1,"input",54),_("change",function(t){let o=f(n).$implicit,a=u(2);return h(a.onProjetToggle(o.id,t))}),l(),p(2),l()}if(i&2){let n=r.$implicit,e=u(2);c(),g("value",n.id)("checked",e.filterProjetIds.includes(n.id)),c(),Ie(" ",n.code_projet," \u2014 ",n.nom_projet," ")}}function iu(i,r){if(i&1){let n=E();s(0,"div",50),_("click",function(t){return f(n),h(t.stopPropagation())}),s(1,"div",51),b(2,nu,3,4,"label",52),l()()}if(i&2){let n=u();c(2),g("ngForOf",n.allProjects)}}function ou(i,r){if(i&1){let n=E();s(0,"label",53)(1,"input",54),_("change",function(t){let o=f(n).$implicit,a=u(2);return h(a.onResourceToggle("role:"+o.id,t))}),l(),p(2),l()}if(i&2){let n=r.$implicit,e=u(2);c(),g("value","role:"+n.id)("checked",e.filterResourceIds.includes("role:"+n.id)),c(),y(" ",n.nom," ")}}function ru(i,r){if(i&1){let n=E();s(0,"label",53)(1,"input",54),_("change",function(t){let o=f(n).$implicit,a=u(2);return h(a.onResourceToggle("personne:"+o.id,t))}),l(),p(2),l()}if(i&2){let n=r.$implicit,e=u(2);c(),g("value","personne:"+n.id)("checked",e.filterResourceIds.includes("personne:"+n.id)),c(),Ie(" ",n.prenom," ",n.nom," ")}}function au(i,r){if(i&1){let n=E();s(0,"div",50),_("click",function(t){return f(n),h(t.stopPropagation())}),s(1,"div",51)(2,"div",55),p(3,"R\xF4les"),l(),b(4,ou,3,3,"label",52),s(5,"div",55),p(6,"Personnes"),l(),b(7,ru,3,4,"label",52),l()()}if(i&2){let n=u();c(4),g("ngForOf",n.availableRoles),c(3),g("ngForOf",n.availablePersonnes)}}function su(i,r){if(i&1&&(s(0,"div",56)(1,"div",57),p(2),l(),s(3,"div",58),p(4),l()()),i&2){let n=r.$implicit,e=u();U("current-week",e.isCurrentWeek(n)),c(2),j(e.formatWeekHeader(n)),c(2),y("S",e.getWeekNumber(n))}}function lu(i,r){if(i&1){let n=E();s(0,"div",62),_("click",function(t){let o=f(n).$implicit,a=u(2);return h(a.openMilestoneModal(o,t))}),p(1),l()}if(i&2){let n=r.$implicit,e=u(2);oe("background-color",e.getJalonColor(n.type))("color",e.getJalonTextColor(n.type)),g("title",n.date_jalon),c(),y(" ",n.nom||"\u2605"," ")}}function cu(i,r){if(i&1&&(s(0,"div",59)(1,"div",60),b(2,lu,2,6,"div",61),l()()),i&2){let n=r.$implicit,e=u();U("current-week",e.isCurrentWeek(n)),c(2),g("ngForOf",e.getJalonsForWeek(n))}}function du(i,r){i&1&&M(0,"div",76)}function pu(i,r){if(i&1&&(s(0,"div",74),b(1,du,1,0,"div",75),l()),i&2){let n=r.$implicit,e=u().$implicit,t=u(2);c(),g("ngIf",t.getParentTotal(e,n)>0)}}function uu(i,r){i&1&&M(0,"div",80)}function mu(i,r){if(i&1&&(s(0,"div",92),p(1),se(2,"number"),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u(6);c(),y(" ",le(2,1,t.getResourceValue(e,n),"1.0-1")," ")}}function gu(i,r){if(i&1&&(s(0,"div",93),p(1),se(2,"number"),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u(2).$implicit,o=u(2).$implicit,a=u(2);g("ngClass",lo(6,ms,a.getAvailability(e,n,a.viewMode==="project"?t.id:o.id)>0,a.getAvailability(e,n,a.viewMode==="project"?t.id:o.id)===0,a.getAvailability(e,n,a.viewMode==="project"?t.id:o.id)<0)),c(),Ie(" ",a.getAvailability(e,n,a.viewMode==="project"?t.id:o.id)>0?"+":"","",le(2,3,a.getAvailability(e,n,a.viewMode==="project"?t.id:o.id),"1.0-1")," ")}}function fu(i,r){if(i&1&&(s(0,"div",88)(1,"div",89),b(2,mu,3,4,"div",90)(3,gu,3,10,"div",91),l()()),i&2){let n=r.$implicit,e=r.index,t=u().$implicit,o=u(2).$implicit,a=u(2).$implicit,d=u(2);U("selected",d.isCellSelected(t,n))("has-capacity",d.getResourceValue(t,n)>0)("cell-positive",d.shouldShowAvailability(t,n,d.viewMode==="project"?o.id:a.id)&&d.getAvailability(t,n,d.viewMode==="project"?o.id:a.id)>0)("cell-zero",d.shouldShowAvailability(t,n,d.viewMode==="project"?o.id:a.id)&&d.getAvailability(t,n,d.viewMode==="project"?o.id:a.id)===0)("cell-negative",d.shouldShowAvailability(t,n,d.viewMode==="project"?o.id:a.id)&&d.getAvailability(t,n,d.viewMode==="project"?o.id:a.id)<0),Me("data-week-index",e),c(2),g("ngIf",d.getResourceValue(t,n)>0),c(),g("ngIf",d.shouldShowAvailability(t,n,d.viewMode==="project"?o.id:a.id))}}function hu(i,r){if(i&1){let n=E();s(0,"div",82),_("mousedown",function(t){let o=f(n).$implicit,a=u(2).$implicit,d=u(2).$implicit,m=u(2);return h(m.onMouseDown(t,o,a,d))})("mousemove",function(t){let o=f(n).$implicit,a=u(2).$implicit,d=u(2).$implicit,m=u(2);return h(m.onMouseMove(t,o,a,d))})("mouseup",function(){f(n);let t=u(6);return h(t.onMouseUp())})("mouseleave",function(){f(n);let t=u(6);return h(t.onMouseUp())}),s(1,"div",83)(2,"div",84)(3,"span",85),p(4),l()(),s(5,"button",86),_("click",function(t){let o=f(n).$implicit,a=u(2).$implicit,d=u(2).$implicit;return u(2).removeResource(o,a,d),h(t.stopPropagation())}),p(6," \xD7 "),l()(),s(7,"div",32),b(8,fu,4,13,"div",87),l(),s(9,"div",71)(10,"div",72)(11,"div",73)(12,"label"),p(13,"2025:"),l(),s(14,"span"),p(15),se(16,"number"),l()(),s(17,"div",73)(18,"label"),p(19,"2026:"),l(),s(20,"span"),p(21),se(22,"number"),l()()()()()}if(i&2){let n=r.$implicit,e=u(2).$implicit,t=u(2).$implicit,o=u(2);Me("data-resource-id",o.getResourceUniqueId(n,e,t)),c(4),j(n.label),c(4),g("ngForOf",o.displayedWeeks),c(7),y("",le(16,5,o.getResourceMetricsYear(n,2025),"1.0-0"),"j"),c(6),y("",le(22,8,o.getResourceMetricsYear(n,2026),"1.0-0"),"j")}}function _u(i,r){if(i&1&&(Oe(0),b(1,hu,23,11,"div",81),ke()),i&2){let n=u().$implicit;c(),g("ngForOf",n.resources)}}function Cu(i,r){if(i&1){let n=E();Oe(0),s(1,"div",64)(2,"div",65)(3,"div",77),_("click",function(){let t=f(n).$implicit,o=u(4);return h(o.toggleChild(t))}),M(4,"lucide-icon",67),s(5,"span",78),p(6),l()(),s(7,"button",68),_("click",function(t){let o=f(n).$implicit,a=u(2).$implicit;return u(2).openAddResourceModal(o,a),h(t.stopPropagation())}),M(8,"lucide-icon",69),l()(),s(9,"div",32),b(10,uu,1,0,"div",79),l(),s(11,"div",71)(12,"div",72)(13,"div",73)(14,"label"),p(15,"2025:"),l(),s(16,"span"),p(17),se(18,"number"),l()(),s(19,"div",73)(20,"label"),p(21,"2026:"),l(),s(22,"span"),p(23),se(24,"number"),l()()()()(),b(25,_u,2,1,"ng-container",43),ke()}if(i&2){let n=r.$implicit,e=u(4);c(4),g("name",n.expanded?"chevron-down":"chevron-right")("size",18),c(2),j(n.label),c(2),g("img",e.Plus)("size",14),c(2),g("ngForOf",e.displayedWeeks),c(7),y("",le(18,9,e.getChildMetricsYear(n,2025),"1.0-0"),"j"),c(6),y("",le(24,12,e.getChildMetricsYear(n,2026),"1.0-0"),"j"),c(2),g("ngIf",n.expanded)}}function vu(i,r){if(i&1&&(Oe(0),b(1,Cu,26,15,"ng-container",63),ke()),i&2){let n=u().$implicit;c(),g("ngForOf",n.children)}}function xu(i,r){if(i&1){let n=E();Oe(0),s(1,"div",64)(2,"div",65)(3,"div",66),_("click",function(){let t=f(n).$implicit,o=u(2);return h(o.toggleRow(t))}),M(4,"lucide-icon",67),s(5,"strong"),p(6),l()(),s(7,"button",68),_("click",function(t){let o=f(n).$implicit;return u(2).openLinkModal(o),h(t.stopPropagation())}),M(8,"lucide-icon",69),l()(),s(9,"div",32),b(10,pu,2,1,"div",70),l(),s(11,"div",71)(12,"div",72)(13,"div",73)(14,"label"),p(15,"2025:"),l(),s(16,"span"),p(17),se(18,"number"),l()(),s(19,"div",73)(20,"label"),p(21,"2026:"),l(),s(22,"span"),p(23),se(24,"number"),l()()()()(),b(25,vu,2,1,"ng-container",43),ke()}if(i&2){let n=r.$implicit,e=u(2);c(4),g("name",n.expanded?"chevron-down":"chevron-right")("size",20),c(2),j(n.label),c(2),g("img",e.Plus)("size",16),c(2),g("ngForOf",e.displayedWeeks),c(7),y("",le(18,9,e.getRowMetricsYear(n,2025),"1.0-0"),"j"),c(6),y("",le(24,12,e.getRowMetricsYear(n,2026),"1.0-0"),"j"),c(2),g("ngIf",n.expanded)}}function wu(i,r){if(i&1&&(Oe(0),b(1,xu,26,15,"ng-container",63),ke()),i&2){let n=u();c(),g("ngForOf",n.rows)}}function bu(i,r){if(i&1&&(s(0,"div",92),p(1),se(2,"number"),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u(2);c(),y(" ",le(2,1,t.getResourceValue(e.resource,n),"1.0-1")," ")}}function yu(i,r){if(i&1&&(s(0,"div",93),p(1),se(2,"number"),l()),i&2){let n=u().$implicit,e=u().$implicit,t=u(2);g("ngClass",lo(6,ms,t.getAvailability(e.resource,n,t.viewMode==="project"?e.child.id:e.parent.id)>0,t.getAvailability(e.resource,n,t.viewMode==="project"?e.child.id:e.parent.id)===0,t.getAvailability(e.resource,n,t.viewMode==="project"?e.child.id:e.parent.id)<0)),c(),Ie(" ",t.getAvailability(e.resource,n,t.viewMode==="project"?e.child.id:e.parent.id)>0?"+":"","",le(2,3,t.getAvailability(e.resource,n,t.viewMode==="project"?e.child.id:e.parent.id),"1.0-1")," ")}}function Mu(i,r){if(i&1&&(s(0,"div",88)(1,"div",89),b(2,bu,3,4,"div",90)(3,yu,3,10,"div",91),l()()),i&2){let n=r.$implicit,e=r.index,t=u().$implicit,o=u(2);U("selected",o.isCellSelected(t.resource,n))("has-capacity",o.getResourceValue(t.resource,n)>0)("cell-positive",o.shouldShowAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)&&o.getAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)>0)("cell-zero",o.shouldShowAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)&&o.getAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)===0)("cell-negative",o.shouldShowAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)&&o.getAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id)<0),Me("data-week-index",e),c(2),g("ngIf",o.getResourceValue(t.resource,n)>0),c(),g("ngIf",o.shouldShowAvailability(t.resource,n,o.viewMode==="project"?t.child.id:t.parent.id))}}function Pu(i,r){if(i&1){let n=E();s(0,"div",82),_("mousedown",function(t){let o=f(n).$implicit,a=u(2);return h(a.onMouseDown(t,o.resource,o.child,o.parent))})("mousemove",function(t){let o=f(n).$implicit,a=u(2);return h(a.onMouseMove(t,o.resource,o.child,o.parent))})("mouseup",function(){f(n);let t=u(2);return h(t.onMouseUp())})("mouseleave",function(){f(n);let t=u(2);return h(t.onMouseUp())}),s(1,"div",83)(2,"div",94),p(3),l()(),s(4,"div",32),b(5,Mu,4,13,"div",87),l(),s(6,"div",71)(7,"div",72)(8,"div",73)(9,"label"),p(10,"2025:"),l(),s(11,"span"),p(12),se(13,"number"),l()(),s(14,"div",73)(15,"label"),p(16,"2026:"),l(),s(17,"span"),p(18),se(19,"number"),l()()()()()}if(i&2){let n=r.$implicit,e=u(2);Me("data-resource-id",e.getResourceUniqueId(n.resource,n.child,n.parent)),c(2),g("title",Pr(n.fullLabel)),c(),y(" ",n.fullLabel," "),c(2),g("ngForOf",e.displayedWeeks),c(7),y("",le(13,7,e.getFlatRowMetricsYear(n,2025),"1.0-0"),"j"),c(6),y("",le(19,10,e.getFlatRowMetricsYear(n,2026),"1.0-0"),"j")}}function Su(i,r){if(i&1&&(Oe(0),b(1,Pu,20,13,"div",81),ke()),i&2){let n=u();c(),g("ngForOf",n.flatRows)}}function Ou(i,r){i&1&&(s(0,"div",95)(1,"p"),p(2,"Aucune donn\xE9e"),l()())}function ku(i,r){i&1&&M(0,"span",106)}function Eu(i,r){i&1&&(s(0,"div",107),M(1,"div",106),s(2,"span"),p(3,"Mise \xE0 jour..."),l()())}function Tu(i,r){if(i&1){let n=E();s(0,"div",96)(1,"div",97),p(2),s(3,"div",98),p(4),se(5,"number"),l()(),s(6,"div",99)(7,"input",100,4),O("ngModelChange",function(t){f(n);let o=u();return S(o.bulkChargeValue,t)||(o.bulkChargeValue=t),h(t)}),_("keydown.enter",function(){f(n);let t=u();return h(t.applyBulkCharge())}),l()(),s(9,"div",101)(10,"button",102),_("click",function(){f(n);let t=u();return h(t.clearSelection())}),p(11,"Annuler"),l(),s(12,"button",103),_("click",function(){f(n);let t=u();return h(t.applyBulkCharge())}),b(13,ku,1,0,"span",104),p(14),l()(),b(15,Eu,4,0,"div",105),l()}if(i&2){let n=u();oe("top",n.toolbarPosition==null?null:n.toolbarPosition.top,"px")("left",n.toolbarPosition==null?null:n.toolbarPosition.left,"px")("transform",n.toolbarTransform)("opacity",n.toolbarVisible?1:0),c(2),y(" ",n.selectedCells.length," semaine(s) s\xE9lectionn\xE9e(s) "),c(2),y(" Total jours s\xE9lectionn\xE9s: ",le(5,16,n.totalSelectedDays,"1.1-1"),"j "),c(3),P("ngModel",n.bulkChargeValue),c(3),g("disabled",n.isSaving),c(2),g("disabled",n.isSaving),c(),g("ngIf",n.isSaving),c(),y(" ",n.isSaving?"Application...":"Appliquer"," "),c(),g("ngIf",n.isSaving)}}function Iu(i,r){if(i&1&&(s(0,"option",119),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),y(" ",n.label," ")}}function ju(i,r){if(i&1){let n=E();s(0,"div",108),_("click",function(){f(n);let t=u();return h(t.closeLinkModal())}),s(1,"div",109),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",110)(3,"h2"),p(4),l(),s(5,"button",111),_("click",function(){f(n);let t=u();return h(t.closeLinkModal())}),p(6,"\xD7"),l()(),s(7,"div",112)(8,"div",113)(9,"label"),p(10),l(),s(11,"select",114),O("ngModelChange",function(t){f(n);let o=u();return S(o.selectedIdToLink,t)||(o.selectedIdToLink=t),h(t)}),s(12,"option",115),p(13,"-- Choisir --"),l(),b(14,Iu,2,2,"option",116),l()(),s(15,"div",117)(16,"button",118),_("click",function(){f(n);let t=u();return h(t.linkItem())}),p(17,"Ajouter"),l(),s(18,"button",15),_("click",function(){f(n);let t=u();return h(t.closeLinkModal())}),p(19,"Annuler"),l()()()()()}if(i&2){let n=u();c(4),Ie(" ",n.viewMode==="project"?"Ajouter une \xE9quipe":"Ajouter un projet"," \xE0 ",n.selectedParentRow==null?null:n.selectedParentRow.label," "),c(6),j(n.viewMode==="project"?"S\xE9lectionner une \xE9quipe":"S\xE9lectionner un projet"),c(),P("ngModel",n.selectedIdToLink),c(3),g("ngForOf",n.linkableItems),c(2),g("disabled",!n.selectedIdToLink)}}function Ru(i,r){i&1&&(s(0,"div",125)(1,"p"),p(2,"Aucun r\xF4le disponible. Tous les r\xF4les sont d\xE9j\xE0 utilis\xE9s pour cette combinaison."),l()())}function Vu(i,r){if(i&1&&(s(0,"option",119),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),Ie(" ",n.nom," (",n.jours_par_semaine,"j/sem) ")}}function Du(i,r){if(i&1){let n=E();s(0,"select",114),O("ngModelChange",function(t){f(n);let o=u(3);return S(o.selectedResourceId,t)||(o.selectedResourceId=t),h(t)}),s(1,"option",115),p(2,"-- Choisir un r\xF4le --"),l(),b(3,Vu,2,3,"option",116),l()}if(i&2){let n=u(3);P("ngModel",n.selectedResourceId),c(3),g("ngForOf",n.availableRoles)}}function Au(i,r){if(i&1&&(s(0,"div",113)(1,"label"),p(2,"S\xE9lectionner un r\xF4le"),l(),b(3,Ru,3,0,"div",123)(4,Du,4,2,"select",124),l()),i&2){let n=u(2);c(3),g("ngIf",n.availableRoles.length===0),c(),g("ngIf",n.availableRoles.length>0)}}function Nu(i,r){i&1&&(s(0,"div",125)(1,"p"),p(2,"Aucune personne disponible. Tous les personnes sont d\xE9j\xE0 utilis\xE9es pour cette combinaison."),l()())}function Lu(i,r){if(i&1&&(s(0,"option",119),p(1),l()),i&2){let n=r.$implicit;g("value",n.id),c(),Gn(" ",n.prenom," ",n.nom," (",n.jours_par_semaine,"j/sem) ")}}function Fu(i,r){if(i&1){let n=E();s(0,"select",114),O("ngModelChange",function(t){f(n);let o=u(3);return S(o.selectedResourceId,t)||(o.selectedResourceId=t),h(t)}),s(1,"option",115),p(2,"-- Choisir une personne --"),l(),b(3,Lu,2,4,"option",116),l()}if(i&2){let n=u(3);P("ngModel",n.selectedResourceId),c(3),g("ngForOf",n.availablePersonnes)}}function zu(i,r){if(i&1&&(s(0,"div",113)(1,"label"),p(2,"S\xE9lectionner une personne"),l(),b(3,Nu,3,0,"div",123)(4,Fu,4,2,"select",124),l()),i&2){let n=u(2);c(3),g("ngIf",n.availablePersonnes.length===0),c(),g("ngIf",n.availablePersonnes.length>0)}}function qu(i,r){if(i&1){let n=E();s(0,"div",108),_("click",function(){f(n);let t=u();return h(t.closeAddResourceModal())}),s(1,"div",109),_("click",function(t){return f(n),h(t.stopPropagation())}),s(2,"div",110)(3,"h2"),p(4),l(),s(5,"button",111),_("click",function(){f(n);let t=u();return h(t.closeAddResourceModal())}),p(6,"\xD7"),l()(),s(7,"div",112)(8,"div",113)(9,"label"),p(10,"Type de ressource"),l(),s(11,"select",114),O("ngModelChange",function(t){f(n);let o=u();return S(o.resourceTypeToAdd,t)||(o.resourceTypeToAdd=t),h(t)}),s(12,"option",120),p(13,"R\xF4le"),l(),s(14,"option",121),p(15,"Personne"),l()()(),b(16,Au,5,2,"div",122)(17,zu,5,2,"div",122),s(18,"div",117)(19,"button",118),_("click",function(){f(n);let t=u();return h(t.addResourceToCharge())}),p(20," Ajouter "),l(),s(21,"button",15),_("click",function(){f(n);let t=u();return h(t.closeAddResourceModal())}),p(22,"Annuler"),l()()()()()}if(i&2){let n=u();c(4),y("Ajouter une Ressource \xE0 ",n.selectedChildRow==null?null:n.selectedChildRow.label),c(7),P("ngModel",n.resourceTypeToAdd),c(5),g("ngIf",n.resourceTypeToAdd==="role"),c(),g("ngIf",n.resourceTypeToAdd==="personne"),c(2),g("disabled",!n.selectedResourceId||n.resourceTypeToAdd==="role"&&n.availableRoles.length===0||n.resourceTypeToAdd==="personne"&&n.availablePersonnes.length===0)}}var Wu=(()=>{let r=class r{};r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=Be({type:r}),r.\u0275inj=Ue({imports:[K.pick({Plus:He,ChevronDown:Ct,ChevronRight:vt}),K]});let i=r;return i})(),gs=(()=>{let r=class r{openMilestoneModal(e,t){t.stopPropagation(),this.selectedJalon=e,this.showMilestoneModal=!0}onMilestoneSaved(){return C(this,null,function*(){yield this.loadData()})}constructor(e,t,o,a,d){this.teamService=e,this.projetService=t,this.chargeService=o,this.calendarService=a,this.jalonService=d,this.showMilestoneModal=!1,this.selectedJalon=null,this.viewMode="project",this.displayFormat="tree",this.showAvailability=!1,this.flatRows=[],this.usageMap=new Map,this.displayedWeeks=[],this.currentDate=new Date,this.rows=[],this.allProjects=[],this.allEquipes=[],this.allCharges=[],this.allCapacities=[],this.allLinks=[],this.rowsAll=[],this.filterEquipeIds=[],this.filterProjetIds=[],this.filterResourceIds=[],this.openEquipeDropdown=!1,this.openProjetDropdown=!1,this.openResourceDropdown=!1,this.showLinkModal=!1,this.selectedParentRow=null,this.linkableItems=[],this.selectedIdToLink="",this.showAddResourceModal=!1,this.selectedChildRow=null,this.selectedParentForResource=null,this.resourceTypeToAdd="role",this.selectedResourceId="",this.availableRoles=[],this.availablePersonnes=[],this.isDragging=!1,this.dragStartResource=null,this.dragStartWeekIndex=-1,this.dragEndWeekIndex=-1,this.selectedCells=[],this.isSelectionFinished=!1,this.toolbarPosition=null,this.toolbarTransform="translate(-50%, 10px)",this.toolbarVisible=!1,this.bulkChargeValue=null,this.isSaving=!1,this.jalons=[],this.Plus=He}ngOnInit(){return C(this,null,function*(){this.generateWeeks(),yield this.loadData()})}generateWeeks(){this.displayedWeeks=[];let e=new Date(this.currentDate);e.setDate(1);let t=this.calendarService.getWeekStart(e);for(let o=0;o<32;o++){let a=new Date(t);a.setDate(a.getDate()+o*7),this.displayedWeeks.push(a)}}loadData(){return C(this,null,function*(){try{let[e,t,o,a,d,m,v,x]=yield Promise.all([this.projetService.getAllProjets(),this.teamService.getAllEquipes(),this.chargeService.getAllCharges(),this.teamService.getAllCapacities(),this.projetService.getAllEquipeProjetLinks(),this.teamService.getAllRoles(),this.teamService.getAllPersonnes(),this.jalonService.getAllJalons()]);this.allProjects=e,this.allEquipes=t,this.allCharges=o,this.allCapacities=a,this.allLinks=d,this.availableRoles=m,this.availablePersonnes=v,this.jalons=x,this.calculateUsage(),this.buildTree()}catch(e){console.error("Error loading data",e)}})}getJalonsForWeek(e){let t=new Date(e);t.setHours(0,0,0,0);let o=new Date(t);return o.setDate(t.getDate()+6),o.setHours(23,59,59,999),this.jalons.filter(a=>{let d=new Date(a.date_jalon);return d>=t&&d<=o})}getJalonColor(e){switch(e){case"LV":return"#d1fae5";case"MEP":return"#dbeafe";case"SP":return"#fef3c7";default:return"#f3f4f6"}}getJalonTextColor(e){switch(e){case"LV":return"#065f46";case"MEP":return"#1e40af";case"SP":return"#92400e";default:return"#4b5563"}}calculateUsage(){this.usageMap.clear();for(let e of this.allCharges){if(!e.semaine_debut||!e.equipe_id)continue;let t=e.semaine_debut.split("T")[0],o=e.equipe_id,a="";if(e.role_id)a=`role_${e.role_id}`;else if(e.personne_id)a=`personne_${e.personne_id}`;else continue;let d=`${o}_${a}_${t}`,m=this.usageMap.get(d)||0;this.usageMap.set(d,m+e.unite_ressource)}}getAvailability(e,t,o){let a=t.toISOString().split("T")[0],d=`${e.type}_${e.id}`,m=`${o}_${d}_${a}`,v=this.usageMap.get(m)||0,x=this.allCapacities.find(k=>k.equipe_id===o&&k.semaine_debut.startsWith(a)&&(e.type==="role"?k.role_id===e.id:k.personne_id===e.id));return(x?x.capacite:0)-v}shouldShowAvailability(e,t,o){let a=this.getResourceValue(e,t),d=this.getAvailability(e,t,o);return a>0||this.showAvailability&&d!==0}switchViewMode(e){this.viewMode=e,this.buildTree()}buildTree(){if(this.rows=[],this.viewMode==="project"){let e=[...this.allProjects].sort((t,o)=>t.nom_projet.localeCompare(o.nom_projet));for(let t of e){let o=this.allCharges.filter(w=>w.projet_id===t.id),a=o.map(w=>w.equipe_id).filter(w=>!!w),d=this.allLinks.filter(w=>w.projet_id===t.id).map(w=>w.equipe_id),m=new Set([...a,...d]),v=[],x=new Map;m.forEach(w=>{let k=this.allEquipes.find(A=>A.id===w),V=k?k.nom:"No Team",$=new Map,re=o.filter(A=>A.equipe_id===w),pe=[],ce=new Map;re.forEach(A=>{let ue,Mt,nt,Pt=0;if(A.role_id){ue=`role_${A.role_id}`;let z=this.availableRoles.find(We=>We.id===A.role_id);Mt=z?z.nom:"Unknown Role",Pt=z?.jours_par_semaine||0,nt="role"}else if(A.personne_id){ue=`personne_${A.personne_id}`;let z=this.availablePersonnes.find(We=>We.id===A.personne_id);Mt=z?`${z.prenom} ${z.nom}`:"Unknown Person",Pt=z?.jours_par_semaine||0,nt="personne"}else return;if(!ce.has(ue)){let z=`${t.id}_${w}_${A.role_id||A.personne_id}_${nt}`;ce.set(ue,{id:A.role_id||A.personne_id||"",uniqueId:z,label:Mt,type:nt,jours_par_semaine:Pt,charges:new Map})}let dn=ce.get(ue);if(A.semaine_debut){let z=A.semaine_debut.split("T")[0],We=dn.charges.get(z)||0;dn.charges.set(z,We+A.unite_ressource);let qi=$.get(z)||0;$.set(z,qi+A.unite_ressource);let Wi=x.get(z)||0;x.set(z,Wi+A.unite_ressource)}}),pe.push(...ce.values()),v.push({id:w,label:V,expanded:!0,resources:pe,charges:$})}),v.sort((w,k)=>w.label.localeCompare(k.label)),v.forEach(w=>{w.resources.sort((k,V)=>k.label.localeCompare(V.label))}),this.rows.push({id:t.id,label:t.nom_projet,expanded:!0,children:v,totalCharges:x})}}else{let e=[...this.allEquipes].sort((t,o)=>t.nom.localeCompare(o.nom));for(let t of e){let o=this.allCharges.filter(w=>w.equipe_id===t.id),a=o.map(w=>w.projet_id).filter(w=>!!w),d=this.allLinks.filter(w=>w.equipe_id===t.id).map(w=>w.projet_id),m=new Set([...a,...d]),v=[],x=new Map;m.forEach(w=>{let k=this.allProjects.find(A=>A.id===w),V=k?k.nom_projet:"Unknown Project",$=new Map,re=o.filter(A=>A.projet_id===w),pe=[],ce=new Map;re.forEach(A=>{let ue,Mt,nt,Pt=0;if(A.role_id){ue=`role_${A.role_id}`;let z=this.availableRoles.find(We=>We.id===A.role_id);Mt=z?z.nom:"Unknown Role",Pt=z?.jours_par_semaine||0,nt="role"}else if(A.personne_id){ue=`personne_${A.personne_id}`;let z=this.availablePersonnes.find(We=>We.id===A.personne_id);Mt=z?`${z.prenom} ${z.nom}`:"Unknown Person",Pt=z?.jours_par_semaine||0,nt="personne"}else return;if(!ce.has(ue)){let z=`${t.id}_${w}_${A.role_id||A.personne_id}_${nt}`;ce.set(ue,{id:A.role_id||A.personne_id||"",uniqueId:z,label:Mt,type:nt,jours_par_semaine:Pt,charges:new Map})}let dn=ce.get(ue);if(A.semaine_debut){let z=A.semaine_debut.split("T")[0],We=dn.charges.get(z)||0;dn.charges.set(z,We+A.unite_ressource);let qi=$.get(z)||0;$.set(z,qi+A.unite_ressource);let Wi=x.get(z)||0;x.set(z,Wi+A.unite_ressource)}}),pe.push(...ce.values()),v.push({id:w,label:V,expanded:!0,resources:pe,charges:$})}),v.sort((w,k)=>w.label.localeCompare(k.label)),v.forEach(w=>{w.resources.sort((k,V)=>k.label.localeCompare(V.label))}),this.rows.push({id:t.id,label:t.nom,expanded:!0,children:v,totalCharges:x})}}this.rowsAll=[...this.rows],this.applyFilters()}toggleDisplayFormat(e){this.displayFormat=e}buildFlatList(){this.flatRows=[];for(let e of this.rows)for(let t of e.children)for(let o of t.resources){let a="";this.viewMode==="project"?a=`${e.label} / ${t.label} / ${o.label}`:a=`${e.label} / ${t.label} / ${o.label}`,this.flatRows.push({uniqueId:o.uniqueId,fullLabel:a,resource:o,child:t,parent:e})}this.flatRows.sort((e,t)=>e.fullLabel.localeCompare(t.fullLabel))}goToToday(){this.currentDate=new Date,this.generateWeeks()}goToPreviousMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1),this.generateWeeks()}goToNextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1),this.generateWeeks()}toggleRow(e){e.expanded=!e.expanded}toggleChild(e){e.expanded=!e.expanded}formatWeekHeader(e){return e.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})}getWeekNumber(e){return this.calendarService.getWeekNumber(e)}isCurrentWeek(e){return this.calendarService.isCurrentWeek(e)}getParentTotal(e,t){let o=t.toISOString().split("T")[0];return e.totalCharges.get(o)||0}getChildValue(e,t){let o=t.toISOString().split("T")[0];return e.charges.get(o)||0}getResourceValue(e,t){let o=t.toISOString().split("T")[0];return e.charges.get(o)||0}onGridScroll(e){let o=e.target.scrollLeft;this.headerScroll&&(this.headerScroll.nativeElement.scrollLeft=o),this.milestonesScroll&&(this.milestonesScroll.nativeElement.scrollLeft=o)}openLinkModal(e){this.selectedParentRow=e,this.selectedIdToLink="";let t=new Set(e.children.map(o=>o.id));this.viewMode==="project"?this.linkableItems=this.allEquipes.filter(o=>!t.has(o.id)).map(o=>({id:o.id,label:o.nom})):this.linkableItems=this.allProjects.filter(o=>!t.has(o.id)).map(o=>({id:o.id,label:o.nom_projet})),this.showLinkModal=!0}closeLinkModal(){this.showLinkModal=!1,this.selectedParentRow=null,this.selectedIdToLink=""}linkItem(){return C(this,null,function*(){if(!(!this.selectedParentRow||!this.selectedIdToLink))try{this.viewMode==="project"?yield this.projetService.linkProjectToTeam(this.selectedParentRow.id,this.selectedIdToLink):yield this.projetService.linkProjectToTeam(this.selectedIdToLink,this.selectedParentRow.id),yield this.loadData(),this.closeLinkModal()}catch(e){console.error("Error linking item:",e),alert("Erreur lors de l'ajout du lien.")}})}openAddResourceModal(e,t){return C(this,null,function*(){this.selectedChildRow=e,this.selectedParentForResource=t,this.resourceTypeToAdd="role",this.selectedResourceId="",this.showAddResourceModal=!0;let o,a;this.viewMode==="project"?(o=t.id,a=e.id):(a=t.id,o=e.id);try{this.availableRoles=yield this.chargeService.getAvailableRolesForProjectTeam(o,a),this.availablePersonnes=yield this.chargeService.getAvailablePersonnesForProjectTeam(o,a)}catch(d){console.error("Error loading available resources:",d),this.availableRoles=[],this.availablePersonnes=[]}})}closeAddResourceModal(){this.showAddResourceModal=!1,this.selectedChildRow=null,this.selectedParentForResource=null,this.selectedResourceId=""}addResourceToCharge(){return C(this,null,function*(){if(!(!this.selectedChildRow||!this.selectedParentForResource||!this.selectedResourceId))try{let e,t;this.viewMode==="project"?(e=this.selectedParentForResource.id,t=this.selectedChildRow.id):(t=this.selectedParentForResource.id,e=this.selectedChildRow.id);let o=this.resourceTypeToAdd==="role"?this.selectedResourceId:void 0,a=this.resourceTypeToAdd==="personne"?this.selectedResourceId:void 0;yield this.chargeService.createChargeWithoutDates(e,t,o,a),yield this.loadData(),this.closeAddResourceModal()}catch(e){console.error("Error adding resource:",e),alert("Erreur lors de l'ajout de la ressource.")}})}getResourceUniqueId(e,t,o){return`${o.id}_${t.id}_${e.id}_${e.type}`}onMouseDown(e,t,o,a){this.isDragging=!0,this.isSelectionFinished=!1,this.dragStartResource=t;let m=e.target.closest(".week-cell");if(m){let v=m.getAttribute("data-week-index");v&&(this.dragStartWeekIndex=parseInt(v,10),this.dragEndWeekIndex=this.dragStartWeekIndex,this.updateSelection(o,a))}}onMouseMove(e,t,o,a){if(!this.isDragging||!this.dragStartResource||t.uniqueId!==this.dragStartResource.uniqueId)return;let m=e.target.closest(".week-cell");if(m){let v=m.getAttribute("data-week-index");if(v){let x=parseInt(v,10);x!==this.dragEndWeekIndex&&(this.dragEndWeekIndex=x,this.updateSelection(o,a))}}}onMouseUp(){this.isDragging=!1,this.selectedCells.length>0&&(this.isSelectionFinished=!0,this.updateToolbarPosition())}updateToolbarPosition(){!this.dragStartResource||this.dragEndWeekIndex<0||setTimeout(()=>{let e=this.selectedCells[0];if(!e)return;let o=`[data-resource-id="${this.getResourceUniqueId(e.resource,{id:e.childId},{id:e.parentId})}"]`,a=document.querySelector(o);if(a){let d=`[data-week-index="${this.dragEndWeekIndex}"]`,m=a.querySelector(d);if(m){let v=m.getBoundingClientRect(),x=window.innerHeight,w=window.innerWidth,k=150,V=320,$=x-v.bottom,re=v.bottom,pe=v.left+v.width/2,ce="translate(-50%, 10px)";if($<k){let A=w-v.right,ue=v.left;({top:re,left:pe,transform:ce}=this.calculateBestPosition(A,V,ue,re,v,pe,ce,k))}this.toolbarPosition={top:re,left:pe},this.toolbarTransform=ce,this.toolbarVisible=!0,setTimeout(()=>{this.bulkChargeInput?.nativeElement.focus()},50)}}},0)}calculateBestPosition(e,t,o,a,d,m,v,x){let w=this.dragStartWeekIndex-this.dragEndWeekIndex<=0,k=null;return w?e>t?k="RIGHT":o>t&&(k="LEFT"):o>t?k="LEFT":e>t&&(k="RIGHT"),k==="RIGHT"?(a=d.top+d.height/2,m=d.right,v="translate(10px, -50%)"):k==="LEFT"?(a=d.top+d.height/2,m=d.left,v="translate(calc(-100% - 10px), -50%)"):d.top>x&&(a=d.top,m=d.left+d.width/2,v="translate(-50%, calc(-100% - 10px))"),{top:a,left:m,transform:v}}updateSelection(e,t){if(!this.dragStartResource||this.dragStartWeekIndex<0||this.dragEndWeekIndex<0)return;this.selectedCells=[];let o=Math.min(this.dragStartWeekIndex,this.dragEndWeekIndex),a=Math.max(this.dragStartWeekIndex,this.dragEndWeekIndex);for(let d=o;d<=a;d++)this.selectedCells.push({resource:this.dragStartResource,week:this.displayedWeeks[d],childId:e.id,parentId:t.id})}isCellSelected(e,t){return this.selectedCells.some(o=>o.resource.uniqueId===e.uniqueId&&o.week.getTime()===t.getTime())}clearSelection(){this.selectedCells=[],this.isSelectionFinished=!1,this.toolbarPosition=null,this.toolbarVisible=!1,this.dragStartResource=null,this.dragStartWeekIndex=-1,this.dragEndWeekIndex=-1,this.bulkChargeValue=null}applyBulkCharge(){return C(this,null,function*(){if(!(this.selectedCells.length===0||this.bulkChargeValue==null)){this.isSaving=!0;try{for(let e of this.selectedCells){let t=e.week.toISOString().split("T")[0],o,a;this.viewMode==="project"?(o=e.parentId,a=e.childId):(a=e.parentId,o=e.childId);let d=e.resource.type==="role"?e.resource.id:void 0,m=e.resource.type==="personne"?e.resource.id:void 0;yield this.chargeService.createOrUpdateCharge(o,a,t,this.bulkChargeValue,d,m)}yield this.loadData(),this.clearSelection()}catch(e){console.error("Error applying bulk charge:",e),alert("Erreur lors de l'application des charges.")}finally{this.isSaving=!1}}})}onDocumentClick(e){e.target.closest(".filters-bar")||(this.openEquipeDropdown=!1,this.openProjetDropdown=!1,this.openResourceDropdown=!1)}toggleDropdown(e,t){t.stopPropagation(),e==="equipe"?(this.openEquipeDropdown=!this.openEquipeDropdown,this.openProjetDropdown=!1,this.openResourceDropdown=!1):e==="projet"?(this.openProjetDropdown=!this.openProjetDropdown,this.openEquipeDropdown=!1,this.openResourceDropdown=!1):(this.openResourceDropdown=!this.openResourceDropdown,this.openEquipeDropdown=!1,this.openProjetDropdown=!1)}onEquipeToggle(e,t){if(!e)return;t.target.checked?this.filterEquipeIds.push(e):this.filterEquipeIds=this.filterEquipeIds.filter(a=>a!==e),this.applyFilters()}onProjetToggle(e,t){if(!e)return;t.target.checked?this.filterProjetIds.push(e):this.filterProjetIds=this.filterProjetIds.filter(a=>a!==e),this.applyFilters()}onResourceToggle(e,t){t.target.checked?this.filterResourceIds.push(e):this.filterResourceIds=this.filterResourceIds.filter(a=>a!==e),this.applyFilters()}getEquipeName(e){let t=this.allEquipes.find(o=>o.id===e);return t?t.nom:"\u2014"}getProjetLabel(e){let t=this.allProjects.find(o=>o.id===e);return t?`${t.code_projet} \u2014 ${t.nom_projet}`:"\u2014"}getResourceLabel(e){let[t,o]=e.split(":");if(t==="role"){let d=this.availableRoles.find(m=>m.id===o);return d?`Role: ${d.nom}`:"Role: \u2014"}let a=this.availablePersonnes.find(d=>d.id===o);return a?`${a.prenom} ${a.nom}`:"Pers: \u2014"}applyFilters(){if(!this.filterEquipeIds.length&&!this.filterProjetIds.length&&!this.filterResourceIds.length){this.rows=[...this.rowsAll],this.buildFlatList();return}let e=[];for(let t of this.rowsAll){let o={id:t.id,label:t.label,expanded:t.expanded,children:[],totalCharges:t.totalCharges};for(let v of t.children){let x=v.resources;this.filterResourceIds.length&&(x=v.resources.filter(re=>this.filterResourceIds.some(pe=>{let[ce,A]=pe.split(":");return ce==="role"&&re.type==="role"&&re.id===A||ce==="personne"&&re.type==="personne"&&re.id===A})));let w=!0,k=!0;this.filterEquipeIds.length&&(this.viewMode==="project"?w=this.filterEquipeIds.includes(v.id):w=!0),this.filterProjetIds.length&&(this.viewMode==="team"?k=this.filterProjetIds.includes(v.id):k=!0);let V=this.filterResourceIds.length?x.length>0:!0;w&&k&&V&&o.children.push({id:v.id,label:v.label,expanded:v.expanded,resources:x,charges:v.charges})}let a=!0,d=!0;this.filterEquipeIds.length&&(this.viewMode==="team"?a=this.filterEquipeIds.includes(t.id):a=!0),this.filterProjetIds.length&&(this.viewMode==="project"?d=this.filterProjetIds.includes(t.id):d=!0);let m=o.children.length>0;a&&d&&m&&e.push(o)}this.rows=e,this.buildFlatList()}getRowMetricsYear(e,t){let o=0;for(let a of e.children)o+=this.getChildMetricsYear(a,t);return o}getChildMetricsYear(e,t){let o=0;for(let a of e.resources)o+=this.getResourceMetricsYear(a,t);return o}getResourceMetricsYear(e,t){let o=0;for(let[a,d]of e.charges)new Date(a).getFullYear()===t&&(o+=d*e.jours_par_semaine);return o}getFlatRowMetricsYear(e,t){return this.getResourceMetricsYear(e.resource,t)}get totalSelectedDays(){let e=0;for(let t of this.selectedCells){let o=this.getResourceValue(t.resource,t.week)||0,a=t.resource.jours_par_semaine||0;e+=o*a}return e}removeResource(e,t,o){return C(this,null,function*(){let a=`\xCAtes-vous s\xFBr de vouloir supprimer "${e.label}" ?
Cela supprimera toutes les charges associ\xE9es \xE0 cette ressource.`;if(confirm(a))try{this.allCharges=this.allCharges.filter(d=>!(d.role_id===e.id&&e.type==="role"||d.personne_id===e.id&&e.type==="personne")),this.calculateUsage(),this.buildTree()}catch(d){console.error("Error removing resource:",d),alert("Erreur lors de la suppression de la ressource.")}})}};r.\u0275fac=function(t){return new(t||r)(L(ln),L(tt),L(Fi),L(an),L(cn))},r.\u0275cmp=B({type:r,selectors:[["app-plan-view"]],viewQuery:function(t,o){if(t&1&&(kt($p,5),kt(Bp,5),kt(Hp,5),kt(Gp,5)),t&2){let a;lt(a=ct())&&(o.bulkChargeInput=a.first),lt(a=ct())&&(o.headerScroll=a.first),lt(a=ct())&&(o.dataScroll=a.first),lt(a=ct())&&(o.milestonesScroll=a.first)}},hostBindings:function(t,o){t&1&&_("click",function(d){return o.onDocumentClick(d)},Bn)},decls:85,vars:38,consts:[["filtersContainer",""],["headerScroll",""],["milestonesScroll",""],["dataScroll",""],["bulkChargeInput",""],[1,"capacity-container"],[1,"capacity-header"],[1,"header-actions"],[1,"view-mode-toggle"],[1,"btn",3,"click"],[1,"toggle-container"],[1,"toggle-label"],[1,"switch"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"slider","round"],[1,"btn","btn-secondary",3,"click"],[1,"calendar-controls"],[1,"date-navigation"],[1,"btn","btn-sm",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"filters-bar"],[1,"filter-pill",3,"click"],[1,"filter-title"],[1,"chip-list"],["class","chip",4,"ngFor","ngForOf"],["class","chip placeholder",4,"ngIf"],["class","filters-dropdown",3,"click",4,"ngIf"],[1,"calendar-container"],[1,"calendar-header-wrapper"],[1,"row-label","fixed-column","header-fixed"],[2,"font-weight","600"],[1,"header-scroll-container"],[1,"row-cells","scrollable-column"],["class","week-header",3,"current-week",4,"ngFor","ngForOf"],[1,"metrics-header-fixed"],[2,"font-weight","600","font-size","12px"],[1,"milestones-header-wrapper"],[1,"row-label","fixed-column","header-fixed","milestones-fixed-col"],[2,"font-weight","600","font-size","13px"],["class","week-cell milestone-week-cell",3,"current-week",4,"ngFor","ngForOf"],[1,"metrics-header-fixed","milestones-metrics-fixed"],[1,"calendar-grid-wrapper"],[1,"calendar-grid",3,"scroll"],[4,"ngIf"],["class","empty-state",4,"ngIf"],["class","selection-toolbar",3,"top","left","transform","opacity",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"visibleChange","saved","visible","jalon","projets"],[1,"chip"],[1,"chip","placeholder"],[1,"filters-dropdown",3,"click"],[1,"dropdown-list"],["class","dropdown-item",4,"ngFor","ngForOf"],[1,"dropdown-item"],["type","checkbox",3,"change","value","checked"],[1,"dropdown-group"],[1,"week-header"],[1,"week-date"],[1,"week-number"],[1,"week-cell","milestone-week-cell"],[1,"milestones-container"],["class","jalon-item",3,"background-color","color","title","click",4,"ngFor","ngForOf"],[1,"jalon-item",3,"click","title"],[4,"ngFor","ngForOf"],[1,"calendar-row-wrapper"],[1,"row-label","fixed-column"],[1,"team-label",3,"click"],[1,"expand-icon-l",3,"name","size"],[1,"btn","btn-xs","btn-add",2,"margin-left","auto",3,"click"],[3,"img","size"],["class","week-cell team-cell",4,"ngFor","ngForOf"],[1,"metrics-cell"],[1,"metrics-group"],[1,"metric-row"],[1,"week-cell","team-cell"],["class","team-summary",4,"ngIf"],[1,"team-summary"],[1,"resource-label",2,"padding-left","32px",3,"click"],[1,"resource-name"],["class","week-cell resource-cell",4,"ngFor","ngForOf"],[1,"week-cell","resource-cell"],["class","calendar-row-wrapper",3,"mousedown","mousemove","mouseup","mouseleave",4,"ngFor","ngForOf"],[1,"calendar-row-wrapper",3,"mousedown","mousemove","mouseup","mouseleave"],[1,"row-label","fixed-column","row-detail"],[1,"resource-detail-label",2,"padding-left","50px"],[1,"resource-detail-name"],["title","Supprimer cette ressource",1,"btn","btn-xs","btn-danger",2,"margin-left","auto",3,"click"],["class","week-cell resource-detail-cell",3,"selected","has-capacity","cell-positive","cell-zero","cell-negative",4,"ngFor","ngForOf"],[1,"week-cell","resource-detail-cell"],[1,"cell-content"],["class","capacity-value",4,"ngIf"],["class","availability-indicator",3,"ngClass",4,"ngIf"],[1,"capacity-value"],[1,"availability-indicator",3,"ngClass"],[2,"padding","0 16px","font-weight","500","font-size","13px","white-space","nowrap","overflow","hidden","text-overflow","ellipsis",3,"title"],[1,"empty-state"],[1,"selection-toolbar"],[1,"selection-info"],[1,"selection-total"],[1,"selection-input-row"],["type","number","placeholder","Charge (unit\xE9s)","step","0.5","min","0",1,"bulk-input",3,"ngModelChange","keydown.enter","ngModel"],[1,"selection-actions"],[1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],["class","spinner-small",4,"ngIf"],["class","loading-overlay-local",4,"ngIf"],[1,"spinner-small"],[1,"loading-overlay-local"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"modal-close",3,"click"],[1,"modal-body"],[1,"form-group"],[1,"form-control",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"modal-actions"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"],["value","role"],["value","personne"],["class","form-group",4,"ngIf"],["class","no-roles-message",4,"ngIf"],["class","form-control",3,"ngModel","ngModelChange",4,"ngIf"],[1,"no-roles-message"]],template:function(t,o){if(t&1){let a=E();s(0,"div",5)(1,"div",6)(2,"h1"),p(3,"Vue Planification"),l(),s(4,"div",7)(5,"div",8)(6,"button",9),_("click",function(){return f(a),h(o.switchViewMode("project"))}),p(7," Par Projet "),l(),s(8,"button",9),_("click",function(){return f(a),h(o.switchViewMode("team"))}),p(9," Par \xC9quipe "),l()(),s(10,"div",8)(11,"button",9),_("click",function(){return f(a),h(o.toggleDisplayFormat("tree"))}),p(12," Arborescence "),l(),s(13,"button",9),_("click",function(){return f(a),h(o.toggleDisplayFormat("flat"))}),p(14," \xC0 plat "),l()(),s(15,"div",10)(16,"span",11),p(17,"Dispo."),l(),s(18,"label",12)(19,"input",13),O("ngModelChange",function(m){return f(a),S(o.showAvailability,m)||(o.showAvailability=m),h(m)}),l(),M(20,"span",14),l()(),s(21,"button",15),_("click",function(){return f(a),h(o.goToToday())}),p(22,"Aujourd'hui"),l()()(),s(23,"div",16)(24,"div",17)(25,"button",18),_("click",function(){return f(a),h(o.goToPreviousMonth())}),p(26,"\u2190 Mois pr\xE9c\xE9dent"),l(),s(27,"button",19),_("click",function(){return f(a),h(o.goToToday())}),p(28,"Aujourd'hui"),l(),s(29,"button",18),_("click",function(){return f(a),h(o.goToNextMonth())}),p(30,"Mois suivant \u2192"),l()(),s(31,"div",20,0)(33,"div",21),_("click",function(m){return f(a),h(o.toggleDropdown("equipe",m))}),s(34,"span",22),p(35,"\xC9quipes"),l(),s(36,"span",23),b(37,Jp,2,1,"span",24)(38,Yp,2,0,"span",25),l()(),s(39,"div",21),_("click",function(m){return f(a),h(o.toggleDropdown("projet",m))}),s(40,"span",22),p(41,"Projets"),l(),s(42,"span",23),b(43,Qp,2,1,"span",24)(44,Kp,2,0,"span",25),l()(),s(45,"div",21),_("click",function(m){return f(a),h(o.toggleDropdown("resource",m))}),s(46,"span",22),p(47,"R\xF4le / Personne"),l(),s(48,"span",23),b(49,Zp,2,1,"span",24)(50,Xp,2,0,"span",25),l()(),b(51,tu,3,1,"div",26)(52,iu,3,1,"div",26)(53,au,8,2,"div",26),l()(),s(54,"div",27)(55,"div",28)(56,"div",29)(57,"span",30),p(58),l()(),s(59,"div",31,1)(61,"div",32),b(62,su,5,4,"div",33),l()(),s(63,"div",34)(64,"div",35),p(65,"M\xE9triques"),l()()(),s(66,"div",36)(67,"div",37)(68,"span",38),p(69,"Jalons"),l()(),s(70,"div",31,2)(72,"div",32),b(73,cu,3,3,"div",39),l()(),M(74,"div",40),l(),s(75,"div",41)(76,"div",42,3),_("scroll",function(m){return f(a),h(o.onGridScroll(m))}),b(78,wu,2,1,"ng-container",43)(79,Su,2,1,"ng-container",43)(80,Ou,3,0,"div",44),l()(),b(81,Tu,16,19,"div",45),l(),b(82,ju,20,6,"div",46)(83,qu,23,5,"div",46),s(84,"app-milestone-modal",47),O("visibleChange",function(m){return f(a),S(o.showMilestoneModal,m)||(o.showMilestoneModal=m),h(m)}),_("saved",function(){return f(a),h(o.onMilestoneSaved())}),l()()}t&2&&(c(6),U("btn-primary",o.viewMode==="project")("btn-secondary",o.viewMode!=="project"),c(2),U("btn-primary",o.viewMode==="team")("btn-secondary",o.viewMode!=="team"),c(3),U("btn-primary",o.displayFormat==="tree")("btn-secondary",o.displayFormat!=="tree"),c(2),U("btn-primary",o.displayFormat==="flat")("btn-secondary",o.displayFormat!=="flat"),c(6),P("ngModel",o.showAvailability),c(18),g("ngForOf",o.filterEquipeIds),c(),g("ngIf",o.filterEquipeIds.length===0),c(5),g("ngForOf",o.filterProjetIds),c(),g("ngIf",o.filterProjetIds.length===0),c(5),g("ngForOf",o.filterResourceIds),c(),g("ngIf",o.filterResourceIds.length===0),c(),g("ngIf",o.openEquipeDropdown),c(),g("ngIf",o.openProjetDropdown),c(),g("ngIf",o.openResourceDropdown),c(5),j(o.viewMode==="project"?"Projets / \xC9quipes":"\xC9quipes / Projets"),c(4),g("ngForOf",o.displayedWeeks),c(11),g("ngForOf",o.displayedWeeks),c(5),g("ngIf",o.displayFormat==="tree"),c(),g("ngIf",o.displayFormat==="flat"),c(),g("ngIf",o.rows.length===0),c(),g("ngIf",o.selectedCells.length>0&&o.isSelectionFinished),c(),g("ngIf",o.showLinkModal),c(),g("ngIf",o.showAddResourceModal),c(),P("visible",o.showMilestoneModal),g("jalon",o.selectedJalon)("projets",o.allProjects))},dependencies:[G,Kn,Ce,X,Z,Re,Ve,ee,Qe,ii,je,te,Bt,ne,Wu,de,zi,Zn],styles:['.capacity-container[_ngcontent-%COMP%]{padding:20px;background:#f5f7fa;min-height:100vh;display:flex;flex-direction:column;overflow-x:hidden}.capacity-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.view-mode-toggle[_ngcontent-%COMP%]{display:flex;background:#e2e8f0;padding:4px;border-radius:8px;gap:4px;margin-right:16px}.view-mode-toggle[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:6px 12px;font-size:14px;border:none;border-radius:6px;cursor:pointer}.view-mode-toggle[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background:#fff;color:#1e293b;box-shadow:0 1px 3px #0000001a;font-weight:600}.view-mode-toggle[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{background:transparent;color:#64748b}.calendar-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a}.date-navigation[_ngcontent-%COMP%]{display:flex;gap:8px}.filters-bar[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;position:relative}.filter-pill[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;cursor:pointer;box-shadow:0 1px 2px #10182808;min-width:140px}.filter-title[_ngcontent-%COMP%]{font-weight:600;color:#374151;font-size:13px}.chip-list[_ngcontent-%COMP%]{display:flex;gap:6px;flex-wrap:wrap}.chip[_ngcontent-%COMP%]{background:#eef2ff;color:#3730a3;padding:4px 8px;border-radius:999px;font-size:12px}.chip.placeholder[_ngcontent-%COMP%]{background:transparent;color:#94a3b8}.filters-dropdown[_ngcontent-%COMP%]{position:absolute;top:48px;left:0;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 6px 20px #02061714;padding:8px;z-index:1200;max-height:320px;overflow:auto;min-width:260px}.dropdown-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;padding:4px}.dropdown-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:13px;padding:6px;border-radius:6px}.dropdown-item[_ngcontent-%COMP%]:hover{background:#f8fafc}.dropdown-group[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;padding:8px 4px 2px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:1px solid transparent;cursor:pointer;font-weight:500;transition:all .2s}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.btn-xs[_ngcontent-%COMP%]{padding:2px 4px;font-size:11px}.btn-add[_ngcontent-%COMP%]{margin-left:auto;display:flex;align-items:center;justify-content:center;color:#6b7280;border:1px solid #e5e7eb;background:#fff}.btn-add[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.btn-danger[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:#fecaca;color:#991b1b;border:1px solid #fca5a5;padding:2px 6px;border-radius:4px;cursor:pointer;font-size:16px;line-height:1;transition:all .15s ease}.btn-danger[_ngcontent-%COMP%]:hover{background:#fca5a5;color:#7f1d1d}.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#2563eb}.btn-secondary[_ngcontent-%COMP%]{background:#fff;border:1px solid #d1d5db;color:#374151}.btn-secondary[_ngcontent-%COMP%]:hover{background:#f3f4f6}.calendar-wrapper[_ngcontent-%COMP%]{display:flex;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden;max-height:calc(100vh - 250px);position:relative}.calendar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;background:#fff;border-radius:8px;box-shadow:0 1px 3px #0000001a;overflow:hidden;max-height:calc(100vh - 250px)}.calendar-header-wrapper[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #e2e8f0;min-height:60px;background:#f9fafb;flex-shrink:0}.milestones-header-wrapper[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #e2e8f0;min-height:40px;background:#fff;flex-shrink:0}.milestones-fixed-col[_ngcontent-%COMP%]{background:#fff}.milestones-metrics-fixed[_ngcontent-%COMP%]{background:#fff;border-left:2px solid #e2e8f0;width:200px;flex-shrink:0}.milestone-week-cell[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:2px;background:#fff;border-right:1px solid #e2e8f0}.milestones-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:2px;justify-content:center;width:100%}.jalon-item[_ngcontent-%COMP%]{font-size:10px;font-weight:700;padding:3px 6px;border-radius:12px;cursor:help;box-shadow:0 1px 2px #0000000d;display:inline-flex;align-items:center;justify-content:center;min-width:20px;line-height:1.2;text-align:center;white-space:nowrap}.header-fixed[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 16px;background:#f9fafb;border-right:2px solid #e2e8f0;z-index:10}.header-scroll-container[_ngcontent-%COMP%]{flex:1;overflow-x:hidden;overflow-y:hidden;display:flex}.metrics-header-fixed[_ngcontent-%COMP%]{width:200px;flex-shrink:0;padding:0 16px;display:flex;align-items:center;justify-content:center;background:#f9fafb;border-left:2px solid #e2e8f0;z-index:10;text-align:center}.calendar-row-wrapper[_ngcontent-%COMP%]{display:flex;min-height:48px}.calendar-grid-wrapper[_ngcontent-%COMP%]{display:flex;flex:1;position:relative;overflow:hidden}.row-label[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0 16px;border-bottom:1px solid #e2e8f0}.fixed-column[_ngcontent-%COMP%]{width:300px;flex-shrink:0;border-right:2px solid #e2e8f0;background:#f9fafb;position:sticky;left:0;z-index:5}.calendar-row-wrapper[_ngcontent-%COMP%]   .row-label.fixed-column.row-detail[_ngcontent-%COMP%]{background:#fff}.row-cells[_ngcontent-%COMP%]{display:flex;flex:1;border-bottom:1px solid #e2e8f0}.scrollable-column[_ngcontent-%COMP%]{position:relative}.metrics-cell[_ngcontent-%COMP%]{width:200px;flex-shrink:0;padding:12px 16px;border-left:2px solid #e2e8f0;background:#fff;position:sticky;right:0;z-index:8;display:flex;align-items:center;justify-content:center;min-height:48px;font-size:12px}.metrics-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.metric-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:12px}.metric-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#374151;min-width:50px}.metric-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#1e293b}.calendar-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow-x:auto;overflow-y:auto}.calendar-row-wrapper[_ngcontent-%COMP%]   .fixed-column[_ngcontent-%COMP%]{background:#f9fafb}.week-header[_ngcontent-%COMP%]{min-width:80px;width:80px;padding:8px;border-right:1px solid #e2e8f0;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;font-weight:600;background:#f9fafb}.week-date[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.week-number[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:#374151}.week-header.current-week[_ngcontent-%COMP%]{background:#dbeafe;border-left:3px solid #3b82f6}.week-cell[_ngcontent-%COMP%]{min-width:80px;width:80px;padding:8px;border-right:1px solid #e2e8f0;text-align:center;display:flex;align-items:center;justify-content:center;flex-shrink:0}.team-cell[_ngcontent-%COMP%]{background:#f9fafb}.resource-cell[_ngcontent-%COMP%]{background:#f9fafb;transition:background .15s ease}.resource-cell.has-capacity[_ngcontent-%COMP%]{background:#d1fae5;font-weight:600;color:#059669}.cell-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.1;-webkit-user-select:none;user-select:none}.capacity-value[_ngcontent-%COMP%]{font-size:13px;font-weight:600}.team-summary[_ngcontent-%COMP%]{color:#6b7280;display:flex;flex-direction:column;align-items:center;justify-content:center;line-height:1.1;-webkit-user-select:none;user-select:none}.empty-state-weeks[_ngcontent-%COMP%]{padding:40px;text-align:center;color:#6b7280}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:2000}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;min-width:400px;max-width:90vw;max-height:90vh;overflow:auto}.modal-header[_ngcontent-%COMP%]{padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px}.modal-close[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#6b7280;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px}.modal-close[_ngcontent-%COMP%]:hover{background:#f3f4f6}.modal-body[_ngcontent-%COMP%]{padding:24px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#374151}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:24px;justify-content:flex-end}.no-roles-message[_ngcontent-%COMP%]{padding:9px;background:#fef3c7;border:1px solid #f59e0b;border-radius:6px;color:#92400e;text-align:center}.no-roles-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}.resource-detail-cell[_ngcontent-%COMP%]{cursor:crosshair;transition:background .15s ease;position:relative}.resource-detail-cell[_ngcontent-%COMP%]:hover{background:#f3f4f6}.resource-detail-cell.selected[_ngcontent-%COMP%]{background:#dbeafe;border:2px solid #3b82f6}.resource-detail-cell.has-capacity.selected[_ngcontent-%COMP%]{background:#bfdbfe;border:2px solid #3b82f6}.availability-indicator[_ngcontent-%COMP%]{font-size:10px;margin-top:2px;font-weight:500}.availability-positive[_ngcontent-%COMP%]{color:#059669}.cell-positive[_ngcontent-%COMP%]{background:#d1fae5!important}.cell-zero[_ngcontent-%COMP%]{background:#fef3c7!important}.cell-negative[_ngcontent-%COMP%]{background:#fee2e2!important}.text-positive[_ngcontent-%COMP%]{color:#059669}.text-zero[_ngcontent-%COMP%]{color:#d97706}.text-negative[_ngcontent-%COMP%]{color:#dc2626}.selection-toolbar[_ngcontent-%COMP%]{position:fixed;background:#fff;padding:16px 24px;border-radius:12px;box-shadow:0 10px 25px #0003;align-items:center;gap:16px;z-index:1000;transition:top .2s ease,left .2s ease;min-width:260px}.selection-info[_ngcontent-%COMP%]{font-weight:600;color:#374151;margin-bottom:8px}.selection-total[_ngcontent-%COMP%]{font-weight:500;font-size:13px;margin-top:6px;margin-bottom:10px;color:#065f46}.selection-input-row[_ngcontent-%COMP%]{margin-bottom:12px}.selection-input-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.selection-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;justify-content:center}.selection-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.bulk-input[_ngcontent-%COMP%]{width:100%;padding:6px 12px;border:1px solid #d1d5db;border-radius:6px}.toggle-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;background:#fff;padding:4px 12px;border-radius:8px;border:1px solid #e5e7eb;height:38px}.toggle-label[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:#374151}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:32px;height:18px}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:#ccc;-webkit-transition:.4s;transition:.4s;border-radius:34px}.slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:14px;width:14px;left:2px;bottom:2px;background-color:#fff;-webkit-transition:.4s;transition:.4s;border-radius:50%}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#3b82f6}input[_ngcontent-%COMP%]:focus + .slider[_ngcontent-%COMP%]{box-shadow:0 0 1px #3b82f6}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{-webkit-transform:translateX(14px);-ms-transform:translateX(14px);transform:translate(14px)}.loading-overlay-local[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;border-radius:12px;display:flex;align-items:center;justify-content:center;gap:12px;z-index:10;font-weight:600;color:#6366f1}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid rgba(99,102,241,.2);border-top:2px solid #6366f1;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']});let i=r;return i})();function Uu(i,r){if(i&1&&(s(0,"span",23),p(1),l()),i&2){let n,e=u().$implicit,t=u();c(),y(" ",(n=t.getProject(e.projet_id))==null?null:n.nom_projet," ")}}function $u(i,r){i&1&&(s(0,"span",24),p(1,"-"),l())}function Bu(i,r){if(i&1){let n=E();s(0,"tr")(1,"td",10),p(2),se(3,"date"),l(),s(4,"td",11),p(5),l(),s(6,"td"),b(7,Uu,2,1,"span",12)(8,$u,2,0,"span",13),l(),s(9,"td")(10,"span",14),p(11),l()(),s(12,"td",15)(13,"button",16),_("click",function(){let t=f(n).$implicit,o=u();return h(o.openEditModal(t))}),ht(),s(14,"svg",17),M(15,"path",18)(16,"path",19),l()(),Ot(),s(17,"button",20),_("click",function(){let t=f(n).$implicit,o=u();return h(o.deleteJalon(t))}),ht(),s(18,"svg",17),M(19,"polyline",21)(20,"path",22),l()()()()}if(i&2){let n=r.$implicit,e=u();c(2),j(le(3,6,n.date_jalon,"dd/MM/yyyy")),c(3),j(n.nom),c(2),g("ngIf",e.getProject(n.projet_id)),c(),g("ngIf",!n.projet_id),c(2),Me("data-type",n.type),c(),y(" ",n.type||"Autre"," ")}}function Hu(i,r){i&1&&(s(0,"tr")(1,"td",25),p(2,"Aucun jalon trouv\xE9"),l()())}var fs=(()=>{let r=class r{constructor(e,t){this.jalonService=e,this.projetService=t,this.jalons=[],this.projets=[],this.showModal=!1,this.currentJalon=null}ngOnInit(){return C(this,null,function*(){yield this.loadData()})}loadData(){return C(this,null,function*(){try{let[e,t]=yield Promise.all([this.jalonService.getAllJalons(),this.projetService.getAllProjets()]);this.jalons=e,this.projets=t}catch(e){console.error("Error loading data:",e)}})}getProject(e){if(e)return this.projets.find(t=>t.id===e)}openCreateModal(){this.currentJalon=null,this.showModal=!0}openEditModal(e){this.currentJalon=e,this.showModal=!0}onJalonSaved(){return C(this,null,function*(){yield this.loadData()})}deleteJalon(e){return C(this,null,function*(){if(!(!e.id||!confirm("\xCAtes-vous s\xFBr de vouloir supprimer ce jalon ?")))try{yield this.jalonService.deleteJalon(e.id),yield this.loadData()}catch(t){console.error("Error deleting jalon:",t)}})}};r.\u0275fac=function(t){return new(t||r)(L(cn),L(tt))},r.\u0275cmp=B({type:r,selectors:[["app-milestones-view"]],decls:27,vars:5,consts:[[1,"milestones-container"],[1,"milestones-header"],[1,"subtitle"],[1,"btn","btn-primary",3,"click"],[1,"milestones-list"],[1,"milestones-table"],[2,"width","100px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"visibleChange","saved","visible","jalon","projets"],[1,"date-cell"],[1,"name-cell"],["class","project-badge",4,"ngIf"],["class","no-project",4,"ngIf"],[1,"type-badge"],[1,"actions-cell"],["title","Modifier",1,"action-btn","edit",3,"click"],["width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"],["d","M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"],["title","Supprimer",1,"action-btn","delete",3,"click"],["points","3 6 5 6 21 6"],["d","M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"],[1,"project-badge"],[1,"no-project"],["colspan","5",1,"empty-state"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"div")(3,"h1"),p(4,"Jalons"),l(),s(5,"p",2),p(6,"G\xE9rez les jalons de vos projets"),l()(),s(7,"button",3),_("click",function(){return o.openCreateModal()}),p(8," + Nouveau Jalon "),l()(),s(9,"div",4)(10,"table",5)(11,"thead")(12,"tr")(13,"th"),p(14,"Date"),l(),s(15,"th"),p(16,"Nom"),l(),s(17,"th"),p(18,"Projet"),l(),s(19,"th"),p(20,"Type"),l(),s(21,"th",6),p(22,"Actions"),l()()(),s(23,"tbody"),b(24,Bu,21,9,"tr",7)(25,Hu,3,0,"tr",8),l()()()(),s(26,"app-milestone-modal",9),O("visibleChange",function(d){return S(o.showModal,d)||(o.showModal=d),d}),_("saved",function(){return o.onJalonSaved()}),l()),t&2&&(c(24),g("ngForOf",o.jalons),c(),g("ngIf",o.jalons.length===0),c(),P("visible",o.showModal),g("jalon",o.currentJalon)("projets",o.projets))},dependencies:[G,Ce,X,Z,zi,Dr],styles:[".milestones-container[_ngcontent-%COMP%]{padding:32px;background:#f5f7fa;min-height:100vh}.milestones-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px}.milestones-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 4px;font-size:32px;font-weight:700;color:#111827}.subtitle[_ngcontent-%COMP%]{margin:0;color:#6b7280;font-size:16px}.btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-weight:500;cursor:pointer;border:none;transition:all .2s}.btn-primary[_ngcontent-%COMP%]{background:#4f46e5;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#4338ca}.milestones-list[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 1px 3px #0000001a;overflow:hidden}.milestones-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.milestones-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:16px;text-align:left;font-size:12px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:.5px;border-bottom:2px solid #e5e7eb;background:#f9fafb}.milestones-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #f3f4f6;color:#374151;font-size:14px}.milestones-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.milestones-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f9fafb}.date-cell[_ngcontent-%COMP%]{font-family:Consolas,Monaco,monospace;color:#6b7280}.name-cell[_ngcontent-%COMP%]{font-weight:500;color:#111827}.project-badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;background:#e0e7ff;color:#4338ca;border-radius:12px;font-size:12px;font-weight:500}.no-project[_ngcontent-%COMP%]{color:#9ca3af;font-style:italic}.type-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600;text-transform:uppercase;background:#f3f4f6;color:#4b5563}.type-badge[data-type=LV][_ngcontent-%COMP%]{background:#d1fae5;color:#065f46}.type-badge[data-type=MEP][_ngcontent-%COMP%]{background:#dbeafe;color:#1e40af}.type-badge[data-type=SP][_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:8px}.action-btn[_ngcontent-%COMP%]{padding:6px;border:none;background:transparent;cursor:pointer;color:#9ca3af;border-radius:4px;transition:all .2s;display:flex;align-items:center;justify-content:center}.action-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6}.action-btn.edit[_ngcontent-%COMP%]:hover{color:#4f46e5}.action-btn.delete[_ngcontent-%COMP%]:hover{color:#ef4444}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#9ca3af;padding:40px!important}"]});let i=r;return i})();var hs=(()=>{let r=class r{constructor(){this.email=ie(""),this.password=ie(""),this.showPassword=ie(!1),this.loading=!1,this.Eye=Wt,this.EyeOff=qt,this.supabaseService=I(H),this.router=I(fe)}togglePasswordVisibility(){this.showPassword.update(e=>!e)}signInWithEmail(){return C(this,null,function*(){this.loading=!0;try{let{error:e}=yield this.supabaseService.signInWithEmail({email:this.email(),password:this.password()});e?alert("Error signing in: "+e.message):this.router.navigate(["/"])}finally{this.loading=!1}})}navigateToSignup(){this.router.navigate(["/signup"])}navigateToForgot(){this.router.navigate(["/forgot-password"])}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=B({type:r,selectors:[["app-login"]],decls:19,vars:6,consts:[[1,"container"],[3,"ngSubmit"],["type","email","name","email","placeholder","Email","required","","autocomplete","email",3,"ngModelChange","ngModel"],[1,"password-container"],["name","password","placeholder","Password","required","","autocomplete","current-password",3,"ngModelChange","type","ngModel"],["type","button","tabindex","-1",1,"toggle-password",3,"click"],["size","20",3,"img"],["type","submit",3,"disabled"],[3,"click"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"h2"),p(2,"Login"),l(),s(3,"form",1),_("ngSubmit",function(){return o.signInWithEmail()}),s(4,"input",2),O("ngModelChange",function(d){return S(o.email,d)||(o.email=d),d}),l(),s(5,"div",3)(6,"input",4),O("ngModelChange",function(d){return S(o.password,d)||(o.password=d),d}),l(),s(7,"button",5),_("click",function(){return o.togglePasswordVisibility()}),M(8,"lucide-icon",6),l()(),s(9,"button",7),p(10),l()(),s(11,"p"),p(12,"Don't have an account? "),s(13,"a",8),_("click",function(){return o.navigateToSignup()}),p(14,"Sign Up"),l()(),s(15,"p"),p(16,"Forgot your password ? "),s(17,"a",8),_("click",function(){return o.navigateToForgot()}),p(18,"Send me a link"),l()()()),t&2&&(c(4),P("ngModel",o.email),c(2),g("type",o.showPassword()?"text":"password"),P("ngModel",o.password),c(2),g("img",o.showPassword()?o.EyeOff:o.Eye),c(),g("disabled",o.loading),c(),y(" ",o.loading?"Loading...":"Sign In"," "))},dependencies:[Z,we,ee,te,ve,be,ne,xe,K,de],styles:[".container[_ngcontent-%COMP%]{max-width:400px;margin:2rem auto;padding:2rem;background:#fff;border-radius:8px;box-shadow:0 4px 6px -1px #0000001a}h2[_ngcontent-%COMP%]{text-align:center;color:#1e293b;margin-bottom:2rem}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}input[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e2e8f0;border-radius:6px;font-size:1rem;width:100%;box-sizing:border-box}button[type=submit][_ngcontent-%COMP%]{padding:.75rem;background:#2563eb;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s}button[type=submit][_ngcontent-%COMP%]:hover{background:#1d4ed8}button[type=submit][_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}p[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:#64748b}a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;cursor:pointer;font-weight:500}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.password-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;background:none;border:none;cursor:pointer;padding:0;display:flex;align-items:center;color:#64748b}.toggle-password[_ngcontent-%COMP%]:hover{color:#1e293b}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 4px 6px -1px #00000080}body.dark-mode[_nghost-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   h2[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]{background:#334155;border-color:#475569;color:#f8fafc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]{color:#94a3b8}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   p[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   p[_ngcontent-%COMP%]{color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   a[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #334155 inset!important;-webkit-text-fill-color:#f8fafc!important;caret-color:#f8fafc}"]});let i=r;return i})();function Gu(i,r){if(i&1&&(s(0,"div",12),p(1),l()),i&2){let n=u();c(),y(" ",n.error()," ")}}function Ju(i,r){if(i&1&&(s(0,"div",13),p(1),l()),i&2){let n=u();c(),y(" ",n.message()," ")}}var _s=(()=>{let r=class r{constructor(){this.name="",this.email="",this.password=ie(""),this.confirmPassword=ie(""),this.showPassword=ie(!1),this.showConfirmPassword=ie(!1),this.loading=!1,this.error=ie(null),this.message=ie(null),this.Eye=Wt,this.EyeOff=qt,this.supabaseService=I(H),this.router=I(fe)}togglePasswordVisibility(){this.showPassword.update(e=>!e)}toggleConfirmPasswordVisibility(){this.showConfirmPassword.update(e=>!e)}signUp(){return C(this,null,function*(){if(this.error.set(null),this.message.set(null),this.password().length<6){this.error.set("Le mot de passe doit contenir au moins 6 caract\xE8res.");return}if(this.password()!==this.confirmPassword()){this.error.set("Les mots de passe ne correspondent pas.");return}let{error:e}=yield this.supabaseService.signUpWithEmail({name:this.name,email:this.email,password:this.password()});e?alert("Error signing up: "+e.message):(alert("Check your email to confirm your account!"),this.router.navigate(["/login"]))})}navigateToLogin(){this.router.navigate(["/login"])}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=B({type:r,selectors:[["app-signup"]],decls:22,vars:10,consts:[[1,"container"],["type","text","name","name","placeholder","Full Name","required","","autocomplete","name",3,"ngModelChange","ngModel"],["type","email","name","email","placeholder","Email","required","","autocomplete","email",3,"ngModelChange","ngModel"],[1,"password-container"],["name","password","minlength","6","placeholder","Mot de passe (Minimum 6 caract\xE8res)","required","","autocomplete","new-password",3,"ngModelChange","type","ngModel"],["type","button","tabindex","-1",1,"toggle-password",3,"click"],["size","20",3,"img"],["id","confirmPassword","name","confirmPassword","placeholder","Confirmez votre mot de passe","minlength","6","required","","autocomplete","new-password",3,"ngModelChange","type","ngModel"],["type","button",3,"click"],["class","message error",4,"ngIf"],["class","message success",4,"ngIf"],[3,"click"],[1,"message","error"],[1,"message","success"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"h2"),p(2,"Sign Up"),l(),s(3,"form")(4,"input",1),O("ngModelChange",function(d){return S(o.name,d)||(o.name=d),d}),l(),s(5,"input",2),O("ngModelChange",function(d){return S(o.email,d)||(o.email=d),d}),l(),s(6,"div",3)(7,"input",4),_("ngModelChange",function(d){return o.password.set(d)}),l(),s(8,"button",5),_("click",function(){return o.togglePasswordVisibility()}),M(9,"lucide-icon",6),l()(),s(10,"div",3)(11,"input",7),_("ngModelChange",function(d){return o.confirmPassword.set(d)}),l(),s(12,"button",5),_("click",function(){return o.toggleConfirmPasswordVisibility()}),M(13,"lucide-icon",6),l()(),s(14,"button",8),_("click",function(){return o.signUp()}),p(15,"Sign Up"),l()(),b(16,Gu,2,1,"div",9)(17,Ju,2,1,"div",10),s(18,"p"),p(19,"Already have an account? "),s(20,"a",11),_("click",function(){return o.navigateToLogin()}),p(21,"Log In"),l()()()),t&2&&(c(4),P("ngModel",o.name),c(),P("ngModel",o.email),c(2),g("type",o.showPassword()?"text":"password")("ngModel",o.password()),c(2),g("img",o.showPassword()?o.EyeOff:o.Eye),c(2),g("type",o.showConfirmPassword()?"text":"password")("ngModel",o.confirmPassword()),c(2),g("img",o.showConfirmPassword()?o.EyeOff:o.Eye),c(3),g("ngIf",o.error()),c(),g("ngIf",o.message()))},dependencies:[Z,we,ee,te,ve,be,oi,ne,xe,G,X,K,de],styles:[".container[_ngcontent-%COMP%]{max-width:400px;margin:2rem auto;padding:2rem;background:#fff;border-radius:8px;box-shadow:0 4px 6px -1px #0000001a}h2[_ngcontent-%COMP%]{text-align:center;color:#1e293b;margin-bottom:2rem}form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}input[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #e2e8f0;border-radius:6px;font-size:1rem;width:100%;box-sizing:border-box}button[_ngcontent-%COMP%]{padding:.75rem;background:#2563eb;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s}button[_ngcontent-%COMP%]:hover{background:#1d4ed8}.message[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;margin-top:1rem;text-align:center}.error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}p[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:#64748b}a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;cursor:pointer;font-weight:500}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.password-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;background:none;border:none;cursor:pointer;padding:0;display:flex;align-items:center;color:#64748b}.toggle-password[_ngcontent-%COMP%]:hover{background:none;color:#1e293b}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 4px 6px -1px #00000080}body.dark-mode[_nghost-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   h2[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]{background:#334155;border-color:#475569;color:#f8fafc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]{color:#94a3b8}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   p[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   p[_ngcontent-%COMP%]{color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   a[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{color:#60a5fa}body.dark-mode[_nghost-%COMP%]   .error[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .error[_ngcontent-%COMP%]{background:#7f1d1d;color:#fecaca}body.dark-mode[_nghost-%COMP%]   .success[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .success[_ngcontent-%COMP%]{background:#14532d;color:#bbf7d0}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #334155 inset!important;-webkit-text-fill-color:#f8fafc!important;caret-color:#f8fafc}"]});let i=r;return i})();function Yu(i,r){if(i&1&&(s(0,"div",8),p(1),l()),i&2){let n=u();c(),y(" ",n.message," ")}}var Cs=(()=>{let r=class r{constructor(e){this.supabaseService=e,this.email="",this.message="",this.loading=!1,this.router=I(fe)}onSubmit(){return C(this,null,function*(){this.loading=!0;try{yield this.supabaseService.resetPasswordForEmail(this.email),this.message="Un lien de r\xE9initialisation a \xE9t\xE9 envoy\xE9 \xE0 votre adresse email."}catch(e){this.message=`Erreur : ${e.message}`}finally{this.loading=!1}})}navigateToLogin(){this.router.navigate(["/login"])}};r.\u0275fac=function(t){return new(t||r)(L(H))},r.\u0275cmp=B({type:r,selectors:[["app-forgot-password"]],decls:14,vars:2,consts:[[1,"forgot-password-container"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","name","email","required","","placeholder","Votre email",3,"ngModelChange","ngModel"],["type","submit"],["class","message",4,"ngIf"],[3,"click"],[1,"message"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"h2"),p(2,"Mot de passe oubli\xE9"),l(),s(3,"form",1),_("ngSubmit",function(){return o.onSubmit()}),s(4,"div",2)(5,"label",3),p(6,"Email"),l(),s(7,"input",4),O("ngModelChange",function(d){return S(o.email,d)||(o.email=d),d}),l()(),s(8,"button",5),p(9,"Envoyer le lien de r\xE9initialisation"),l()(),b(10,Yu,2,1,"div",6),s(11,"p")(12,"a",7),_("click",function(){return o.navigateToLogin()}),p(13,"Retour au Log In"),l()()()),t&2&&(c(7),P("ngModel",o.email),c(3),g("ngIf",o.message))},dependencies:[Z,we,ee,te,ve,be,ne,xe,G,X],styles:[".forgot-password-container[_ngcontent-%COMP%]{max-width:500px;margin:2rem auto;padding:2rem;background:#fff;border-radius:12px;box-shadow:0 6px 18px #0000001a;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.forgot-password-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;text-align:center;margin-bottom:2rem;font-weight:500}.forgot-password-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:#2c3e50;font-weight:500}.forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{width:100%;padding:.85rem;border:1px solid #ddd;border-radius:6px;font-size:1rem;transition:border-color .3s ease,box-shadow .3s ease}.forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 2px #3498db33}.forgot-password-container[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{width:100%;padding:.85rem;background-color:#3498db;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background-color .3s ease;margin-top:.5rem}.forgot-password-container[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#2980b9}.forgot-password-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1rem;text-align:center;border-radius:6px;background-color:#e8f4fc;color:#2c3e50;border:1px solid #b8d8f0}p[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;color:#555;font-size:.9rem}a[_ngcontent-%COMP%]{color:#3498db;text-decoration:none;font-weight:500;cursor:pointer;transition:color .3s ease}.container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#2980b9;text-decoration:underline}body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 6px 18px #0000004d}body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%]{background:#334155;border-color:#475569;color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#38bdf8;box-shadow:0 0 0 2px #38bdf833}body.dark-mode[_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .forgot-password-container[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{background-color:#0f172a;color:#e2e8f0;border-color:#334155}body.dark-mode[_nghost-%COMP%]   p[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   p[_ngcontent-%COMP%]{color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   a[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{color:#38bdf8}body.dark-mode[_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#7dd3fc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #334155 inset!important;-webkit-text-fill-color:#f8fafc!important;transition:background-color 5000s ease-in-out 0s}"]});let i=r;return i})();var vs=(i,r)=>C(null,null,function*(){if(!Xr.enableAuth)return!0;let n=I(H),e=I(fe),{data:t}=yield n.getUser();return t.user?!0:(e.navigate(["/login"],{queryParams:{returnUrl:r.url}}),!1)});function Qu(i,r){if(i&1&&(at(0,"div",2)(1,"p"),p(2),st(),at(3,"p"),p(4),st(),at(5,"p"),p(6),st()()),i&2){let n=u();c(2),y("User ID: ",n.user.id),c(2),y("Email: ",n.user.email),c(2),y("Display Name: ",n.user.user_metadata.displayName)}}var xs=(()=>{let r=class r{constructor(){this.user=null,this.loading=!1,this.showInfo=!1,this.supabaseService=I(H),this.router=I(fe)}ngOnInit(){}toggleUserInfo(){return C(this,null,function*(){this.user?this.showInfo=!this.showInfo:(yield this.fetchUser(),this.showInfo=!0)})}fetchUser(){return C(this,null,function*(){this.loading=!0;try{let{data:e}=yield this.supabaseService.getUser();this.user=e.user,this.user||this.router.navigate(["/login"])}finally{this.loading=!1}})}signOut(){return C(this,null,function*(){yield this.supabaseService.signOut(),this.router.navigate(["/login"])})}updatePassword(){return C(this,null,function*(){this.router.navigate(["/update-password"])})}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=B({type:r,selectors:[["app-profile"]],decls:12,vars:3,consts:[[1,"container"],[1,"btn","btn-primary",3,"click","disabled"],[1,"user-info"],[1,"btn","btn-secondary",3,"click"],[1,"btn",3,"click"]],template:function(t,o){t&1&&(at(0,"div",0)(1,"h2"),p(2,"User Profile"),st(),at(3,"p"),p(4,"Congratulations! Welcome to secure auth with Angular + Supabase is running. \u{1F389}"),st(),at(5,"button",1),Hn("click",function(){return o.toggleUserInfo()}),p(6),st(),q(7,Qu,7,3,"div",2),at(8,"button",3),Hn("click",function(){return o.updatePassword()}),p(9,"Modifier le mot de passe"),st(),at(10,"button",4),Hn("click",function(){return o.signOut()}),p(11,"Sign Out"),st()()),t&2&&(c(5),yr("disabled",o.loading),c(),y(" ",o.loading?"Chargement...":o.showInfo?"Masquer les informations":"Afficher les informations personnelles"," "),c(),W(o.showInfo&&o.user?7:-1))},dependencies:[K,G],styles:[".container[_ngcontent-%COMP%]{max-width:500px;margin:2rem auto;padding:2rem;background:#fff;border-radius:12px;box-shadow:0 6px 18px #0000001a;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;text-align:left}.container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:1.5rem;font-weight:500;text-align:left}.container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem;color:#555;line-height:1.5;text-align:left}.container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-of-type{font-size:1.1rem;margin-bottom:2rem;color:#27ae60}.container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-of-type){font-weight:500;color:#2c3e50;word-break:break-all}.container[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;width:100%;padding:.85rem;margin-top:1rem;background-color:#e74c3c;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background-color .3s ease}.container[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:#c0392b}.container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;margin-top:2rem}.container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover{background-color:#5a6268}.container[_ngcontent-%COMP%]   .btn-theme[_ngcontent-%COMP%]{background-color:#3498db;margin-top:2rem}.container[_ngcontent-%COMP%]   .btn-theme[_ngcontent-%COMP%]:hover{background-color:#2980b9}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 6px 18px #0000004d}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-of-type, body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-of-type{color:#4ade80}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-of-type), body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:not(:first-of-type){color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]{background-color:#334155;color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:hover{background-color:#475569;color:#f8fafc}.user-info[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1rem;background:#f8f9fa;border-radius:8px;border:1px solid #e9ecef}body.dark-mode[_nghost-%COMP%]   .user-info[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .user-info[_ngcontent-%COMP%]{background:#334155;border-color:#475569}.theme-selector[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:#f8f9fa;border-radius:8px;border:1px solid #e9ecef}.theme-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;font-weight:600;color:#2c3e50;font-size:.95rem}.theme-buttons[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-start}.theme-btn[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.5rem;padding:1rem .75rem;background:#fff;color:#2c3e50;border:2px solid #e9ecef;border-radius:6px;font-size:.85rem;font-weight:500;cursor:pointer;transition:all .3s ease}.theme-btn[_ngcontent-%COMP%]:hover{border-color:#3498db;background:#f0f7ff}.theme-btn.active[_ngcontent-%COMP%]{background:#3498db;color:#fff;border-color:#3498db;box-shadow:0 2px 8px #3498db4d}.theme-btn[_ngcontent-%COMP%]   lucide-icon[_ngcontent-%COMP%]{display:block}.theme-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block}body.dark-mode[_nghost-%COMP%]   .theme-selector[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .theme-selector[_ngcontent-%COMP%]{background:#334155;border-color:#475569}body.dark-mode[_nghost-%COMP%]   .theme-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .theme-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .theme-btn[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .theme-btn[_ngcontent-%COMP%]{background:#1e293b;color:#cbd5e1;border-color:#475569}body.dark-mode[_nghost-%COMP%]   .theme-btn[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .theme-btn[_ngcontent-%COMP%]:hover{border-color:#64b5f6;background:#0f172a}body.dark-mode[_nghost-%COMP%]   .theme-btn.active[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .theme-btn.active[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;border-color:#3b82f6;box-shadow:0 2px 8px #3b82f64d}"]});let i=r;return i})();function Ku(i,r){if(i&1){let n=E();s(0,"form",8),_("ngSubmit",function(){f(n);let t=u();return h(t.onSubmit())}),s(1,"div",9)(2,"label",10),p(3,"Nouveau mot de passe"),l(),s(4,"div",11)(5,"input",12),_("ngModelChange",function(t){f(n);let o=u();return h(o.newPassword.set(t))}),l(),s(6,"button",13),_("click",function(){f(n);let t=u();return h(t.toggleNewPasswordVisibility())}),M(7,"lucide-icon",14),l()()(),s(8,"div",9)(9,"label",15),p(10,"Confirmer le mot de passe"),l(),s(11,"div",11)(12,"input",16),_("ngModelChange",function(t){f(n);let o=u();return h(o.confirmPassword.set(t))}),l(),s(13,"button",13),_("click",function(){f(n);let t=u();return h(t.toggleConfirmPasswordVisibility())}),M(14,"lucide-icon",14),l()()(),s(15,"button",17),p(16),l()()}if(i&2){let n=u();c(5),g("type",n.showNewPassword()?"text":"password")("ngModel",n.newPassword())("disabled",n.loading),c(2),g("img",n.showNewPassword()?n.EyeOff:n.Eye),c(5),g("type",n.showConfirmPassword()?"text":"password")("ngModel",n.confirmPassword())("disabled",n.loading),c(2),g("img",n.showConfirmPassword()?n.EyeOff:n.Eye),c(),g("disabled",n.loading),c(),y(" ",n.loading?"Mise \xE0 jour...":"Mettre \xE0 jour le mot de passe"," ")}}function Zu(i,r){if(i&1&&(s(0,"div",18),p(1),l()),i&2){let n=u();c(),y(" ",n.error()," ")}}function Xu(i,r){if(i&1&&(s(0,"div",19),p(1),l()),i&2){let n=u();c(),y(" ",n.message()," ")}}var ws=(()=>{let r=class r{constructor(){this.newPassword=ie(""),this.confirmPassword=ie(""),this.showNewPassword=ie(!1),this.showConfirmPassword=ie(!1),this.message=ie(null),this.error=ie(null),this.loading=!1,this.success=!1,this.Eye=Wt,this.EyeOff=qt,this.supabaseService=I(H),this.router=I(fe)}ngOnInit(){return C(this,null,function*(){let{data:e}=yield this.supabaseService.getSession();e.session||this.error.set("Session invalide. Veuillez demander un nouveau lien de r\xE9initialisation.")})}toggleNewPasswordVisibility(){this.showNewPassword.update(e=>!e)}toggleConfirmPasswordVisibility(){this.showConfirmPassword.update(e=>!e)}onSubmit(){return C(this,null,function*(){if(this.error.set(null),this.message.set(null),this.newPassword().length<6){this.error.set("Le mot de passe doit contenir au moins 6 caract\xE8res.");return}if(this.newPassword()!==this.confirmPassword()){this.error.set("Les mots de passe ne correspondent pas.");return}this.loading=!0;try{let{error:e}=yield this.supabaseService.updatePassword(this.newPassword());e?this.error.set("Erreur : "+e.message):(this.message.set("Mot de passe mis \xE0 jour avec succ\xE8s !"),this.success=!0)}catch(e){this.error.set("Une erreur est survenue : "+e.message)}finally{this.loading=!1}})}goToProfile(){this.router.navigate(["/profile"])}goToLogin(){this.router.navigate(["/login"])}};r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=B({type:r,selectors:[["app-update-password"]],decls:13,vars:3,consts:[[1,"update-password-container"],[1,"update-password-card"],[1,"subtitle"],[3,"ngSubmit",4,"ngIf"],["class","message error",4,"ngIf"],["class","message success",4,"ngIf"],[1,"profile-button",3,"click"],[1,"login-button",3,"click"],[3,"ngSubmit"],[1,"form-group"],["for","newPassword"],[1,"password-container"],["id","newPassword","name","newPassword","required","","minlength","6","placeholder","Minimum 6 caract\xE8res","autocomplete","new-password",3,"ngModelChange","type","ngModel","disabled"],["type","button","tabindex","-1",1,"toggle-password",3,"click"],["size","20",3,"img"],["for","confirmPassword"],["id","confirmPassword","name","confirmPassword","required","","minlength","6","placeholder","Confirmez votre mot de passe","autocomplete","new-password",3,"ngModelChange","type","ngModel","disabled"],["type","submit",3,"disabled"],[1,"message","error"],[1,"message","success"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),p(3,"Mettre \xE0 jour votre mot de passe"),l(),s(4,"p",2),p(5,"Veuillez entrer votre nouveau mot de passe"),l(),b(6,Ku,17,10,"form",3)(7,Zu,2,1,"div",4)(8,Xu,2,1,"div",5),s(9,"button",6),_("click",function(){return o.goToProfile()}),p(10,"Retour au profil"),l(),s(11,"button",7),_("click",function(){return o.goToLogin()}),p(12,"Retour \xE0 la connexion"),l()()()),t&2&&(c(6),g("ngIf",!o.success&&(!o.error()||o.newPassword())),c(),g("ngIf",o.error()),c(),g("ngIf",o.message()))},dependencies:[Z,we,ee,te,ve,be,oi,ne,xe,G,X,K,de],styles:[".update-password-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background-color:#f3f4f6;padding:1rem}.update-password-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 4px 6px -1px #0000001a;width:100%;max-width:400px}h2[_ngcontent-%COMP%]{text-align:center;color:#1e293b;margin-bottom:.5rem}.subtitle[_ngcontent-%COMP%]{text-align:center;color:#64748b;margin-bottom:2rem;font-size:.875rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;color:#475569;font-weight:500}input[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:6px;font-size:1rem;box-sizing:border-box}input[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;ring:2px solid #2563eb}button[type=submit][_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#2563eb;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s;margin-top:1rem}button[type=submit][_ngcontent-%COMP%]:hover{background:#1d4ed8}button[type=submit][_ngcontent-%COMP%]:disabled{background:#94a3b8;cursor:not-allowed}.message[_ngcontent-%COMP%]{padding:1rem;border-radius:6px;margin-top:1rem;text-align:center}.error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.profile-button[_ngcontent-%COMP%], .login-button[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#fff;color:#64748b;border:1px solid #e2e8f0;border-radius:6px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s;margin-top:.5rem}.profile-button[_ngcontent-%COMP%]:hover, .login-button[_ngcontent-%COMP%]:hover{background:#f8fafc;color:#1e293b;border-color:#cbd5e1}.password-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;background:none;border:none;cursor:pointer;padding:0;display:flex;align-items:center;color:#64748b}.toggle-password[_ngcontent-%COMP%]:hover{background:none;color:#1e293b}body.dark-mode[_nghost-%COMP%]   .update-password-container[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .update-password-container[_ngcontent-%COMP%]{background-color:#0f172a}body.dark-mode[_nghost-%COMP%]   .update-password-card[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .update-password-card[_ngcontent-%COMP%]{background:#1e293b;box-shadow:0 4px 6px -1px #00000080}body.dark-mode[_nghost-%COMP%]   h2[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   h2[_ngcontent-%COMP%]{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .subtitle[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:#cbd5e1}body.dark-mode[_nghost-%COMP%]   label[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   label[_ngcontent-%COMP%]{color:#e2e8f0}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]{background:#334155;border-color:#475569;color:#f8fafc}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]{color:#94a3b8}body.dark-mode[_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .toggle-password[_ngcontent-%COMP%]:hover{color:#f8fafc}body.dark-mode[_nghost-%COMP%]   .error[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .error[_ngcontent-%COMP%]{background:#7f1d1d;color:#fecaca}body.dark-mode[_nghost-%COMP%]   .success[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .success[_ngcontent-%COMP%]{background:#14532d;color:#bbf7d0}body.dark-mode[_nghost-%COMP%]   .profile-button[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .profile-button[_ngcontent-%COMP%], body.dark-mode[_nghost-%COMP%]   .login-button[_ngcontent-%COMP%], body.dark-mode   [_nghost-%COMP%]   .login-button[_ngcontent-%COMP%]{background:#334155;color:#e2e8f0;border-color:#475569}body.dark-mode[_nghost-%COMP%]   .profile-button[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .profile-button[_ngcontent-%COMP%]:hover, body.dark-mode[_nghost-%COMP%]   .login-button[_ngcontent-%COMP%]:hover, body.dark-mode   [_nghost-%COMP%]   .login-button[_ngcontent-%COMP%]:hover{background:#475569;color:#f8fafc;border-color:#64748b}body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:hover, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:focus, body.dark-mode[_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active, body.dark-mode   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #334155 inset!important;-webkit-text-fill-color:#f8fafc!important;caret-color:#f8fafc}"]});let i=r;return i})();var bs=[{path:"login",component:hs},{path:"signup",component:_s},{path:"forgot-password",component:Cs},{path:"",canActivate:[vs],children:[{path:"",redirectTo:"/plan-globale",pathMatch:"full"},{path:"planification",component:is},{path:"organisation",component:rs},{path:"ressources",component:Li},{path:"capacite",component:as},{path:"projets",component:us},{path:"plan-globale",component:gs},{path:"jalons",component:fs},{path:"settings",loadComponent:()=>import("./chunk-HPP6DYTV.js").then(i=>i.SettingsComponent)},{path:"profile",component:xs},{path:"update-password",component:ws}]},{path:"**",redirectTo:"login"}];var e0=(()=>{let r=class r{constructor(e){this.sidebarService=e,this.sidebarCollapsed=!1}ngOnInit(){this.sidebarService.collapsed$.subscribe(e=>{this.sidebarCollapsed=e})}};r.\u0275fac=function(t){return new(t||r)(L(Di))},r.\u0275cmp=B({type:r,selectors:[["app-root"]],decls:4,vars:2,consts:[[1,"app-layout"],[1,"main-content"]],template:function(t,o){t&1&&(s(0,"div",0),M(1,"app-sidebar-navigation"),s(2,"main",1),M(3,"router-outlet"),l()()),t&2&&(c(2),U("sidebar-collapsed",o.sidebarCollapsed))},dependencies:[G,Nn,ts],styles:[".app-layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;overflow-x:hidden}.main-content[_ngcontent-%COMP%]{flex:1;margin-left:256px;transition:margin-left .3s cubic-bezier(.4,0,.2,1);overflow-x:hidden}.main-content.sidebar-collapsed[_ngcontent-%COMP%]{margin-left:80px}"]});let i=r;return i})();Co(e0,{providers:[Uo(bs)]});export{e0 as App};
